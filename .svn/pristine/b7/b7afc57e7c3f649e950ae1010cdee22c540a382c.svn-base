<?php
/**
 * Created by PhpStorm.
 * User: breeze
 * Date: 13/07/2017
 * Time: 17:04
 */

namespace App\Http\Controllers\Tools;



use Illuminate\Http\Request;

class ImageUtils
{
    /**
     * 获取可以被压缩的图片对象
     * @param $table_name   //表名
     * @param $app_id       //app_id
     * @param $id           //资源id
     * @param $image_url    //源url
     * @param $image_width  //图片高度
     * @param $image_height //图片宽度
     * @param $image_quality //图片质量
     * @return \stdClass
     */
    public static function getImageObj($table_name, $app_id, $id, $image_url,
                                       $image_width = 160, $image_height = 120, $image_quality = 60) {
        $imageObj = new \stdClass();
        $imageObj->table_name = $table_name;
        $imageObj->app_id = $app_id;
        $imageObj->id = $id;
        $imageObj->image_url = $image_url;
        $imageObj->image_width = $image_width;
        $imageObj->image_height = $image_height;
        $imageObj->image_quality = $image_quality;

        return $imageObj;
    }

    /***
     * 图片对象放入request的图片列表里
     * @param Request $request
     * @param $imageObj
     */
    public static function pushImageList(Request $request, $imageObj) {
        if (!empty($request)) {
            if (empty($request->image_list)) {
                $request->image_list = [];
            }
            $request->image_list[] = $imageObj;
        }
    }

    /**
     * 压缩图片
     * @param Request $request
     * @param $table_name
     * @param $app_id
     * @param $id
     * @param $image_url
     * @param int $image_width
     * @param int $image_height
     * @param int $image_quality
     */
    public static function ImageCompress(Request $request, $table_name, $app_id, $id, $image_url,
                                             $image_width = 320, $image_height = 240, $image_quality = 80) {
        $imageObj = self::getImageObj($table_name, $app_id, $id, $image_url, $image_width, $image_height, $image_quality);
        self::pushImageList($request, $imageObj);
    }

    /**
     * banner图压缩
     * @param Request $request
     * @param $app_id
     * @param $id
     * @param $image_url
     */
    public static function bannerImgCompress(Request $request, $app_id, $id, $image_url) {
        self::ImageCompress($request, 't_banner', $app_id, $id, $image_url, 750,280, 80);
    }

    /**
     * 资源 缩略图 压缩  //专栏、会员、音频、视频、图文、直播
     * @param Request $request
     * @param $table_name
     * @param $app_id
     * @param $id
     * @param $image_url
     */
    public static function resImgCompress(Request $request, $table_name, $app_id, $id, $image_url) {
        self::ImageCompress($request, $table_name, $app_id, $id, $image_url, 160, 120, 80);
    }
}