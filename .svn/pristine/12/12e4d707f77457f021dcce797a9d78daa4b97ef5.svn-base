$(function(){manageCommunity.init()});var manageCommunity=function(){var e={};var i=false;e.isCommunityShow=false;var t,n;function a(e){var i=new RegExp("(^|&)"+e+"=([^&]*)(&|$)");var t=window.location.search.substr(1).match(i);if(t!=null)return unescape(t[2]);return null}function l(e){var i=null;if(window.createObjectURL!=undefined){i=window.createObjectURL(e)}else if(window.URL!=undefined){i=window.URL.createObjectURL(e)}else if(window.webkitURL!=undefined){i=window.webkitURL.createObjectURL(e)}return i}function s(e){if(window.revokeObjectURL!=undefined){window.revokeObjectURL(e)}else if(window.URL!=undefined){window.URL.revokeObjectURL(e)}else if(window.webkitURL!=undefined){window.webkitURL.revokeObjectURL(e)}}function o(e,i,t,n){if($formCheck.emptyString(e.title)){baseUtils.show.redTip("社群名称不能为空");return false}if(e.title.length>15){baseUtils.show.redTip("社群名称不能超过15个字符");return false}if($formCheck.emptyString(e.describe)){baseUtils.show.redTip("社群简介不能为空！");return false}if(e.describe.length>40){baseUtils.show.redTip("社群简介不能超过40个字符");return false}if($formCheck.emptyString(e.img_url)){baseUtils.show.redTip("请上传社群封面！");return false}if(!i&&!t){baseUtils.show.redTip("请选择至少一种加入形式");return false}if(i&&$formCheck.emptyString(e.piece_price)){baseUtils.show.redTip("请填入单卖价格！");return false}if(i&&e.piece_price>baseUtils.maxInputPrice*100){baseUtils.show.redTip("价格不能大于 "+baseUtils.maxInputPrice+" 元");return false}if(t&&n.length==0){baseUtils.show.redTip("请选择您要关联的专栏或会员！");return false}return true}function c(e,i,a,o){console.log(e);if(e&&e.length>0){var c=e[0];var r=l(c);t=(c.size/(1024*1024)).toFixed(2);n=c.duration;if($uploadFile.checkFileSize(c,o)){$uploadFile.uploadRes(c,i,function(e){},function(e){console.log(e);baseUtils.show.blueTip("上传成功！");resUrl=e.data.access_url;console.log(resUrl);$("#imgUrl").val(resUrl);if(i=="image"){$("#reBackImg").load(function(){s(r)}).attr("src",r)}},function(e){console.error("上传失败!!!");console.log(e);baseUtils.show.redTip("上传失败！")})}else{baseUtils.show.redTip("上传资源限制在"+o+"MB内！");$(".upLoad"+a).val("")}}else{baseUtils.show.redTip("网络错误，请稍后再试！")}}e.init=function(){$("#uploadImage").on("change",function(){c(this.files,"image","reBackImg",5)});$(".resAddSectionC").on("click",".setFee",function(){if($("#setFee").is(":checked")){$("#setPrice").attr("readonly","readonly");$("#setPrice").attr("disabled","disabled")}else{$("#setPrice").removeAttr("readonly");$("#setPrice").removeAttr("disabled")}});$(".resAddSectionC").on("click",".setRelevance",function(){if($("#setRelevance").is(":checked")){$("#relevanceContent").fadeOut(200)}else{$("#relevanceContent").fadeIn(200)}});$("#packageType").on("change",function(){if($("#package").is(":selected")){$("#memberSel").val("none");$(this).next().show();$(this).next().next().hide()}else{$("#packageSel").val("none");$(this).next().hide();$(this).next().next().show()}});$("#newRelevance").click(function(){$("#newRelevance").hide();$(".selectRelevance").show()});$("#removeRelevance").click(function(){$("#newRelevance").show();$(".selectRelevance").hide();$("#packageType").val("package");$("#packageSel").val("none");$("#memberSel").val("none");$("#memberSel").hide();$("#packageSel").show()});$("#addRelevance").click(function(){var e=$(".packageSelect:visible option:selected").data("product_id");for(var i=0;i<$(".oneRelevance").length;i++){var t=$(".oneRelevance").eq(i).data("product_id");if(e==t){baseUtils.show.redTip("请勿重复选择");return false}}if($(".packageSelect:visible").val()=="none"){baseUtils.show.redTip("请选择您当前要关联的会员或专栏")}else{var n=$("#packageType option:selected").text(),a=$(".packageSelect:visible option:selected").text(),l='<div class="oneRelevance clearfix" data-product_id="'+e+'">'+'<div class="packageClass">'+n+"</div>"+'<div class="packageName" title="'+a+'">'+a+"</div>"+'<button type="cancel" class="xeBtnDefault btnMid cancelRelevance">取消关联</button>'+"</div>";$("#relevanceContent").append(l);$("#removeRelevance").click()}});$(".secondCheckbox").on("click",".cancelRelevance",function(){$(this).parent().remove()});$(".base_mainContent").on("click","#saveBtn",function(){if(i){baseUtils.show.redTip("不能重复提交")}else{var e=$.trim($("#pageType").val()),t=$.trim($("#title").val()),n=$.trim($("#intro").val()),l=$.trim($("#imgUrl").val()),s=$("#setFee").is(":checked"),c=$.trim($("#setPrice").val())*100;if(!s){c=null}var r=$("#setRelevance").is(":checked");var d=[];if(r){for(var u=0,f=0;u<$(".oneRelevance").length;u++){var m={};m[u]=$(".oneRelevance").eq(u).data("product_id");if(m[u]){d[f]=m;f++}}}else{d=null}var v=$("input[name='isCommunityShow']:checked").val();if(e==0){var p={title:t,describe:n,img_url:l,piece_price:c,product_id:JSON.stringify(d),community_state:v}}else{var w=a("id");var p={id:w,title:t,describe:n,img_url:l,piece_price:c,product_id:JSON.stringify(d),community_state:v}}if(o(p,s,r,d)){i=true;if(e==0){var h="uploadCommunity"}else{var h="updateCommunity"}console.log(h);$.ajax(h,{type:"POST",dataType:"json",data:p,success:function(t){if(parseInt(t.code)==0){if(e==1){if(t.free==1){var n="将免费社群修改为付费社群，已加入的用户需要重新付费进入，或您可以生成邀请码邀请用户进入。";$.alert(n,"info",{oktext:"我知道了",btn:2,onOk:function(){window.location.href="/smallCommunity/communityList"},onClose:function(){window.location.href="/smallCommunity/communityList"}});return false}else{baseUtils.show.blueTip("保存成功")}}else{baseUtils.show.blueTip("创建成功")}if(t.is_new==1){window.location.href="/smallCommunity/communityList?is_new="+1}else{window.location.href="/smallCommunity/communityList"}}else{i=false;baseUtils.show.redTip(t.msg)}},error:function(e,t,n){i=false;console.error(n);baseUtils.show.redTip("网络错误，请稍后再试！")}})}}})};return e}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkbWluL2NvbW11bml0eU9wZXJhdGUvbWFuYWdlQ29tbXVuaXR5LmpzIl0sIm5hbWVzIjpbIiQiLCJtYW5hZ2VDb21tdW5pdHkiLCJpbml0Iiwic3VibWl0TGltaXQiLCJpc0NvbW11bml0eVNob3ciLCJmaWxlU2l6ZSIsInJlc0F1ZGlvMUxlbmdoIiwiR2V0UXVlcnlTdHJpbmciLCJuYW1lIiwicmVnIiwiUmVnRXhwIiwiciIsIndpbmRvdyIsImxvY2F0aW9uIiwic2VhcmNoIiwic3Vic3RyIiwibWF0Y2giLCJ1bmVzY2FwZSIsImdldE9iamVjdFVSTCIsImZpbGUiLCJ1cmwiLCJjcmVhdGVPYmplY3RVUkwiLCJ1bmRlZmluZWQiLCJVUkwiLCJ3ZWJraXRVUkwiLCJyZW1vdmVPYmplY3RVUkwiLCJyZXZva2VPYmplY3RVUkwiLCJjaGVja0NvbW11bml0eUZvcm0iLCJpbmZvIiwic2luZ2xlU2FsZSIsInJlbGV2YW5jZSIsInByb2R1Y3RfaWQiLCIkZm9ybUNoZWNrIiwiZW1wdHlTdHJpbmciLCJ0aXRsZSIsImJhc2VVdGlscyIsInNob3ciLCJyZWRUaXAiLCJsZW5ndGgiLCJkZXNjcmliZSIsImltZ191cmwiLCJwaWVjZV9wcmljZSIsIm1heElucHV0UHJpY2UiLCJyZXNVcGxvYWQiLCJmaWxlcyIsInJlc1R5cGUiLCJyZXNUeXBlQ2xhc3MiLCJyZXNMaW1pdFNpemUiLCJjb25zb2xlIiwibG9nIiwicmVzb3VyY2VMb2NhbFVybCIsInNpemUiLCJ0b0ZpeGVkIiwiZHVyYXRpb24iLCIkdXBsb2FkRmlsZSIsImNoZWNrRmlsZVNpemUiLCJ1cGxvYWRSZXMiLCJkYXRhIiwiYmx1ZVRpcCIsInJlc1VybCIsImFjY2Vzc191cmwiLCJ2YWwiLCJsb2FkIiwiYXR0ciIsImVycm9yIiwib24iLCJ0aGlzIiwiaXMiLCJyZW1vdmVBdHRyIiwiZmFkZU91dCIsImZhZGVJbiIsIm5leHQiLCJoaWRlIiwiY2xpY2siLCJwcm9kdWN0SWQiLCJpIiwiY3VycmVudElkIiwiZXEiLCJGaXJzdFNlbGVjdGVkIiwidGV4dCIsIlNlY29uZERldGFpbCIsImh0bWxTdHJpbmciLCJhcHBlbmQiLCJwYXJlbnQiLCJyZW1vdmUiLCJwYWdlVHlwZSIsInRyaW0iLCJqIiwiaWRBcnJheSIsInBhcmFtcyIsIkpTT04iLCJzdHJpbmdpZnkiLCJjb21tdW5pdHlfc3RhdGUiLCJpZCIsImFqYXhVcmwiLCJhamF4IiwidHlwZSIsImRhdGFUeXBlIiwic3VjY2VzcyIsInBhcnNlSW50IiwiY29kZSIsImZyZWUiLCJhbGVydCIsIm9rdGV4dCIsImJ0biIsIm9uT2siLCJocmVmIiwib25DbG9zZSIsImlzX25ldyIsIm1zZyIsInhociIsInN0YXR1cyIsImVyciJdLCJtYXBwaW5ncyI6IkFBQUFBLEVBQUUsV0FDRUMsZ0JBQWdCQyxRQUlwQixJQUFJRCxpQkFBa0IsV0FFbEIsR0FBSUEsS0FFSixJQUFJRSxHQUFjLEtBRWxCRixHQUFnQkcsZ0JBQWtCLEtBRWxDLElBQUlDLEdBQ0FDLENBR0osU0FBU0MsR0FBZUMsR0FDcEIsR0FBSUMsR0FBTSxHQUFJQyxRQUFPLFFBQVVGLEVBQU8sZ0JBQ3RDLElBQUlHLEdBQUlDLE9BQU9DLFNBQVNDLE9BQU9DLE9BQU8sR0FBR0MsTUFBTVAsRUFDL0MsSUFBSUUsR0FBSyxLQUFNLE1BQU9NLFVBQVNOLEVBQUUsR0FDakMsT0FBTyxNQUdYLFFBQVNPLEdBQWFDLEdBQ2xCLEdBQUlDLEdBQU0sSUFDVixJQUFJUixPQUFPUyxpQkFBbUJDLFVBQVcsQ0FDckNGLEVBQU1SLE9BQU9TLGdCQUFnQkYsT0FDMUIsSUFBSVAsT0FBT1csS0FBT0QsVUFBVyxDQUNoQ0YsRUFBTVIsT0FBT1csSUFBSUYsZ0JBQWdCRixPQUM5QixJQUFJUCxPQUFPWSxXQUFhRixVQUFXLENBQ3RDRixFQUFNUixPQUFPWSxVQUFVSCxnQkFBZ0JGLEdBRTNDLE1BQU9DLEdBR1gsUUFBU0ssR0FBZ0JMLEdBQ3JCLEdBQUlSLE9BQU9jLGlCQUFtQkosVUFBVyxDQUNyQ1YsT0FBT2MsZ0JBQWdCTixP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LEVBQWMsS0FDZGdDLFdBQVVDLEtBQUtDLE9BQU9vQixFQUFLb0QsT0FHbkM3QyxNQUFPLFNBQVU4QyxFQUFLQyxFQUFRQyxHQUMxQjdHLEVBQWMsS0FDZDZDLFNBQVFnQixNQUFNZ0QsRUFDZDdFLFdBQVVDLEtBQUtDLE9BQU8sc0JBUzlDLE9BQU9wQyIsImZpbGUiOiJhZG1pbi9jb21tdW5pdHlPcGVyYXRlL21hbmFnZUNvbW11bml0eS5qcyIsInNvdXJjZXNDb250ZW50IjpbIiQoZnVuY3Rpb24gKCkge1xyXG4gICAgbWFuYWdlQ29tbXVuaXR5LmluaXQoKTtcclxufSk7XHJcblxyXG5cclxudmFyIG1hbmFnZUNvbW11bml0eSA9IGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICB2YXIgbWFuYWdlQ29tbXVuaXR5ID0ge307XHJcblxyXG4gICAgdmFyIHN1Ym1pdExpbWl0ID0gZmFsc2U7ICAgICAvLyDooajljZXmj5DkuqTpmZDliLbmoIforrBcclxuXHJcbiAgICBtYW5hZ2VDb21tdW5pdHkuaXNDb21tdW5pdHlTaG93ID0gZmFsc2U7ICAgIC8vICDnpL7nvqTmmK/lkKbkuIrkuIvmnrZcclxuXHJcbiAgICB2YXIgZmlsZVNpemUsXHJcbiAgICAgICAgcmVzQXVkaW8xTGVuZ2g7XHJcblxyXG4gICAgLy/ojrflj5blnLDlnYDmoI/lj4LmlbBcclxuICAgIGZ1bmN0aW9uIEdldFF1ZXJ5U3RyaW5nKG5hbWUpIHtcclxuICAgICAgICB2YXIgcmVnID0gbmV3IFJlZ0V4cChcIihefCYpXCIgKyBuYW1lICsgXCI9KFteJl0qKSgmfCQpXCIpO1xyXG4gICAgICAgIHZhciByID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaC5zdWJzdHIoMSkubWF0Y2gocmVnKTtcclxuICAgICAgICBpZiAociAhPSBudWxsKSByZXR1cm4gdW5lc2NhcGUoclsyXSk7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0T2JqZWN0VVJMKGZpbGUpIHtcclxuICAgICAgICB2YXIgdXJsID0gbnVsbDtcclxuICAgICAgICBpZiAod2luZG93LmNyZWF0ZU9iamVjdFVSTCAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdXJsID0gd2luZG93LmNyZWF0ZU9iamVjdFVSTChmaWxlKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHdpbmRvdy5VUkwgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGZpbGUpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAod2luZG93LndlYmtpdFVSTCAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdXJsID0gd2luZG93LndlYmtpdFVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB1cmw7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gcmVtb3ZlT2JqZWN0VVJMKHVybCkgey8v6YeK5pS+6LWE5rqQVVJMXHJcbiAgICAgICAgaWYgKHdpbmRvdy5yZXZva2VPYmplY3RVUkwgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHdpbmRvdy5yZXZva2VPYmplY3RVUkwodXJsKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHdpbmRvdy5VUkwgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHdpbmRvdy5VUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cud2Via2l0VVJMICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB3aW5kb3cud2Via2l0VVJMLnJldm9rZU9iamVjdFVSTCh1cmwpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcblxyXG4gICAgLy/mo4Dmn6XnpL7nvqTmj5DkuqTooajljZVcclxuICAgIGZ1bmN0aW9uIGNoZWNrQ29tbXVuaXR5Rm9ybShpbmZvLCBzaW5nbGVTYWxlLCByZWxldmFuY2UscHJvZHVjdF9pZCkge1xyXG4gICAgICAgIGlmICgkZm9ybUNoZWNrLmVtcHR5U3RyaW5nKGluZm8udGl0bGUpKSB7XHJcbiAgICAgICAgICAgIGJhc2VVdGlscy5zaG93LnJlZFRpcChcIuekvue+pOWQjeensOS4jeiDveS4uuepulwiKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaW5mby50aXRsZS5sZW5ndGggPiAxNSkge1xyXG4gICAgICAgICAgICBiYXNlVXRpbHMuc2hvdy5yZWRUaXAoXCLnpL7nvqTlkI3np7DkuI3og73otoXov4cxNeS4quWtl+esplwiKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCRmb3JtQ2hlY2suZW1wdHlTdHJpbmcoaW5mby5kZXNjcmliZSkpIHtcclxuICAgICAgICAgICAgYmFzZVV0aWxzLnNob3cucmVkVGlwKFwi56S+576k566A5LuL5LiN6IO95Li656m677yBXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpbmZvLmRlc2NyaWJlLmxlbmd0aCA+IDQwKSB7XHJcbiAgICAgICAgICAgIGJhc2VVdGlscy5zaG93LnJlZFRpcChcIuekvue+pOeugOS7i+S4jeiDvei2hei/hzQw5Liq5a2X56ymXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoJGZvcm1DaGVjay5lbXB0eVN0cmluZyhpbmZvLmltZ191cmwpKSB7XHJcbiAgICAgICAgICAgIGJhc2VVdGlscy5zaG93LnJlZFRpcChcIuivt+S4iuS8oOekvue+pOWwgemdou+8gVwiKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKCFzaW5nbGVTYWxlICYmICFyZWxldmFuY2UpIHtcclxuICAgICAgICAgICAgYmFzZVV0aWxzLnNob3cucmVkVGlwKFwi6K+36YCJ5oup6Iez5bCR5LiA56eN5Yqg5YWl5b2i5byPXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoc2luZ2xlU2FsZSAmJiAkZm9ybUNoZWNrLmVtcHR5U3RyaW5nKGluZm8ucGllY2VfcHJpY2UpKSB7XHJcbiAgICAgICAgICAgIGJhc2VVdGlscy5zaG93LnJlZFRpcChcIuivt+Whq+WFpeWNleWNluS7t+agvO+8gVwiKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoc2luZ2xlU2FsZSAmJiBpbmZvLnBpZWNlX3ByaWNlID4gYmFzZVV0aWxzLm1heElucHV0UHJpY2UgKiAxMDApIHtcclxuICAgICAgICAgICAgYmFzZVV0aWxzLnNob3cucmVkVGlwKFwi5Lu35qC85LiN6IO95aSn5LqOIFwiICsgYmFzZVV0aWxzLm1heElucHV0UHJpY2UgKyBcIiDlhYNcIik7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChyZWxldmFuY2UgJiYgcHJvZHVjdF9pZC5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICBiYXNlVXRpbHMuc2hvdy5yZWRUaXAoXCLor7fpgInmi6nmgqjopoHlhbPogZTnmoTkuJPmoI/miJbkvJrlkZjvvIFcIik7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIC8v6LWE5rqQ5LiK5Lyg5Ye95pWwKOWPguaVsO+8mnJlc1R5cGU66LWE5rqQ57G75Z6LLHJlc1R5cGVDbGFzczrotYTmupDnsbvlnovkuK3nu4bliIbnmoTnp43nsbsscmVzTGltaXRTaXplOui1hOa6kOmZkOWItuWkp+WwjylcclxuICAgIGZ1bmN0aW9uIHJlc1VwbG9hZChmaWxlcywgcmVzVHlwZSwgcmVzVHlwZUNsYXNzLCByZXNMaW1pdFNpemUpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhmaWxlcyk7XHJcbiAgICAgICAgaWYgKGZpbGVzICYmIGZpbGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgdmFyIGZpbGUgPSBmaWxlc1swXTtcclxuICAgICAgICAgICAgdmFyIHJlc291cmNlTG9jYWxVcmwgPSBnZXRPYmplY3RVUkwoZmlsZSk7XHJcbiAgICAgICAgICAgIGZpbGVTaXplID0gKGZpbGUuc2l6ZSAvICgxMDI0ICogMTAyNCkpLnRvRml4ZWQoMik7XHJcbiAgICAgICAgICAgIHJlc0F1ZGlvMUxlbmdoID0gZmlsZS5kdXJhdGlvbjtcclxuICAgICAgICAgICAgLy8g6ZmQ5Yi26LWE5rqQ5ZyoKk1C5YaFXHJcbiAgICAgICAgICAgIGlmICgkdXBsb2FkRmlsZS5jaGVja0ZpbGVTaXplKGZpbGUsIHJlc0xpbWl0U2l6ZSkpIHtcclxuICAgICAgICAgICAgICAgICR1cGxvYWRGaWxlLnVwbG9hZFJlcyhmaWxlLCByZXNUeXBlLCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5LiK5Lyg5oiQ5Yqf5Zue6LCDXHJcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhc2VVdGlscy5zaG93LmJsdWVUaXAoXCLkuIrkvKDmiJDlip/vvIFcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc1VybCA9IGRhdGEuZGF0YS5hY2Nlc3NfdXJsO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNVcmwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkKFwiI2ltZ1VybFwiKS52YWwocmVzVXJsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8g5aaC5p6c5piv5Zu+54mH6LWE5rqQ77yM5YiZ5bGV56S65Zu+54mH6aKE6KeIXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNUeXBlID09ICdpbWFnZScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v55u05o6l5Yqg6L295pys5Zyw5Zu+54mH6L+b6KGM6aKE6KeIXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKFwiI3JlQmFja0ltZ1wiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5sb2FkKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlT2JqZWN0VVJMKHJlc291cmNlTG9jYWxVcmwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmF0dHIoXCJzcmNcIiwgcmVzb3VyY2VMb2NhbFVybCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAvLyDkuIrkvKDlpLHotKXlm57osINcclxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwi5LiK5Lyg5aSx6LSlISEhXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmFzZVV0aWxzLnNob3cucmVkVGlwKFwi5LiK5Lyg5aSx6LSl77yBXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgYmFzZVV0aWxzLnNob3cucmVkVGlwKFwi5LiK5Lyg6LWE5rqQ6ZmQ5Yi25ZyoXCIgKyByZXNMaW1pdFNpemUgKyBcIk1C5YaF77yBXCIpO1xyXG4gICAgICAgICAgICAgICAgJChcIi51cExvYWRcIiArIHJlc1R5cGVDbGFzcykudmFsKFwiXCIpO1xyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGJhc2VVdGlscy5zaG93LnJlZFRpcChcIue9kee7nOmUmeivr++8jOivt+eojeWQjuWGjeivle+8gVwiKTtcclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZmlsZXMpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG1hbmFnZUNvbW11bml0eS5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAvLyDngrnlh7vmjInpkq7kuIrkvKDlm77niYdcclxuICAgICAgICAkKFwiI3VwbG9hZEltYWdlXCIpLm9uKFwiY2hhbmdlXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmVzVXBsb2FkKHRoaXMuZmlsZXMsIFwiaW1hZ2VcIiwgXCJyZUJhY2tJbWdcIiwgNSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8v5Y2V5Y2W6K6+572uXHJcbiAgICAgICAgJChcIi5yZXNBZGRTZWN0aW9uQ1wiKS5vbihcImNsaWNrXCIsIFwiLnNldEZlZVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICgkKFwiI3NldEZlZVwiKS5pcygnOmNoZWNrZWQnKSkge1xyXG4gICAgICAgICAgICAgICAgJChcIiNzZXRQcmljZVwiKS5hdHRyKFwicmVhZG9ubHlcIiwgXCJyZWFkb25seVwiKTtcclxuICAgICAgICAgICAgICAgICQoXCIjc2V0UHJpY2VcIikuYXR0cihcImRpc2FibGVkXCIsIFwiZGlzYWJsZWRcIik7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkKFwiI3NldFByaWNlXCIpLnJlbW92ZUF0dHIoXCJyZWFkb25seVwiKTtcclxuICAgICAgICAgICAgICAgICQoXCIjc2V0UHJpY2VcIikucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vICDlhbPogZTpg6jliIbnmoTlvIDlkK/lkozlhbPpl61cclxuICAgICAgICAkKFwiLnJlc0FkZFNlY3Rpb25DXCIpLm9uKFwiY2xpY2tcIiwgXCIuc2V0UmVsZXZhbmNlXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCQoXCIjc2V0UmVsZXZhbmNlXCIpLmlzKCc6Y2hlY2tlZCcpKSB7XHJcbiAgICAgICAgICAgICAgICAkKFwiI3JlbGV2YW5jZUNvbnRlbnRcIikuZmFkZU91dCgyMDApO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJChcIiNyZWxldmFuY2VDb250ZW50XCIpLmZhZGVJbigyMDApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8v5YWz6IGU5YaF5a655YiH5o2iXHJcbiAgICAgICAgJChcIiNwYWNrYWdlVHlwZVwiKS5vbihcImNoYW5nZVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICgkKFwiI3BhY2thZ2VcIikuaXMoJzpzZWxlY3RlZCcpKSB7XHJcbiAgICAgICAgICAgICAgICAkKFwiI21lbWJlclNlbFwiKS52YWwoXCJub25lXCIpO1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5uZXh0KCkuc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5uZXh0KCkubmV4dCgpLmhpZGUoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICQoXCIjcGFja2FnZVNlbFwiKS52YWwoXCJub25lXCIpO1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5uZXh0KCkuaGlkZSgpO1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5uZXh0KCkubmV4dCgpLnNob3coKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvL+a3u+WKoOWFs+iBlFxyXG4gICAgICAgICQoXCIjbmV3UmVsZXZhbmNlXCIpLmNsaWNrKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJChcIiNuZXdSZWxldmFuY2VcIikuaGlkZSgpO1xyXG4gICAgICAgICAgICAkKFwiLnNlbGVjdFJlbGV2YW5jZVwiKS5zaG93KCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8v5Y+W5raI6YCJ5Lit55qE5YWz6IGUXHJcbiAgICAgICAgJChcIiNyZW1vdmVSZWxldmFuY2VcIikuY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkKFwiI25ld1JlbGV2YW5jZVwiKS5zaG93KCk7XHJcbiAgICAgICAgICAgICQoXCIuc2VsZWN0UmVsZXZhbmNlXCIpLmhpZGUoKTtcclxuXHJcbiAgICAgICAgICAgICQoXCIjcGFja2FnZVR5cGVcIikudmFsKFwicGFja2FnZVwiKTtcclxuICAgICAgICAgICAgJChcIiNwYWNrYWdlU2VsXCIpLnZhbChcIm5vbmVcIik7XHJcbiAgICAgICAgICAgICQoXCIjbWVtYmVyU2VsXCIpLnZhbChcIm5vbmVcIik7XHJcbiAgICAgICAgICAgICQoXCIjbWVtYmVyU2VsXCIpLmhpZGUoKVxyXG4gICAgICAgICAgICAkKFwiI3BhY2thZ2VTZWxcIikuc2hvdygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvL+S/neWtmOmAieS4reeahOWFs+iBlFxyXG4gICAgICAgICQoXCIjYWRkUmVsZXZhbmNlXCIpLmNsaWNrKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHByb2R1Y3RJZCA9ICQoXCIucGFja2FnZVNlbGVjdDp2aXNpYmxlIG9wdGlvbjpzZWxlY3RlZFwiKS5kYXRhKFwicHJvZHVjdF9pZFwiKTtcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgJChcIi5vbmVSZWxldmFuY2VcIikubGVuZ3RoOyBpKyspIHsgICAgICAgLy/liKTlrprmmK/lkKbph43lpI3lhbPogZRcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudElkID0gJChcIi5vbmVSZWxldmFuY2VcIikuZXEoaSkuZGF0YSgncHJvZHVjdF9pZCcpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHByb2R1Y3RJZCA9PSBjdXJyZW50SWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBiYXNlVXRpbHMuc2hvdy5yZWRUaXAoJ+ivt+WLv+mHjeWkjemAieaLqScpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoJChcIi5wYWNrYWdlU2VsZWN0OnZpc2libGVcIikudmFsKCkgPT0gJ25vbmUnKSB7XHJcbiAgICAgICAgICAgICAgICBiYXNlVXRpbHMuc2hvdy5yZWRUaXAoJ+ivt+mAieaLqeaCqOW9k+WJjeimgeWFs+iBlOeahOS8muWRmOaIluS4k+agjycpO1xyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgRmlyc3RTZWxlY3RlZCA9ICQoXCIjcGFja2FnZVR5cGUgb3B0aW9uOnNlbGVjdGVkXCIpLnRleHQoKSxcclxuICAgICAgICAgICAgICAgICAgICBTZWNvbmREZXRhaWwgPSAkKFwiLnBhY2thZ2VTZWxlY3Q6dmlzaWJsZSBvcHRpb246c2VsZWN0ZWRcIikudGV4dCgpLFxyXG4gICAgICAgICAgICAgICAgICAgIGh0bWxTdHJpbmcgPVxyXG4gICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwib25lUmVsZXZhbmNlIGNsZWFyZml4XCIgZGF0YS1wcm9kdWN0X2lkPVwiJyArIHByb2R1Y3RJZCArICdcIj4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJwYWNrYWdlQ2xhc3NcIj4nICsgRmlyc3RTZWxlY3RlZCArICc8L2Rpdj4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJwYWNrYWdlTmFtZVwiIHRpdGxlPVwiJyArIFNlY29uZERldGFpbCArICdcIj4nICsgU2Vjb25kRGV0YWlsICsgJzwvZGl2PicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnPGJ1dHRvbiB0eXBlPVwiY2FuY2VsXCIgY2xhc3M9XCJ4ZUJ0bkRlZmF1bHQgYnRuTWlkIGNhbmNlbFJlbGV2YW5jZVwiPuWPlua2iOWFs+iBlDwvYnV0dG9uPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nO1xyXG5cclxuICAgICAgICAgICAgICAgICQoXCIjcmVsZXZhbmNlQ29udGVudFwiKS5hcHBlbmQoaHRtbFN0cmluZyk7XHJcblxyXG4gICAgICAgICAgICAgICAgJChcIiNyZW1vdmVSZWxldmFuY2VcIikuY2xpY2soKTtcclxuXHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAvL+WPlua2iOW3suWFs+iBlOeahOS4k+agj+aIluS8muWRmFxyXG4gICAgICAgICQoXCIuc2Vjb25kQ2hlY2tib3hcIikub24oXCJjbGlja1wiLCBcIi5jYW5jZWxSZWxldmFuY2VcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLnJlbW92ZSgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuXHJcbiAgICAgICAgLy/mj5DkuqTooajljZVcclxuICAgICAgICAkKFwiLmJhc2VfbWFpbkNvbnRlbnRcIikub24oXCJjbGlja1wiLCAnI3NhdmVCdG4nLCBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgICAgICBpZiAoc3VibWl0TGltaXQpIHtcclxuICAgICAgICAgICAgICAgIGJhc2VVdGlscy5zaG93LnJlZFRpcChcIuS4jeiDvemHjeWkjeaPkOS6pFwiKTtcclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBwYWdlVHlwZSA9ICQudHJpbSgkKFwiI3BhZ2VUeXBlXCIpLnZhbCgpKSwgICAgLy8gIOiOt+WPlumhtemdouexu+Wei1xyXG4gICAgICAgICAgICAgICAgICAgIHRpdGxlID0gJC50cmltKCQoXCIjdGl0bGVcIikudmFsKCkpLCAgICAgICAgICAvLyAg6I635Y+W6KGo5Y2V5pWw5o2uLy8gIOiOt+WPluekvue+pOWQjeensFxyXG4gICAgICAgICAgICAgICAgICAgIGRlc2NyaWJlID0gJC50cmltKCQoXCIjaW50cm9cIikudmFsKCkpLCAgICAgICAvLyAg6I635Y+W56S+576k566A5LuLXHJcbiAgICAgICAgICAgICAgICAgICAgaW1nX3VybCA9ICQudHJpbSgkKFwiI2ltZ1VybFwiKS52YWwoKSksICAgICAgIC8vICDojrflj5blsIHpnaLlm77niYdcclxuICAgICAgICAgICAgICAgICAgICBzaW5nbGVTYWxlID0gJChcIiNzZXRGZWVcIikuaXMoJzpjaGVja2VkJyksICAgLy8gIOiOt+WPluWNleWNlmNoZWNr54q25oCBXHJcbiAgICAgICAgICAgICAgICAgICAgcGllY2VfcHJpY2UgPSAkLnRyaW0oJChcIiNzZXRQcmljZVwiKS52YWwoKSkgKiAxMDA7ICAgLy8gIOiOt+WPluWNleWNluS7t+agvFxyXG5cclxuICAgICAgICAgICAgICAgIGlmICghc2luZ2xlU2FsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHBpZWNlX3ByaWNlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcmVsZXZhbmNlID0gJChcIiNzZXRSZWxldmFuY2VcIikuaXMoJzpjaGVja2VkJyk7ICAgICAgLy8gIOiOt+WPluWFs+iBlGNoZWNr54q25oCBXHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHByb2R1Y3RfaWQgPSBbXTsgICAgLy8gIOiOt+WPluWFs+iBlGlkXHJcbiAgICAgICAgICAgICAgICBpZiAocmVsZXZhbmNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGogPSAwOyBpIDwgJChcIi5vbmVSZWxldmFuY2VcIikubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy/lhbPogZTkuJPmoI/lkozkvJrlkZjnmoRpZOWAvFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWRBcnJheSA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZEFycmF5W2ldID0gJChcIi5vbmVSZWxldmFuY2VcIikuZXEoaSkuZGF0YSgncHJvZHVjdF9pZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWRBcnJheVtpXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdF9pZFtqXSA9IGlkQXJyYXk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqKys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHByb2R1Y3RfaWQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIC8vICDojrflj5bnpL7nvqTmmK/lkKbkuIrmnrZcclxuICAgICAgICAgICAgICAgIHZhciBpc0NvbW11bml0eVNob3cgPSAkKFwiaW5wdXRbbmFtZT0naXNDb21tdW5pdHlTaG93J106Y2hlY2tlZFwiKS52YWwoKTtcclxuXHJcbiAgICAgICAgICAgICAgICAvLyAg56S+576k5L+h5oGvXHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKHBhZ2VUeXBlID09IDApIHsgICAgLy8gIOaWsOW7uuekvue+pFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aXRsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpYmU6IGRlc2NyaWJlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWdfdXJsOiBpbWdfdXJsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwaWVjZV9wcmljZTogcGllY2VfcHJpY2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3RfaWQ6IEpTT04uc3RyaW5naWZ5KHByb2R1Y3RfaWQpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21tdW5pdHlfc3RhdGU6IGlzQ29tbXVuaXR5U2hvdyAgICAgICAgLy8wIC0g5LiK5p62ICAxLSDkuIvmnrZcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZCA9IEdldFF1ZXJ5U3RyaW5nKFwiaWRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGlkLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogdGl0bGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaWJlOiBkZXNjcmliZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW1nX3VybDogaW1nX3VybCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGllY2VfcHJpY2U6IHBpZWNlX3ByaWNlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0X2lkOiBKU09OLnN0cmluZ2lmeShwcm9kdWN0X2lkKSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29tbXVuaXR5X3N0YXRlOiBpc0NvbW11bml0eVNob3dcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGNoZWNrQ29tbXVuaXR5Rm9ybShwYXJhbXMsIHNpbmdsZVNhbGUsIHJlbGV2YW5jZSwgcHJvZHVjdF9pZCkpIHtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgc3VibWl0TGltaXQgPSB0cnVlOyAgICAgLy8g6KGo5Y2V5o+Q5Lqk6ZmQ5Yi25qCH6K6wXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwYWdlVHlwZSA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhamF4VXJsID0gJ3VwbG9hZENvbW11bml0eSc7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFqYXhVcmwgPSAndXBkYXRlQ29tbXVuaXR5JztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYWpheFVybCk7XHJcbiAgICAgICAgICAgICAgICAgICAgJC5hamF4KGFqYXhVcmwsIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBwYXJhbXMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VJbnQoZGF0YS5jb2RlKSA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYWdlVHlwZSA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihkYXRhLmZyZWUgPT0gMSl7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZXh0ID0gXCLlsIblhY3otLnnpL7nvqTkv67mlLnkuLrku5jotLnnpL7nvqTvvIzlt7LliqDlhaXnmoTnlKjmiLfpnIDopoHph43mlrDku5jotLnov5vlhaXvvIzmiJbmgqjlj6/ku6XnlJ/miJDpgoDor7fnoIHpgoDor7fnlKjmiLfov5vlhaXjgIJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmFsZXJ0KHRleHQsJ2luZm8nLHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2t0ZXh0OiAn5oiR55+l6YGT5LqGJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnRuOiAyLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbk9rOiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvc21hbGxDb21tdW5pdHkvY29tbXVuaXR5TGlzdCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U6ZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmPScvc21hbGxDb21tdW5pdHkvY29tbXVuaXR5TGlzdCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gYmFzZVV0aWxzLnNob3cuYmx1ZVRpcChcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhc2VVdGlscy5zaG93LmJsdWVUaXAoXCLkv53lrZjmiJDlip9cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYXNlVXRpbHMuc2hvdy5ibHVlVGlwKFwi5Yib5bu65oiQ5YqfXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRhLmlzX25ldyA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy9zbWFsbENvbW11bml0eS9jb21tdW5pdHlMaXN0P2lzX25ldz0nICsgMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvc21hbGxDb21tdW5pdHkvY29tbXVuaXR5TGlzdCc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXRMaW1pdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhc2VVdGlscy5zaG93LnJlZFRpcChkYXRhLm1zZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbiAoeGhyLCBzdGF0dXMsIGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VibWl0TGltaXQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhc2VVdGlscy5zaG93LnJlZFRpcCgn572R57uc6ZSZ6K+v77yM6K+356iN5ZCO5YaN6K+V77yBJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gbWFuYWdlQ29tbXVuaXR5O1xyXG59KCk7Il19
