<template>
    <div class="alive-sidebar">
        <div class="alive-sidebar-title">
            <div class="alive-sidebar-text">自定义标题</div>
            <input class="alive-title-input" v-model="alive_part.part_title"/>
        </div>
        <div style="clear: both"></div>
        <div class="alive-sidebar-rule">
            <div class="alive-sidebar-text">显示规则</div>
            <div class="alive-sidebar-radio">
                <input type="radio" id="default" value="0" v-model="alive_part.status">
                <label for="default">默认（显示全部内容）</label>
                <br>
                <input type="radio" id="diy" value="1" v-model="alive_part.status">
                <label for="diy">自定义内容</label>
            </div>
        </div>
        <div style="clear: both"></div>
        <div class="alive-sidebar-action">
            <div class="alive-sidebar-choose">
                <img src="/images/admin/shopDiy/icon-add-sidebar@2x.png"><span>选择直播</span>
            </div>

            <draggable class="drag-group" v-model="alive_list" :options="dragOptions" :move="onMove"
                       @start="isDragging=true" @end="isDragging=false">
                <transition-group type="transition" :name="'flip-list'">
                    <div class="drag-group-item" v-for="(item,index) in alive_list" :key="item.order"
                         @mouseover="mouseOverShow(index)" :class="{blueColor:isActive==index}">

                        <alive_drag_item :alive_item="item.alive_item"></alive_drag_item>

                        <div class="alive-show-tip-wrap" v-show="isActive==index">
                            <img src="/images/admin/shopDiy/icon-drag-small@2x.png"/>
                            <img @click="onDelete(index)" class="delete" src="/images/admin/shopDiy/icon-delete@2x.png"/>
                        </div>

                    </div>
                </transition-group>
            </draggable>
        </div>
    </div>
</template>

<script>
    import draggable from 'vuedraggable';
    import EventBus from '../../../libs/eventbus';
    import alive_drag_item from './alive_drag_item.vue';
    export default {
        props:['alive_part'],
        data:function () {
            return {
                alive_list: [],
                isDragging: false,
                delayedDragging: false,
                isActive: 0
            };
        },
        created:function () {
            this.alive_list = this.alive_part.list.map((item, index) => {
                return {alive_item: item, order: index + 1};
            });
        },
        methods:{
            onMove: function () {
            },
            mouseOverShow: function (index) {
                this.isActive = index;
            },
            onDelete: function (index) {
                this.alive_list.splice(index,1);
            },
        },
        computed: {
            dragOptions () {
                return {
                    animation: 150,
                    group: 'alive',
                    ghostClass: 'ghost'
                };
            }
        },
        watch: {
            isDragging (newValue) {
                if (newValue) {
                    this.delayedDragging = true;
                    return
                }
                this.$nextTick(() => {
                    this.delayedDragging = false;
                    console.log(this.alive_list);
                })
            }
        },
        components:{
            draggable,
            alive_drag_item
        }
    }
</script>

<style>
    .flip-list-move {
        transition: transform 0.5s;
    }

    .ghost {
        opacity: .5;
        background: #C8EBFB;
    }

    .drag-group-item {
        position: relative;
        cursor: move;
    }
    .alive-sidebar {
        padding: 10px 0;
    }
    .alive-sidebar-title {
        width: 100%;
        height: 36px;
        line-height: 36px;
    }
    .alive-sidebar-text {
        float: left;
        width: 70px;
        margin-right: 20px;
    }
    .alive-title-input {
        float: left;
        display: block;
        width: 468px;
        height: 100%;
        border: 1px solid #e5e5e5;
        padding: 0 10px;
    }
    .alive-sidebar-rule {
        width: 100%;
        height: 80px;
        margin-top: 30px;
    }
    .alive-sidebar-radio {
        float: left;
        width: 468px;
        height: 100%;
        margin-top: -6px;
        margin-left: -3px;
    }
    .alive-sidebar-action {
        width: 466px;
        margin-left: 90px;
        border-radius: 2px;
        background-color: #ffffff;
        border: solid 1px #e5e5e5;
        padding: 10px;
    }
    .alive-sidebar-choose {
        width: 92px;
        height: 34px;
        line-height: 34px;
        border-radius: 2px;
        border: dashed 1px #2a75ed;
        font-size: 14px;
        color: #2a75ed;
        text-align: center;
        margin-bottom: 15px;
        cursor: pointer;
    }
    .alive-sidebar-choose img {
        width: 10px;
        height: 10px;
        margin-right: 10px;
        vertical-align: middle;
        margin-top: -3px;
    }
    .blueColor {
        background-color: #f6faff;
    }
    .alive-show-tip-wrap {
        position: absolute;
        top: 50%;
        right: 10px;
        margin-top: -6px;
        font-size: 0;
        z-index: 4;
    }
    .alive-show-tip-wrap img {
        display: inline-block;
        width: 12px;
        height: 12px;
    }
    .alive-show-tip-wrap .delete {
        margin-left: 10px;
        cursor: pointer;
    }
</style>