<?php
$pageData = [];
$pageData['sideActive'] = 'communityOperate';
$pageData['barTitle'] = '社群运营';
?>
@extends('admin.baseLayout',$pageData)

@section("page_css")

    <link type="text/css" rel="stylesheet" href="../css/admin/communityOperate/manageDynamic.css?{{env('timestamp')}}">

@stop

@section('ahead_js')
    {{--文本编辑器--}}
    <script type="text/javascript" src="../ueditor/ueditor.config.js" ></script>
    <script type="text/javascript" src="../ueditor/ueditor.all.min.js" ></script>
@stop

@section("page_js")
    {{--腾讯云上传js--}}
    <script type="text/javascript" src="../sdk/cos-js-sdk-v4.js"></script>
    <script type="text/javascript" src="../js/admin/utils/v4QcloudUpload.js"></script>
    {{--获取文件MD5--}}
    <script type="text/javascript" src="../js/external/browser-md5-file.js"></script>
    {{--上传工具类--}}
    <script type="text/javascript" src="../js/admin/utils/upload.js?{{env('timestamp')}}"></script>
    {{--表单检查工具类--}}
    <script type="text/javascript" src="../js/admin/utils/formCheck.js?{{env('timestamp')}}"></script>

    <script type="text/javascript" src="../js/admin/communityOperate/manageDynamic.js?{{env('timestamp')}}"></script>

@stop

@section("base_mainContent")

    <input type="hidden" id="xcx_app_id" value="{{session("app_id","")}}"/>     {{--用于 js 获取 appId--}}

    <input id="admin_data" type="hidden" data-type="{{$type}}"
           @if($type)
                data-community_id="{{$dynamic_info->community_id}}"
           @else
                data-community_id="{{$community_id}}"
           @endif
    >

    <div class="pageTopTitle">
        <a href="/community_operate">社群运营</a>
        &gt;
        <a href="/smallCommunity/communityList">小社群</a>
        &gt;
        <a  @if($type)
                href="/smallCommunity/dynamicList?community_id={{$dynamic_info->community_id}}"
            @else
                href="/smallCommunity/dynamicList?community_id={{$community_id}}"
            @endif
        >社群详情
        </a>
        &gt;
        发布动态
    </div>

    <div class="baseItemWrapper baseItemTitle">
        <div class="baseTitleLeft">
            标题名称<span class="starIcon">*</span>
        </div>
        <div class="baseContentRight">
            <input class="inputDefault inputDynamicTitle" id="dynamicTitle" placeholder="请输入标题名称"
                @if($type) value="{{$dynamic_info->title}}" @endif >
        </div>
    </div>
    <div class="baseItemWrapper baseItemContent">
        <div class="baseTitleLeft">
            动态内容<span class="starIcon">*</span>
        </div>
        <div class="baseContentRight">
            @if($type)
                <input id="rubbish" type="hidden" value="{{$dynamic_info->org_content}}" />
            @endif
            <div class="resDescribe">
                <script id="container" type="text/plain"></script>
                <script type="text/javascript">
                    var ue = UE.getEditor('container', ueditor_config);
                    @if($type)                          {{--判断是否需要初始化--}}
                        ue.ready(function () {
                            ue.setContent($("#rubbish").val());
                        });
                    @endif
                </script>
            </div>
        </div>
    </div>

    <div class="baseItemWrapper baseItemFileUpload">
        <div class="baseTitleLeft">

        </div>
        <div class="baseContentRight">
            <div class="uploadFileBtnWrapper">
                <div class="xeBtnDefault btnMid uploadFileBtn" id="uploadFile">上传文件</div>
                <div class="uploadFileTip">仅支持pdf格式，大小限制为20Mb</div>

                <input class="selectPdfFileInput" id="selectPdfFile" type="file" accept="application/pdf"/>
                <input type="text" class="uploadedFileUrlInput hide" id="uploadedFileUrl"
                    @if($type && !empty($dynamic_info->file_url))
                        data-file_url="{{$dynamic_info->file_url}}"
                        data-file_name="{{$dynamic_info->file_name}}"
                        data-file_size="{{$dynamic_info->file_size}}"
                    @else
                        data-file_url=""
                        data-file_name=""
                        data-file_size=""
                    @endif
                />
            </div>

            <div class="uploadBox uploadBoxPdf" style="@if($type && !empty($dynamic_info->file_url)) display: block; @else display: none; @endif">
                <div class="pdfFileIconWrapper">
                    <img class="pdfFileIcon" src="/images/admin/communityOperate/pdf_icon.png">
                </div>
                <div class="uploadProgress">
                    <div class="uploadPTitle uploadPdfName">
                        @if($type && !empty($dynamic_info->file_url)) {{$dynamic_info->file_name}} @endif
                    </div>
                    <div class="uploadPSize uploadPdfSize hide">{{--暂时先隐藏--}}
                        (<span>@if($type && !empty($dynamic_info->file_url)){{$dynamic_info->file_size}}@endif</span>M)
                    </div>
                    <div class="uploadPLine uploadPLinePdf" style="@if($type && !empty($dynamic_info->file_url)) display: none; @else display: block; @endif">
                        <div class="uploadPLineActive uploadPLineActivePdf">
                        </div>
                    </div>
                </div>
                <div class="uploadPercent uploadPercentPdf" id="deleteUploadedPdfFile">
                    @if($type && !empty($dynamic_info->file_url))删除@endif
                </div>
            </div>

        </div>
    </div>

    <div class="baseItemTip">
        (管理台发布的动态将以群主身份发送)
    </div>
    <div class="horizontalDivideLine"></div>

    <div class="btnBlue btnMid releaseDynamicBtn" id="releaseDynamic">@if($type)保存编辑@else发布动态@endif</div>

@stop

@section('base_modal')
    {{--编辑后离开页面的提示--}}
    @include('admin.actionTips.leaveTips')

@stop