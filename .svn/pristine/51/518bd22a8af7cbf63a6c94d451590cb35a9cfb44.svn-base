$(function(){manageCommunity.init()});var manageCommunity=function(){var e={};var i=false;e.isCommunityShow=false;var t,n;function a(e){var i=new RegExp("(^|&)"+e+"=([^&]*)(&|$)");var t=window.location.search.substr(1).match(i);if(t!=null)return unescape(t[2]);return null}function l(e){var i=null;if(window.createObjectURL!=undefined){i=window.createObjectURL(e)}else if(window.URL!=undefined){i=window.URL.createObjectURL(e)}else if(window.webkitURL!=undefined){i=window.webkitURL.createObjectURL(e)}return i}function s(e){if(window.revokeObjectURL!=undefined){window.revokeObjectURL(e)}else if(window.URL!=undefined){window.URL.revokeObjectURL(e)}else if(window.webkitURL!=undefined){window.webkitURL.revokeObjectURL(e)}}function o(e,i,t,n){if($formCheck.emptyString(e.title)){baseUtils.show.redTip("社群名称不能为空");return false}if(e.title.length>15){baseUtils.show.redTip("社群名称不能超过15个字符");return false}if($formCheck.emptyString(e.describe)){baseUtils.show.redTip("社群简介不能为空！");return false}if(e.describe.length>40){baseUtils.show.redTip("社群简介不能超过40个字符");return false}if($formCheck.emptyString(e.img_url)){baseUtils.show.redTip("请上传社群封面！");return false}if(!i&&!t){baseUtils.show.redTip("请选择至少一种加入形式");return false}if(i&&$formCheck.emptyString(e.piece_price)){baseUtils.show.redTip("请填入单卖价格！");return false}if(i&&e.piece_price>baseUtils.maxInputPrice*100){baseUtils.show.redTip("价格不能大于 "+baseUtils.maxInputPrice+" 元");return false}if(t&&n.length==0){baseUtils.show.redTip("请选择您要关联的专栏或会员！");return false}return true}function c(e,i,a,o){console.log(e);if(e&&e.length>0){var c=e[0];var r=l(c);t=(c.size/(1024*1024)).toFixed(2);n=c.duration;if($uploadFile.checkFileSize(c,o)){$uploadFile.uploadRes(c,i,function(e){},function(e){console.log(e);baseUtils.show.blueTip("上传成功！");resUrl=e.data.access_url;console.log(resUrl);$("#imgUrl").val(resUrl);if(i=="image"){$("#reBackImg").load(function(){s(r)}).attr("src",r)}},function(e){console.error("上传失败!!!");console.log(e);baseUtils.show.redTip("上传失败！")})}else{baseUtils.show.redTip("上传资源限制在"+o+"MB内！");$(".upLoad"+a).val("")}}else{baseUtils.show.redTip("网络错误，请稍后再试！")}}e.init=function(){$("#uploadImage").on("change",function(){c(this.files,"image","reBackImg",5)});$(".resAddSectionC").on("click",".setFee",function(){if($("#setFee").is(":checked")){$("#setPrice").attr("readonly","readonly");$("#setPrice").attr("disabled","disabled")}else{$("#setPrice").removeAttr("readonly");$("#setPrice").removeAttr("disabled")}});$(".resAddSectionC").on("click",".setRelevance",function(){if($("#setRelevance").is(":checked")){$("#relevanceContent").fadeOut(200)}else{$("#relevanceContent").fadeIn(200)}});$("#packageType").on("change",function(){if($("#package").is(":selected")){$("#memberSel").val("none");$(this).next().show();$(this).next().next().hide()}else{$("#packageSel").val("none");$(this).next().hide();$(this).next().next().show()}});$("#newRelevance").click(function(){$("#newRelevance").hide();$(".selectRelevance").show()});$("#removeRelevance").click(function(){$("#newRelevance").show();$(".selectRelevance").hide();$("#packageType").val("package");$("#packageSel").val("none");$("#memberSel").val("none");$("#memberSel").hide();$("#packageSel").show()});$("#addRelevance").click(function(){var e=$(".packageSelect:visible option:selected").data("product_id");for(var i=0;i<$(".oneRelevance").length;i++){var t=$(".oneRelevance").eq(i).data("product_id");if(e==t){baseUtils.show.redTip("请勿重复选择");return false}}if($(".packageSelect:visible").val()=="none"){baseUtils.show.redTip("请选择您当前要关联的会员或专栏")}else{var n=$("#packageType option:selected").text(),a=$(".packageSelect:visible option:selected").text(),l='<div class="oneRelevance clearfix" data-product_id="'+e+'">'+'<div class="packageClass">'+n+"</div>"+'<div class="packageName" title="'+a+'">'+a+"</div>"+'<button type="cancel" class="xeBtnDefault btnMid cancelRelevance">取消关联</button>'+"</div>";$("#relevanceContent").append(l);$("#removeRelevance").click()}});$(".secondCheckbox").on("click",".cancelRelevance",function(){$(this).parent().remove()});$(".base_mainContent").on("click","#saveBtn",function(){if(i){baseUtils.show.redTip("不能重复提交")}else{var e=$.trim($("#pageType").val()),t=$.trim($("#title").val()),n=$.trim($("#intro").val()),l=$.trim($("#imgUrl").val()),s=$("#setFee").is(":checked"),c=$.trim($("#setPrice").val())*100;if(!s){c=null}var r=$("#setRelevance").is(":checked");var d=[];if(r){for(var u=0,f=0;u<$(".oneRelevance").length;u++){var m={};m[u]=$(".oneRelevance").eq(u).data("product_id");if(m[u]){d[f]=m;f++}}}else{d=null}var v=$("input[name='isCommunityShow']:checked").val();if(e==0){var p={title:t,describe:n,img_url:l,piece_price:c,product_id:JSON.stringify(d),community_state:v}}else{var w=a("id");var p={id:w,title:t,describe:n,img_url:l,piece_price:c,product_id:JSON.stringify(d),community_state:v}}if(o(p,s,r,d)){i=true;if(e==0){var h="uploadCommunity"}else{var h="updateCommunity"}console.log(h);$.ajax(h,{type:"POST",dataType:"json",data:p,success:function(t){if(parseInt(t.code)==0){if(e==1){if(t.free==1){var n="将免费社群修改为付费社群，已加入的用户需要重新付费进入，或您可以生成邀请码邀请用户进入。";$.alert(n,"info",{oktext:"我知道了",btn:2,onOk:function(){window.location.href="/smallCommunity/communityList"},onClose:function(){window.location.href="/smallCommunity/communityList"}});return false}else{baseUtils.show.blueTip("保存成功")}}else{baseUtils.show.blueTip("创建成功")}if(t.is_new==1){window.location.href="/smallCommunity/communityList?is_new="+1}else{window.location.href="/smallCommunity/communityList"}}else{i=false;baseUtils.show.redTip(t.msg)}},error:function(e,t,n){i=false;console.error(n);baseUtils.show.redTip("网络错误，请稍后再试！")}})}}})};return e}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hbmFnZUNvbW11bml0eS5qcyJdLCJuYW1lcyI6WyIkIiwibWFuYWdlQ29tbXVuaXR5IiwiaW5pdCIsInN1Ym1pdExpbWl0IiwiaXNDb21tdW5pdHlTaG93IiwiZmlsZVNpemUiLCJyZXNBdWRpbzFMZW5naCIsIkdldFF1ZXJ5U3RyaW5nIiwibmFtZSIsInJlZyIsIlJlZ0V4cCIsInIiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInNlYXJjaCIsInN1YnN0ciIsIm1hdGNoIiwidW5lc2NhcGUiLCJnZXRPYmplY3RVUkwiLCJmaWxlIiwidXJsIiwiY3JlYXRlT2JqZWN0VVJMIiwidW5kZWZpbmVkIiwiVVJMIiwid2Via2l0VVJMIiwicmVtb3ZlT2JqZWN0VVJMIiwicmV2b2tlT2JqZWN0VVJMIiwiY2hlY2tDb21tdW5pdHlGb3JtIiwiaW5mbyIsInNpbmdsZVNhbGUiLCJyZWxldmFuY2UiLCJwcm9kdWN0X2lkIiwiJGZvcm1DaGVjayIsImVtcHR5U3RyaW5nIiwidGl0bGUiLCJiYXNlVXRpbHMiLCJzaG93IiwicmVkVGlwIiwibGVuZ3RoIiwiZGVzY3JpYmUiLCJpbWdfdXJsIiwicGllY2VfcHJpY2UiLCJtYXhJbnB1dFByaWNlIiwicmVzVXBsb2FkIiwiZmlsZXMiLCJyZXNUeXBlIiwicmVzVHlwZUNsYXNzIiwicmVzTGltaXRTaXplIiwiY29uc29sZSIsImxvZyIsInJlc291cmNlTG9jYWxVcmwiLCJzaXplIiwidG9GaXhlZCIsImR1cmF0aW9uIiwiJHVwbG9hZEZpbGUiLCJjaGVja0ZpbGVTaXplIiwidXBsb2FkUmVzIiwiZGF0YSIsImJsdWVUaXAiLCJyZXNVcmwiLCJhY2Nlc3NfdXJsIiwidmFsIiwibG9hZCIsImF0dHIiLCJlcnJvciIsIm9uIiwidGhpcyIsImlzIiwicmVtb3ZlQXR0ciIsImZhZGVPdXQiLCJmYWRlSW4iLCJuZXh0IiwiaGlkZSIsImNsaWNrIiwicHJvZHVjdElkIiwiaSIsImN1cnJlbnRJZCIsImVxIiwiRmlyc3RTZWxlY3RlZCIsInRleHQiLCJTZWNvbmREZXRhaWwiLCJodG1sU3RyaW5nIiwiYXBwZW5kIiwicGFyZW50IiwicmVtb3ZlIiwicGFnZVR5cGUiLCJ0cmltIiwiaiIsImlkQXJyYXkiLCJwYXJhbXMiLCJKU09OIiwic3RyaW5naWZ5IiwiY29tbXVuaXR5X3N0YXRlIiwiaWQiLCJhamF4VXJsIiwiYWpheCIsInR5cGUiLCJkYXRhVHlwZSIsInN1Y2Nlc3MiLCJwYXJzZUludCIsImNvZGUiLCJmcmVlIiwiYWxlcnQiLCJva3RleHQiLCJidG4iLCJvbk9rIiwiaHJlZiIsIm9uQ2xvc2UiLCJpc19uZXciLCJtc2ciLCJ4aHIiLCJzdGF0dXMiLCJlcnIiXSwibWFwcGluZ3MiOiJBQUFBQSxFQUFFLFdBQ0VDLGdCQUFnQkMsUUFJcEIsSUFBSUQsaUJBQWtCLFdBRWxCLEdBQUlBLEtBRUosSUFBSUUsR0FBYyxLQUVsQkYsR0FBZ0JHLGdCQUFrQixLQUVsQyxJQUFJQyxHQUNBQyxDQUdKLFNBQVNDLEdBQWVDLEdBQ3BCLEdBQUlDLEdBQU0sR0FBSUMsUUFBTyxRQUFVRixFQUFPLGdCQUN0QyxJQUFJRyxHQUFJQyxPQUFPQyxTQUFTQyxPQUFPQyxPQUFPLEdBQUdDLE1BQU1QLEVBQy9DLElBQUlFLEdBQUssS0FBTSxNQUFPTSxVQUFTTixFQUFFLEdBQ2pDLE9BQU8sTUFHWCxRQUFTTyxHQUFhQyxHQUNsQixHQUFJQyxHQUFNLElBQ1YsSUFBSVIsT0FBT1MsaUJBQW1CQyxVQUFXLENBQ3JDRixFQUFNUixPQUFPUyxnQkFBZ0JGLE9BQzFCLElBQUlQLE9BQU9XLEtBQU9ELFVBQVcsQ0FDaENGLEVBQU1SLE9BQU9XLElBQUlGLGdCQUFnQkYsT0FDOUIsSUFBSVAsT0FBT1ksV0FBYUYsVUFBVyxDQUN0Q0YsRUFBTVIsT0FBT1ksVUFBVUgsZ0JBQWdCRixHQUUzQyxNQUFPQyxHQUdYLFFBQVNLLEdBQWdCTCxHQUNyQixHQUFJUixPQUFPYyxpQkFBbUJKLFVBQVcsQ0FDckNWLE9BQU9jLGdCQUFnQk4sT0FDcEIsSUFBSVIsT0FBT1csS0FBT0Qs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QyxPQUFPb0IsRUFBS29ELE9BR25DN0MsTUFBTyxTQUFVOEMsRUFBS0MsRUFBUUMsR0FDMUI3RyxFQUFjLEtBQ2Q2QyxTQUFRZ0IsTUFBTWdELEVBQ2Q3RSxXQUFVQyxLQUFLQyxPQUFPLHNCQVM5QyxPQUFPcEMiLCJmaWxlIjoibWFuYWdlQ29tbXVuaXR5LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJChmdW5jdGlvbiAoKSB7XHJcbiAgICBtYW5hZ2VDb21tdW5pdHkuaW5pdCgpO1xyXG59KTtcclxuXHJcblxyXG52YXIgbWFuYWdlQ29tbXVuaXR5ID0gZnVuY3Rpb24gKCkge1xyXG5cclxuICAgIHZhciBtYW5hZ2VDb21tdW5pdHkgPSB7fTtcclxuXHJcbiAgICB2YXIgc3VibWl0TGltaXQgPSBmYWxzZTsgICAgIC8vIOihqOWNleaPkOS6pOmZkOWItuagh+iusFxyXG5cclxuICAgIG1hbmFnZUNvbW11bml0eS5pc0NvbW11bml0eVNob3cgPSBmYWxzZTsgICAgLy8gIOekvue+pOaYr+WQpuS4iuS4i+aetlxyXG5cclxuICAgIHZhciBmaWxlU2l6ZSxcclxuICAgICAgICByZXNBdWRpbzFMZW5naDtcclxuXHJcbiAgICAvL+iOt+WPluWcsOWdgOagj+WPguaVsFxyXG4gICAgZnVuY3Rpb24gR2V0UXVlcnlTdHJpbmcobmFtZSkge1xyXG4gICAgICAgIHZhciByZWcgPSBuZXcgUmVnRXhwKFwiKF58JilcIiArIG5hbWUgKyBcIj0oW14mXSopKCZ8JClcIik7XHJcbiAgICAgICAgdmFyIHIgPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoLnN1YnN0cigxKS5tYXRjaChyZWcpO1xyXG4gICAgICAgIGlmIChyICE9IG51bGwpIHJldHVybiB1bmVzY2FwZShyWzJdKTtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBnZXRPYmplY3RVUkwoZmlsZSkge1xyXG4gICAgICAgIHZhciB1cmwgPSBudWxsO1xyXG4gICAgICAgIGlmICh3aW5kb3cuY3JlYXRlT2JqZWN0VVJMICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB1cmwgPSB3aW5kb3cuY3JlYXRlT2JqZWN0VVJMKGZpbGUpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAod2luZG93LlVSTCAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZSk7XHJcbiAgICAgICAgfSBlbHNlIGlmICh3aW5kb3cud2Via2l0VVJMICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB1cmwgPSB3aW5kb3cud2Via2l0VVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHVybDtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiByZW1vdmVPYmplY3RVUkwodXJsKSB7Ly/ph4rmlL7otYTmupBVUkxcclxuICAgICAgICBpZiAod2luZG93LnJldm9rZU9iamVjdFVSTCAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgd2luZG93LnJldm9rZU9iamVjdFVSTCh1cmwpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAod2luZG93LlVSTCAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgd2luZG93LlVSTC5yZXZva2VPYmplY3RVUkwodXJsKTtcclxuICAgICAgICB9IGVsc2UgaWYgKHdpbmRvdy53ZWJraXRVUkwgIT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHdpbmRvdy53ZWJraXRVUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvL+ajgOafpeekvue+pOaPkOS6pOihqOWNlVxyXG4gICAgZnVuY3Rpb24gY2hlY2tDb21tdW5pdHlGb3JtKGluZm8sIHNpbmdsZVNhbGUsIHJlbGV2YW5jZSxwcm9kdWN0X2lkKSB7XHJcbiAgICAgICAgaWYgKCRmb3JtQ2hlY2suZW1wdHlTdHJpbmcoaW5mby50aXRsZSkpIHtcclxuICAgICAgICAgICAgYmFzZVV0aWxzLnNob3cucmVkVGlwKFwi56S+576k5ZCN56ew5LiN6IO95Li656m6XCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpbmZvLnRpdGxlLmxlbmd0aCA+IDE1KSB7XHJcbiAgICAgICAgICAgIGJhc2VVdGlscy5zaG93LnJlZFRpcChcIuekvue+pOWQjeensOS4jeiDvei2hei/hzE15Liq5a2X56ymXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoJGZvcm1DaGVjay5lbXB0eVN0cmluZyhpbmZvLmRlc2NyaWJlKSkge1xyXG4gICAgICAgICAgICBiYXNlVXRpbHMuc2hvdy5yZWRUaXAoXCLnpL7nvqTnroDku4vkuI3og73kuLrnqbrvvIFcIik7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGluZm8uZGVzY3JpYmUubGVuZ3RoID4gNDApIHtcclxuICAgICAgICAgICAgYmFzZVV0aWxzLnNob3cucmVkVGlwKFwi56S+576k566A5LuL5LiN6IO96LaF6L+HNDDkuKrlrZfnrKZcIik7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICgkZm9ybUNoZWNrLmVtcHR5U3RyaW5nKGluZm8uaW1nX3VybCkpIHtcclxuICAgICAgICAgICAgYmFzZVV0aWxzLnNob3cucmVkVGlwKFwi6K+35LiK5Lyg56S+576k5bCB6Z2i77yBXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXNpbmdsZVNhbGUgJiYgIXJlbGV2YW5jZSkge1xyXG4gICAgICAgICAgICBiYXNlVXRpbHMuc2hvdy5yZWRUaXAoXCLor7fpgInmi6noh7PlsJHkuIDnp43liqDlhaXlvaLlvI9cIik7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChzaW5nbGVTYWxlICYmICRmb3JtQ2hlY2suZW1wdHlTdHJpbmcoaW5mby5waWVjZV9wcmljZSkpIHtcclxuICAgICAgICAgICAgYmFzZVV0aWxzLnNob3cucmVkVGlwKFwi6K+35aGr5YWl5Y2V5Y2W5Lu35qC877yBXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzaW5nbGVTYWxlICYmIGluZm8ucGllY2VfcHJpY2UgPiBiYXNlVXRpbHMubWF4SW5wdXRQcmljZSAqIDEwMCkge1xyXG4gICAgICAgICAgICBiYXNlVXRpbHMuc2hvdy5yZWRUaXAoXCLku7fmoLzkuI3og73lpKfkuo4gXCIgKyBiYXNlVXRpbHMubWF4SW5wdXRQcmljZSArIFwiIOWFg1wiKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHJlbGV2YW5jZSAmJiBwcm9kdWN0X2lkLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgIGJhc2VVdGlscy5zaG93LnJlZFRpcChcIuivt+mAieaLqeaCqOimgeWFs+iBlOeahOS4k+agj+aIluS8muWRmO+8gVwiKTtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgLy/otYTmupDkuIrkvKDlh73mlbAo5Y+C5pWw77yacmVzVHlwZTrotYTmupDnsbvlnosscmVzVHlwZUNsYXNzOui1hOa6kOexu+Wei+S4ree7huWIhueahOenjeexuyxyZXNMaW1pdFNpemU66LWE5rqQ6ZmQ5Yi25aSn5bCPKVxyXG4gICAgZnVuY3Rpb24gcmVzVXBsb2FkKGZpbGVzLCByZXNUeXBlLCByZXNUeXBlQ2xhc3MsIHJlc0xpbWl0U2l6ZSkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGZpbGVzKTtcclxuICAgICAgICBpZiAoZmlsZXMgJiYgZmlsZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICB2YXIgZmlsZSA9IGZpbGVzWzBdO1xyXG4gICAgICAgICAgICB2YXIgcmVzb3VyY2VMb2NhbFVybCA9IGdldE9iamVjdFVSTChmaWxlKTtcclxuICAgICAgICAgICAgZmlsZVNpemUgPSAoZmlsZS5zaXplIC8gKDEwMjQgKiAxMDI0KSkudG9GaXhlZCgyKTtcclxuICAgICAgICAgICAgcmVzQXVkaW8xTGVuZ2ggPSBmaWxlLmR1cmF0aW9uO1xyXG4gICAgICAgICAgICAvLyDpmZDliLbotYTmupDlnKgqTULlhoVcclxuICAgICAgICAgICAgaWYgKCR1cGxvYWRGaWxlLmNoZWNrRmlsZVNpemUoZmlsZSwgcmVzTGltaXRTaXplKSkge1xyXG4gICAgICAgICAgICAgICAgJHVwbG9hZEZpbGUudXBsb2FkUmVzKGZpbGUsIHJlc1R5cGUsIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAvLyDkuIrkvKDmiJDlip/lm57osINcclxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYmFzZVV0aWxzLnNob3cuYmx1ZVRpcChcIuS4iuS8oOaIkOWKn++8gVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzVXJsID0gZGF0YS5kYXRhLmFjY2Vzc191cmw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc1VybCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjaW1nVXJsXCIpLnZhbChyZXNVcmwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDlpoLmnpzmmK/lm77niYfotYTmupDvvIzliJnlsZXnpLrlm77niYfpooTop4hcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc1R5cGUgPT0gJ2ltYWdlJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/nm7TmjqXliqDovb3mnKzlnLDlm77niYfov5vooYzpooTop4hcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoXCIjcmVCYWNrSW1nXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmxvYWQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZW1vdmVPYmplY3RVUkwocmVzb3VyY2VMb2NhbFVybCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXR0cihcInNyY1wiLCByZXNvdXJjZUxvY2FsVXJsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgIC8vIOS4iuS8oOWksei0peWbnuiwg1xyXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCLkuIrkvKDlpLHotKUhISFcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiYXNlVXRpbHMuc2hvdy5yZWRUaXAoXCLkuIrkvKDlpLHotKXvvIFcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBiYXNlVXRpbHMuc2hvdy5yZWRUaXAoXCLkuIrkvKDotYTmupDpmZDliLblnKhcIiArIHJlc0xpbWl0U2l6ZSArIFwiTULlhoXvvIFcIik7XHJcbiAgICAgICAgICAgICAgICAkKFwiLnVwTG9hZFwiICsgcmVzVHlwZUNsYXNzKS52YWwoXCJcIik7XHJcblxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgYmFzZVV0aWxzLnNob3cucmVkVGlwKFwi572R57uc6ZSZ6K+v77yM6K+356iN5ZCO5YaN6K+V77yBXCIpO1xyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhmaWxlcylcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbWFuYWdlQ29tbXVuaXR5LmluaXQgPSBmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgIC8vIOeCueWHu+aMiemSruS4iuS8oOWbvueJh1xyXG4gICAgICAgICQoXCIjdXBsb2FkSW1hZ2VcIikub24oXCJjaGFuZ2VcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXNVcGxvYWQodGhpcy5maWxlcywgXCJpbWFnZVwiLCBcInJlQmFja0ltZ1wiLCA1KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy/ljZXljZborr7nva5cclxuICAgICAgICAkKFwiLnJlc0FkZFNlY3Rpb25DXCIpLm9uKFwiY2xpY2tcIiwgXCIuc2V0RmVlXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCQoXCIjc2V0RmVlXCIpLmlzKCc6Y2hlY2tlZCcpKSB7XHJcbiAgICAgICAgICAgICAgICAkKFwiI3NldFByaWNlXCIpLmF0dHIoXCJyZWFkb25seVwiLCBcInJlYWRvbmx5XCIpO1xyXG4gICAgICAgICAgICAgICAgJChcIiNzZXRQcmljZVwiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJkaXNhYmxlZFwiKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICQoXCIjc2V0UHJpY2VcIikucmVtb3ZlQXR0cihcInJlYWRvbmx5XCIpO1xyXG4gICAgICAgICAgICAgICAgJChcIiNzZXRQcmljZVwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gIOWFs+iBlOmDqOWIhueahOW8gOWQr+WSjOWFs+mXrVxyXG4gICAgICAgICQoXCIucmVzQWRkU2VjdGlvbkNcIikub24oXCJjbGlja1wiLCBcIi5zZXRSZWxldmFuY2VcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoJChcIiNzZXRSZWxldmFuY2VcIikuaXMoJzpjaGVja2VkJykpIHtcclxuICAgICAgICAgICAgICAgICQoXCIjcmVsZXZhbmNlQ29udGVudFwiKS5mYWRlT3V0KDIwMCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAkKFwiI3JlbGV2YW5jZUNvbnRlbnRcIikuZmFkZUluKDIwMCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy/lhbPogZTlhoXlrrnliIfmjaJcclxuICAgICAgICAkKFwiI3BhY2thZ2VUeXBlXCIpLm9uKFwiY2hhbmdlXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCQoXCIjcGFja2FnZVwiKS5pcygnOnNlbGVjdGVkJykpIHtcclxuICAgICAgICAgICAgICAgICQoXCIjbWVtYmVyU2VsXCIpLnZhbChcIm5vbmVcIik7XHJcbiAgICAgICAgICAgICAgICAkKHRoaXMpLm5leHQoKS5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICAkKHRoaXMpLm5leHQoKS5uZXh0KCkuaGlkZSgpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgJChcIiNwYWNrYWdlU2VsXCIpLnZhbChcIm5vbmVcIik7XHJcbiAgICAgICAgICAgICAgICAkKHRoaXMpLm5leHQoKS5oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICAkKHRoaXMpLm5leHQoKS5uZXh0KCkuc2hvdygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8v5re75Yqg5YWz6IGUXHJcbiAgICAgICAgJChcIiNuZXdSZWxldmFuY2VcIikuY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkKFwiI25ld1JlbGV2YW5jZVwiKS5oaWRlKCk7XHJcbiAgICAgICAgICAgICQoXCIuc2VsZWN0UmVsZXZhbmNlXCIpLnNob3coKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy/lj5bmtojpgInkuK3nmoTlhbPogZRcclxuICAgICAgICAkKFwiI3JlbW92ZVJlbGV2YW5jZVwiKS5jbGljayhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICQoXCIjbmV3UmVsZXZhbmNlXCIpLnNob3coKTtcclxuICAgICAgICAgICAgJChcIi5zZWxlY3RSZWxldmFuY2VcIikuaGlkZSgpO1xyXG5cclxuICAgICAgICAgICAgJChcIiNwYWNrYWdlVHlwZVwiKS52YWwoXCJwYWNrYWdlXCIpO1xyXG4gICAgICAgICAgICAkKFwiI3BhY2thZ2VTZWxcIikudmFsKFwibm9uZVwiKTtcclxuICAgICAgICAgICAgJChcIiNtZW1iZXJTZWxcIikudmFsKFwibm9uZVwiKTtcclxuICAgICAgICAgICAgJChcIiNtZW1iZXJTZWxcIikuaGlkZSgpXHJcbiAgICAgICAgICAgICQoXCIjcGFja2FnZVNlbFwiKS5zaG93KCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8v5L+d5a2Y6YCJ5Lit55qE5YWz6IGUXHJcbiAgICAgICAgJChcIiNhZGRSZWxldmFuY2VcIikuY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgcHJvZHVjdElkID0gJChcIi5wYWNrYWdlU2VsZWN0OnZpc2libGUgb3B0aW9uOnNlbGVjdGVkXCIpLmRhdGEoXCJwcm9kdWN0X2lkXCIpO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkKFwiLm9uZVJlbGV2YW5jZVwiKS5sZW5ndGg7IGkrKykgeyAgICAgICAvL+WIpOWumuaYr+WQpumHjeWkjeWFs+iBlFxyXG5cclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50SWQgPSAkKFwiLm9uZVJlbGV2YW5jZVwiKS5lcShpKS5kYXRhKCdwcm9kdWN0X2lkJyk7XHJcbiAgICAgICAgICAgICAgICBpZiAocHJvZHVjdElkID09IGN1cnJlbnRJZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJhc2VVdGlscy5zaG93LnJlZFRpcCgn6K+35Yu/6YeN5aSN6YCJ5oupJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICgkKFwiLnBhY2thZ2VTZWxlY3Q6dmlzaWJsZVwiKS52YWwoKSA9PSAnbm9uZScpIHtcclxuICAgICAgICAgICAgICAgIGJhc2VVdGlscy5zaG93LnJlZFRpcCgn6K+36YCJ5oup5oKo5b2T5YmN6KaB5YWz6IGU55qE5Lya5ZGY5oiW5LiT5qCPJyk7XHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgIHZhciBGaXJzdFNlbGVjdGVkID0gJChcIiNwYWNrYWdlVHlwZSBvcHRpb246c2VsZWN0ZWRcIikudGV4dCgpLFxyXG4gICAgICAgICAgICAgICAgICAgIFNlY29uZERldGFpbCA9ICQoXCIucGFja2FnZVNlbGVjdDp2aXNpYmxlIG9wdGlvbjpzZWxlY3RlZFwiKS50ZXh0KCksXHJcbiAgICAgICAgICAgICAgICAgICAgaHRtbFN0cmluZyA9XHJcbiAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJvbmVSZWxldmFuY2UgY2xlYXJmaXhcIiBkYXRhLXByb2R1Y3RfaWQ9XCInICsgcHJvZHVjdElkICsgJ1wiPicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cInBhY2thZ2VDbGFzc1wiPicgKyBGaXJzdFNlbGVjdGVkICsgJzwvZGl2PicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cInBhY2thZ2VOYW1lXCIgdGl0bGU9XCInICsgU2Vjb25kRGV0YWlsICsgJ1wiPicgKyBTZWNvbmREZXRhaWwgKyAnPC9kaXY+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICc8YnV0dG9uIHR5cGU9XCJjYW5jZWxcIiBjbGFzcz1cInhlQnRuRGVmYXVsdCBidG5NaWQgY2FuY2VsUmVsZXZhbmNlXCI+5Y+W5raI5YWz6IGUPC9idXR0b24+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgJzwvZGl2Pic7XHJcblxyXG4gICAgICAgICAgICAgICAgJChcIiNyZWxldmFuY2VDb250ZW50XCIpLmFwcGVuZChodG1sU3RyaW5nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkKFwiI3JlbW92ZVJlbGV2YW5jZVwiKS5jbGljaygpO1xyXG5cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9KTtcclxuXHJcblxyXG4gICAgICAgIC8v5Y+W5raI5bey5YWz6IGU55qE5LiT5qCP5oiW5Lya5ZGYXHJcbiAgICAgICAgJChcIi5zZWNvbmRDaGVja2JveFwiKS5vbihcImNsaWNrXCIsIFwiLmNhbmNlbFJlbGV2YW5jZVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICQodGhpcykucGFyZW50KCkucmVtb3ZlKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG5cclxuICAgICAgICAvL+aPkOS6pOihqOWNlVxyXG4gICAgICAgICQoXCIuYmFzZV9tYWluQ29udGVudFwiKS5vbihcImNsaWNrXCIsICcjc2F2ZUJ0bicsIGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgICAgICAgIGlmIChzdWJtaXRMaW1pdCkge1xyXG4gICAgICAgICAgICAgICAgYmFzZVV0aWxzLnNob3cucmVkVGlwKFwi5LiN6IO96YeN5aSN5o+Q5LqkXCIpO1xyXG5cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuXHJcblxyXG4gICAgICAgICAgICAgICAgdmFyIHBhZ2VUeXBlID0gJC50cmltKCQoXCIjcGFnZVR5cGVcIikudmFsKCkpLCAgICAvLyAg6I635Y+W6aG16Z2i57G75Z6LXHJcbiAgICAgICAgICAgICAgICAgICAgdGl0bGUgPSAkLnRyaW0oJChcIiN0aXRsZVwiKS52YWwoKSksICAgICAgICAgIC8vICDojrflj5booajljZXmlbDmja4vLyAg6I635Y+W56S+576k5ZCN56ewXHJcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpYmUgPSAkLnRyaW0oJChcIiNpbnRyb1wiKS52YWwoKSksICAgICAgIC8vICDojrflj5bnpL7nvqTnroDku4tcclxuICAgICAgICAgICAgICAgICAgICBpbWdfdXJsID0gJC50cmltKCQoXCIjaW1nVXJsXCIpLnZhbCgpKSwgICAgICAgLy8gIOiOt+WPluWwgemdouWbvueJh1xyXG4gICAgICAgICAgICAgICAgICAgIHNpbmdsZVNhbGUgPSAkKFwiI3NldEZlZVwiKS5pcygnOmNoZWNrZWQnKSwgICAvLyAg6I635Y+W5Y2V5Y2WY2hlY2vnirbmgIFcclxuICAgICAgICAgICAgICAgICAgICBwaWVjZV9wcmljZSA9ICQudHJpbSgkKFwiI3NldFByaWNlXCIpLnZhbCgpKSAqIDEwMDsgICAvLyAg6I635Y+W5Y2V5Y2W5Lu35qC8XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFzaW5nbGVTYWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGllY2VfcHJpY2UgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHZhciByZWxldmFuY2UgPSAkKFwiI3NldFJlbGV2YW5jZVwiKS5pcygnOmNoZWNrZWQnKTsgICAgICAvLyAg6I635Y+W5YWz6IGUY2hlY2vnirbmgIFcclxuXHJcbiAgICAgICAgICAgICAgICB2YXIgcHJvZHVjdF9pZCA9IFtdOyAgICAvLyAg6I635Y+W5YWz6IGUaWRcclxuICAgICAgICAgICAgICAgIGlmIChyZWxldmFuY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaiA9IDA7IGkgPCAkKFwiLm9uZVJlbGV2YW5jZVwiKS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL+WFs+iBlOS4k+agj+WSjOS8muWRmOeahGlk5YC8XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZEFycmF5ID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkQXJyYXlbaV0gPSAkKFwiLm9uZVJlbGV2YW5jZVwiKS5lcShpKS5kYXRhKCdwcm9kdWN0X2lkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZEFycmF5W2ldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9kdWN0X2lkW2pdID0gaWRBcnJheTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGorKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvZHVjdF9pZCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gIOiOt+WPluekvue+pOaYr+WQpuS4iuaetlxyXG4gICAgICAgICAgICAgICAgdmFyIGlzQ29tbXVuaXR5U2hvdyA9ICQoXCJpbnB1dFtuYW1lPSdpc0NvbW11bml0eVNob3cnXTpjaGVja2VkXCIpLnZhbCgpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8vICDnpL7nvqTkv6Hmga9cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAocGFnZVR5cGUgPT0gMCkgeyAgICAvLyAg5paw5bu656S+576kXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRpdGxlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmliZTogZGVzY3JpYmUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGltZ191cmw6IGltZ191cmwsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBpZWNlX3ByaWNlOiBwaWVjZV9wcmljZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvZHVjdF9pZDogSlNPTi5zdHJpbmdpZnkocHJvZHVjdF9pZCksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW11bml0eV9zdGF0ZTogaXNDb21tdW5pdHlTaG93ICAgICAgICAvLzAgLSDkuIrmnrYgIDEtIOS4i+aetlxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkID0gR2V0UXVlcnlTdHJpbmcoXCJpZFwiKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZDogaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aXRsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpYmU6IGRlc2NyaWJlLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbWdfdXJsOiBpbWdfdXJsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwaWVjZV9wcmljZTogcGllY2VfcHJpY2UsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb2R1Y3RfaWQ6IEpTT04uc3RyaW5naWZ5KHByb2R1Y3RfaWQpLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb21tdW5pdHlfc3RhdGU6IGlzQ29tbXVuaXR5U2hvd1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoY2hlY2tDb21tdW5pdHlGb3JtKHBhcmFtcywgc2luZ2xlU2FsZSwgcmVsZXZhbmNlLCBwcm9kdWN0X2lkKSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBzdWJtaXRMaW1pdCA9IHRydWU7ICAgICAvLyDooajljZXmj5DkuqTpmZDliLbmoIforrBcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBhZ2VUeXBlID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFqYXhVcmwgPSAndXBsb2FkQ29tbXVuaXR5JztcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWpheFVybCA9ICd1cGRhdGVDb21tdW5pdHknO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhhamF4VXJsKTtcclxuICAgICAgICAgICAgICAgICAgICAkLmFqYXgoYWpheFVybCwge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnUE9TVCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHBhcmFtcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJzZUludChkYXRhLmNvZGUpID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhZ2VUeXBlID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGRhdGEuZnJlZSA9PSAxKXtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRleHQgPSBcIuWwhuWFjei0ueekvue+pOS/ruaUueS4uuS7mOi0ueekvue+pO+8jOW3suWKoOWFpeeahOeUqOaIt+mcgOimgemHjeaWsOS7mOi0uei/m+WFpe+8jOaIluaCqOWPr+S7peeUn+aIkOmCgOivt+eggemCgOivt+eUqOaIt+i/m+WFpeOAglwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuYWxlcnQodGV4dCwnaW5mbycse1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBva3RleHQ6ICfmiJHnn6XpgZPkuoYnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBidG46IDIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uT2s6IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy9zbWFsbENvbW11bml0eS9jb21tdW5pdHlMaXN0JztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbG9zZTpmdW5jdGlvbiAoKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWY9Jy9zbWFsbENvbW11bml0eS9jb21tdW5pdHlMaXN0JztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBiYXNlVXRpbHMuc2hvdy5ibHVlVGlwKFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZVV0aWxzLnNob3cuYmx1ZVRpcChcIuS/neWtmOaIkOWKn1wiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhc2VVdGlscy5zaG93LmJsdWVUaXAoXCLliJvlu7rmiJDlip9cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuaXNfbmV3ID09IDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnL3NtYWxsQ29tbXVuaXR5L2NvbW11bml0eUxpc3Q/aXNfbmV3PScgKyAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy9zbWFsbENvbW11bml0eS9jb21tdW5pdHlMaXN0JztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym1pdExpbWl0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZVV0aWxzLnNob3cucmVkVGlwKGRhdGEubXNnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uICh4aHIsIHN0YXR1cywgZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXRMaW1pdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZVV0aWxzLnNob3cucmVkVGlwKCfnvZHnu5zplJnor6/vvIzor7fnqI3lkI7lho3or5XvvIEnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiBtYW5hZ2VDb21tdW5pdHk7XHJcbn0oKTsiXX0=
