<template>
    <div class="member-sidebar">
        <div class="alive-sidebar-title">
            <div class="alive-sidebar-text">自定义标题</div>
            <input class="alive-title-input" v-model="member_part.part_title"/>
        </div>
        <div style="clear: both"></div>
        <div class="alive-sidebar-rule">
            <div class="alive-sidebar-text">显示规则</div>
            <div class="alive-sidebar-radio">
                <input type="radio" id="default" value="0" v-model="member_part.status">
                <label for="default">默认（显示全部内容）</label>
                <br>
                <input type="radio" id="diy" value="1" v-model="member_part.status">
                <label for="diy">自定义内容</label>
            </div>
        </div>
        <div style="clear: both"></div>

        <div class="alive-sidebar-action">
            <div class="alive-sidebar-choose" @click="chooseMember">
                <img src="/images/admin/shopDiy/icon-add-sidebar@2x.png"><span>选择频道</span>
            </div>

            <draggable class="drag-group" v-model="member_list" :options="dragOptions" :move="onMove"
                       @start="isDragging=true" @end="isDragging=false">
                <transition-group type="transition" :name="'flip-list'">
                    <div class="drag-group-item" v-for="(item,index) in member_list" :key="item.order"
                         @mouseover="mouseOverShow(index)" :class="{blueColor:isActive==index}">

                        <member_drag_item :item="item.member_item" :label="item.member_item.is_member==0?'专栏':'会员'"></member_drag_item>

                        <div class="alive-show-tip-wrap" v-show="isActive==index">
                            <img src="/images/admin/shopDiy/icon-drag-small@2x.png"/>
                            <img @click="onDelete(index)" class="delete" src="/images/admin/shopDiy/icon-delete@2x.png"/>
                        </div>

                    </div>
                </transition-group>
            </draggable>
        </div>
    </div>
</template>

<script>
    import draggable from 'vuedraggable';
    import EventBus from '../../../libs/eventbus';
    import member_drag_item from '../alive_part/alive_drag_item.vue';
    export default {
        props:['member_part'],
        data:function () {
            return {
                member_list: [],
                isDragging: false,
                delayedDragging: false,
                isActive: 0
            };
        },
        created:function () {
            this.member_list = this.member_part.list.map((item, index) => {
                return {member_item: item, order: index + 1};
            });
        },
        methods:{
            onMove: function () {
            },
            mouseOverShow: function (index) {
                this.isActive = index;
            },
            onDelete: function (index) {
                this.member_list.splice(index,1);
            },
            chooseMember: function () {
                EventBus.$emit('is_show_choose_box',{type:'member'});
            }
        },
        computed: {
            dragOptions () {
                return {
                    animation: 150,
                    group: 'member',
                    ghostClass: 'ghost'
                };
            }
        },
        watch: {
            isDragging (newValue) {
                if (newValue) {
                    this.delayedDragging = true;
                    return
                }
                this.$nextTick(() => {
                    this.delayedDragging = false;
                    console.log(this.member_list);
                })
            }
        },
        components:{
            draggable,
            member_drag_item
        }
    }
</script>

<style>
    .member-sidebar {
        padding: 10px 0;
    }
</style>