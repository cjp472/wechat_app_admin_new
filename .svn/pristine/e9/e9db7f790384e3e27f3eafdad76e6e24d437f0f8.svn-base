var width;var height;var params={};var allParams={};var category_type;var resource_type;var isEditPic=false;var cos=new InitCosCloud;var maxlen=256;var cnmaxlen=Math.floor(maxlen/2);$(document).ready(function(){$("#maxletter").text(maxlen);$("#maxword").text(cnmaxlen);var e=$("#resource_summary");var a=$(e).val().replace(/[^\x00-\xff]/g,"**").length;if(a>maxlen){$(e).val($(e).val().substring(0,maxlen))}var r=a>maxlen?0:maxlen-a;var t=Math.floor(r/2);$("#letter").text(r);$("#word").text(t);$("#resource_title").on("blur keyup",function(){setMsgDim(this)});$("#resource_summary").on("blur keyup",function(){setMsgDim(this)});$(".header_level.left").click(function(){window.location.href="/package_list"})});$(function(){$("#resource_summary").keyup(function(){var e=$(this).val().replace(/[^\x00-\xff]/g,"**").length;var a=e>maxlen?0:maxlen-e;var r=Math.floor(a/2);$("#letter").text(a);$("#word").text(r);if(e>maxlen){$(this).val($(this).val().substring(0,maxlen))}});$(".pic_input").on("change",function(){var e=getObjectURL(this.files[0]);var a=this.files[0].size;if($(this).attr("id")=="resource_pic"&&a>4*1e3*1e3){baseUtils.show.redTip("图片太大!请不要超过4M!");return}try{var r,t;if(r=this.files[0]){t=new Image;t.onload=function(){width=this.width;height=this.height};t.src=e}}catch(e){}$(this).nextAll(".pic_add").addClass("hide");$(this).nextAll(".pic_close").removeClass("hide");$(this).nextAll(".pic_show").removeClass("hide");$(this).nextAll(".pic_show").attr("src",e);$(".pic_close").on("click",function(){$(this).addClass("hide");$(this).nextAll(".pic_show").addClass("hide");$(this).nextAll(".pic_add").removeClass("hide");$(this).prevAll(".pic_input").val("")})})});function getObjectURL(e){var a=null;if(window.createObjectURL!=undefined){a=window.createObjectURL(e)}else if(window.URL!=undefined){a=window.URL.createObjectURL(e)}else if(window.webkitURL!=undefined){a=window.webkitURL.createObjectURL(e)}return a}function saveEditResource(e){this.resource_type=e;showLoading();checkForm();if(isEditPic){sliceUpload(".pic_input",get_cos_image_path(),pic_successCallBack,pic_errorCallBack)}else{doUpLoad()}}function checkForm(){allParams={};params={};var e=$("#resource_title").val().trim();if(e.length!=0){params["name"]=e}else{baseUtils.show.redTip("名称不能为空!");setHighLightMsg("#resource_title");$("#resource_title").focus();return false}var a=$("#resource_summary").val().trim();if(a.length!=0){params["summary"]=a}else{baseUtils.show.redTip("简介不能为空!");setHighLightMsg("#resource_summary");$("#resource_summary").focus();return false}var r=$(".pic_input").val();if(r.length!=0){isEditPic=true}var t=$("#resource_period").find("option:selected").val().trim();params["period"]=t;var i=$("#resource_price").val().trim();if(i.length==0){i=0}params["price"]=i*100;var s=UE.getEditor("resource_desc");var o=s.getContent();params["org_content"]=o;var l=s.getPlainTxt();if(l.length==0){baseUtils.show.redTip("描述不能为空!");return false}params["descrb"]=l;category_type=[];var c=0;$(".checkBoxWrapper :checkbox:checked").each(function(){var e=$(this).attr("value");category_type[c++]=e});var n=$("#data").data("id");allParams["id"]=n;allParams["resource_type"]=resource_type;allParams["params"]=params;allParams["category_type"]=category_type}function sliceUpload(e,a,r,t){var i=$(e).prop("files");if(i&&i.length==1){browserMD5File(i[0],function(e,s){console.log("MD5:"+s);var o=i[0]["name"];var l=o.split(".");var c=l[l.length-1];console.log("suffix:"+c);a=a+s+"."+c;console.log("remotePath:"+a);cos.uploadFileWithoutPro(r,t,a,i[0],0)})}else{baseUtils.show.redTip("请选择一个文件")}}var pic_successCallBack=function(e){console.log("图片上传成功!");var a=e.data.access_url;console.log("图片链接!"+a);params["img_url"]=a;params["img_url_compressed"]=a;doUpLoad()};var pic_errorCallBack=function(e){hideLoading();baseUtils.show.redTip("配图上传失败!请重新上传!");uploadErrorShow(e.responseText)};function getResourceDuration(e){console.log("时长"+e.duration);if(resource_type=="audio"){params["audio_length"]=e.duration}else{params["video_length"]=e.duration}}function doUpLoad(){$.post("/edit_package_save",allParams,function(e){hideLoading();var a=e.code;var r=e.msg;if(a==0){baseUtils.show.blueTip(r,function(){window.location.href="/package_list"})}else{baseUtils.show.redTip(r)}})}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkbWluL2VkaXRQYWNrYWdlLmpzIl0sIm5hbWVzIjpbIndpZHRoIiwiaGVpZ2h0IiwicGFyYW1zIiwiYWxsUGFyYW1zIiwiY2F0ZWdvcnlfdHlwZSIsInJlc291cmNlX3R5cGUiLCJpc0VkaXRQaWMiLCJjb3MiLCJJbml0Q29zQ2xvdWQiLCJtYXhsZW4iLCJjbm1heGxlbiIsIk1hdGgiLCJmbG9vciIsIiQiLCJkb2N1bWVudCIsInJlYWR5IiwidGV4dCIsImxvYWR0ZXh0IiwibGVuIiwidmFsIiwicmVwbGFjZSIsImxlbmd0aCIsInN1YnN0cmluZyIsIkVubnVtIiwiQ25udW0iLCJvbiIsInNldE1zZ0RpbSIsInRoaXMiLCJjbGljayIsIndpbmRvdyIsImxvY2F0aW9uIiwiaHJlZiIsImtleXVwIiwic3JjcyIsImdldE9iamVjdFVSTCIsImZpbGVzIiwiZmlsZVNpemUiLCJzaXplIiwiYXR0ciIsImJhc2VVdGlscyIsInNob3ciLCJyZWRUaXAiLCJmaWxlIiwiaW1nIiwiSW1hZ2UiLCJvbmxvYWQiLCJzcmMiLCJlIiwibmV4dEFsbCIsImFkZENsYXNzIiwicmVtb3ZlQ2xhc3MiLCJwcmV2QWxsIiwidXJsIiwiY3JlYXRlT2JqZWN0VVJMIiwidW5kZWZpbmVkIiwiVVJMIiwid2Via2l0VVJMIiwic2F2ZUVkaXRSZXNvdXJjZSIsInNob3dMb2FkaW5nIiwiY2hlY2tGb3JtIiwic2xpY2VVcGxvYWQiLCJnZXRfY29zX2ltYWdlX3BhdGgiLCJwaWNfc3VjY2Vzc0NhbGxCYWNrIiwicGljX2Vycm9yQ2FsbEJhY2siLCJkb1VwTG9hZCIsInJlc291cmNlX3RpdGxlIiwidHJpbSIsInNldEhpZ2hMaWdodE1zZyIsImZvY3VzIiwicmVzb3VyY2Vfc3VtbWFyeSIsInBpY19pbnB1dCIsInJlc291cmNlX3BlcmlvZCIsImZpbmQiLCJyZXNvdXJjZV9wcmljZSIsInVlIiwiVUUiLCJnZXRFZGl0b3IiLCJodG1sIiwiZ2V0Q29udGVudCIsInJlc291cmNlX2Rlc2MiLCJnZXRQbGFpblR4dCIsImlpIiwiZWFjaCIsInZhbHVlIiwicmVzb3VyY2VfaWQiLCJkYXRhIiwiaWRlbnRpdHkiLCJyZW1vdGVQYXRoIiwic3VjY2Vzc0NhbGxCYWNrIiwiZXJyb3JDYWxsQmFjayIsInByb3AiLCJicm93c2VyTUQ1RmlsZSIsImVyciIsIm1kNSIsImNvbnNvbGUiLCJsb2ciLCJmaWxlX25hbWUiLCJuYW1lcyIsInNwbGl0Iiwic3VmZml4IiwidXBsb2FkRmlsZVdpdGhvdXRQcm8iLCJyZXN1bHQiLCJwaWNfdXJsIiwiYWNjZXNzX3VybCIsImhpZGVMb2FkaW5nIiwidXBsb2FkRXJyb3JTaG93IiwicmVzcG9uc2VUZXh0IiwiZ2V0UmVzb3VyY2VEdXJhdGlvbiIsImVsZW1lbnQiLCJkdXJhdGlvbiIsInBvc3QiLCJjb2RlIiwibXNnIiwiYmx1ZVRpcCJdLCJtYXBwaW5ncyI6IkFBQUEsR0FBSUEsTUFDSixJQUFJQyxPQUVKLElBQUlDLFVBQ0osSUFBSUMsYUFFSixJQUFJQyxjQUVKLElBQUlDLGNBR0osSUFBSUMsV0FBWSxLQUtoQixJQUFJQyxLQUFNLEdBQUlDLGFBR2QsSUFBSUMsUUFBUyxHQUNiLElBQUlDLFVBQVdDLEtBQUtDLE1BQU1ILE9BQVMsRUFFbkNJLEdBQUVDLFVBQVVDLE1BQU0sV0FFZEYsRUFBRSxjQUFjRyxLQUFLUCxPQUNyQkksR0FBRSxZQUFZRyxLQUFLTixTQUNuQixJQUFJTyxHQUFXSixFQUFFLG9CQUNqQixJQUFJSyxHQUFNTCxFQUFFSSxHQUFVRSxNQUFNQyxRQUFRLGdCQUFnQixNQUFNQyxNQUMxRCxJQUFHSCxFQUFNVCxPQUFPLENBQ1pJLEVBQUVJLEdBQVVFLElBQUlOLEVBQUVJLEdBQVVFLE1BQU1HLFVBQVUsRUFBRWIsU0FFbEQsR0FBSWMsR0FBUUwsRUFBTVQsT0FBUSxFQUFJQSxPQUFTUyxDQUN2QyxJQUFJTSxHQUFRYixLQUFLQyxNQUFNVyxFQUFRLEVBQy9CVixHQUFFLFdBQVdHLEtBQUtPLEVBQU9WLEdBQUUsU0FBU0csS0FBS1EsRUFFekNYLEdB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QU0sSUFDNUIsSUFBSUMsR0FBU0YsRUFBTUEsRUFBTTVFLE9BQVMsRUFDbEN5RSxTQUFRQyxJQUFJLFVBQVlJLEVBQ3hCWixHQUFhQSxFQUFhTSxFQUFNLElBQU1NLENBQ3RDTCxTQUFRQyxJQUFJLGNBQWdCUixFQUM1QmhGLEtBQUk2RixxQkFBcUJaLEVBQWlCQyxFQUFlRixFQUFZcEQsRUFBTSxHQUFJLFNBSWxGLENBQ0RJLFVBQVVDLEtBQUtDLE9BQU8sWUFPOUIsR0FBSXFCLHFCQUFzQixTQUFVdUMsR0FHaENQLFFBQVFDLElBQUksVUFHWixJQUFJTyxHQUFVRCxFQUFPaEIsS0FBS2tCLFVBQzFCVCxTQUFRQyxJQUFJLFFBQVVPLEVBRXRCcEcsUUFBTyxXQUFhb0csQ0FDcEJwRyxRQUFPLHNCQUF3Qm9HLENBRS9CdEMsWUFLSixJQUFJRCxtQkFBb0IsU0FBVXNDLEdBRTlCRyxhQUNBakUsV0FBVUMsS0FBS0MsT0FBTyxnQkFDdEJnRSxpQkFBZ0JKLEVBQU9LLGNBSzNCLFNBQVNDLHFCQUFvQkMsR0FDekJkLFFBQVFDLElBQUksS0FBT2EsRUFBUUMsU0FDM0IsSUFBR3hHLGVBQWUsUUFBUSxDQUN0QkgsT0FBTyxnQkFBa0IwRyxFQUFRQyxhQUNoQyxDQUNEM0csT0FBTyxnQkFBa0IwRyxFQUFRQyxVQU96QyxRQUFTN0MsWUFDTG5ELEVBQUVpRyxLQUFLLHFCQUFzQjNHLFVBQVcsU0FBVWtHLEdBQzlDRyxhQUNBLElBQUlPLEdBQU9WLEVBQU9VLElBQ2xCLElBQUlDLEdBQU1YLEVBQU9XLEdBQ2pCLElBQUlELEdBQVEsRUFBRyxDQUNYeEUsVUFBVUMsS0FBS3lFLFFBQVFELEVBQUssV0FDeEJuRixPQUFPQyxTQUFTQyxLQUFPLHNCQUV4QixDQUNIUSxVQUFVQyxLQUFLQyxPQUFPdUUiLCJmaWxlIjoiYWRtaW4vZWRpdFBhY2thZ2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgd2lkdGg7XG52YXIgaGVpZ2h0O1xuXG52YXIgcGFyYW1zID0ge307XG52YXIgYWxsUGFyYW1zID0ge307XG5cbnZhciBjYXRlZ29yeV90eXBlO1xuXG52YXIgcmVzb3VyY2VfdHlwZTsvL+WIm+W7uuexu+Wei1xuXG4vL+WIpOaWremFjeWbvuaYr+WQpuS/ruaUueS6hlxudmFyIGlzRWRpdFBpYyA9IGZhbHNlO1xuXG4vL+iFvuiur+S6kei1hOa6kFxuLy92YXIgYnVja2V0TmFtZSA9IHdpbmRvdy5jb3NfYnVja2V0X25hbWU7XG4vL3ZhciBjb3MgPSBuZXcgQ29zQ2xvdWQod2luZG93LmNvc19hcHBfaWQpO1xudmFyIGNvcyA9IG5ldyBJbml0Q29zQ2xvdWQoKTtcblxuLy/ovpPlhaXlrZfnrKbpmZDliLZcbnZhciBtYXhsZW4gPSAyNTY7XG52YXIgY25tYXhsZW4gPSBNYXRoLmZsb29yKG1heGxlbiAvIDIpO1xuXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG5cbiAgICAkKFwiI21heGxldHRlclwiKS50ZXh0KG1heGxlbik7XG4gICAgJChcIiNtYXh3b3JkXCIpLnRleHQoY25tYXhsZW4pO1xuICAgIHZhciBsb2FkdGV4dCA9ICQoXCIjcmVzb3VyY2Vfc3VtbWFyeVwiKTtcbiAgICB2YXIgbGVuID0gJChsb2FkdGV4dCkudmFsKCkucmVwbGFjZSgvW15cXHgwMC1cXHhmZl0vZyxcIioqXCIpLmxlbmd0aDtcbiAgICBpZihsZW4gPiBtYXhsZW4pe1xuICAgICAgICAkKGxvYWR0ZXh0KS52YWwoJChsb2FkdGV4dCkudmFsKCkuc3Vic3RyaW5nKDAsbWF4bGVuKSk7XG4gICAgfVxuICAgIHZhciBFbm51bSA9IGxlbiA+IG1heGxlbj8gMCA6IG1heGxlbiAtIGxlbjtcbiAgICB2YXIgQ25udW0gPSBNYXRoLmZsb29yKEVubnVtIC8gMik7XG4gICAgJChcIiNsZXR0ZXJcIikudGV4dChFbm51bSk7JChcIiN3b3JkXCIpLnRleHQoQ25udW0pO1xuXG4gICAgJChcIiNyZXNvdXJjZV90aXRsZVwiKS5vbihcImJsdXIga2V5dXBcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICBzZXRNc2dEaW0odGhpcyk7XG4gICAgfSk7XG5cbiAgICAkKFwiI3Jlc291cmNlX3N1bW1hcnlcIikub24oXCJibHVyIGtleXVwXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2V0TXNnRGltKHRoaXMpO1xuICAgIH0pO1xuXG4gICAgLy8gIOWbnuS4k+agj+WIl+ihqOmhtemdolxuICAgICQoXCIuaGVhZGVyX2xldmVsLmxlZnRcIikuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZj1cIi9wYWNrYWdlX2xpc3RcIjtcbiAgICB9KTtcblxufSk7XG5cblxuJChmdW5jdGlvbiAoKSB7XG4gICAgJChcIiNyZXNvdXJjZV9zdW1tYXJ5XCIpLmtleXVwKGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBsZW4gPSAkKHRoaXMpLnZhbCgpLnJlcGxhY2UoL1teXFx4MDAtXFx4ZmZdL2csXCIqKlwiKS5sZW5ndGg7XG4gICAgICAgIHZhciBFbm51bSA9IGxlbiA+IG1heGxlbj8gMCA6IG1heGxlbiAtIGxlbjtcbiAgICAgICAgdmFyIENubnVtID0gTWF0aC5mbG9vcihFbm51bSAvIDIpO1xuICAgICAgICAkKFwiI2xldHRlclwiKS50ZXh0KEVubnVtKTskKFwiI3dvcmRcIikudGV4dChDbm51bSk7XG4gICAgICAgIGlmKGxlbiA+IG1heGxlbil7XG4gICAgICAgICAgICAkKHRoaXMpLnZhbCgkKHRoaXMpLnZhbCgpLnN1YnN0cmluZygwLG1heGxlbikpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAkKFwiLnBpY19pbnB1dFwiKS5vbihcImNoYW5nZVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzcmNzID0gZ2V0T2JqZWN0VVJMKHRoaXMuZmlsZXNbMF0pOyAgIC8v6I635Y+W6Lev5b6EXG4gICAgICAgIHZhciBmaWxlU2l6ZSA9IHRoaXMuZmlsZXNbMF0uc2l6ZTtcbiAgICAgICAgaWYoJCh0aGlzKS5hdHRyKFwiaWRcIik9PSdyZXNvdXJjZV9waWMnJiZmaWxlU2l6ZT40KjEwMDAqMTAwMCl7XG4gICAgICAgICAgICBiYXNlVXRpbHMuc2hvdy5yZWRUaXAoJ+WbvueJh+WkquWkpyHor7fkuI3opoHotoXov4c0TSEnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvL+iOt+WPluWbvueJh+eahOWuvemrmFxuICAgICAgICAgICAgdmFyIGZpbGUsIGltZztcbiAgICAgICAgICAgIGlmICgoZmlsZSA9IHRoaXMuZmlsZXNbMF0pKSB7XG4gICAgICAgICAgICAgICAgaW1nID0gbmV3IEltYWdlKCk7XG4gICAgICAgICAgICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgd2lkdGggPSB0aGlzLndpZHRoO1xuICAgICAgICAgICAgICAgICAgICBoZWlnaHQgPSB0aGlzLmhlaWdodDtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGltZy5zcmMgPSBzcmNzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlKSB7XG5cbiAgICAgICAgfVxuXG4gICAgICAgICQodGhpcykubmV4dEFsbChcIi5waWNfYWRkXCIpLmFkZENsYXNzKCdoaWRlJyk7ICAgLy90aGlz5oyH55qE5pivaW5wdXRcbiAgICAgICAgJCh0aGlzKS5uZXh0QWxsKCcucGljX2Nsb3NlJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTsgICAvL3RoaXPmjIfnmoTmmK9pbnB1dFxuICAgICAgICAkKHRoaXMpLm5leHRBbGwoXCIucGljX3Nob3dcIikucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICAgJCh0aGlzKS5uZXh0QWxsKFwiLnBpY19zaG93XCIpLmF0dHIoXCJzcmNcIiwgc3Jjcyk7ICAgIC8vdGhpc+aMh+eahOaYr2lucHV0XG4gICAgICAgICQoXCIucGljX2Nsb3NlXCIpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnaGlkZScpOyAgICAgLy90aGlz5oyH55qE5pivc3BhblxuICAgICAgICAgICAgJCh0aGlzKS5uZXh0QWxsKFwiLnBpY19zaG93XCIpLmFkZENsYXNzKCdoaWRlJyk7XG4gICAgICAgICAgICAkKHRoaXMpLm5leHRBbGwoXCIucGljX2FkZFwiKS5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgICAgICAgICAgJCh0aGlzKS5wcmV2QWxsKCcucGljX2lucHV0JykudmFsKCcnKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59KVxuXG5mdW5jdGlvbiBnZXRPYmplY3RVUkwoZmlsZSkge1xuICAgIHZhciB1cmwgPSBudWxsO1xuICAgIGlmICh3aW5kb3cuY3JlYXRlT2JqZWN0VVJMICE9IHVuZGVmaW5lZCkge1xuICAgICAgICB1cmwgPSB3aW5kb3cuY3JlYXRlT2JqZWN0VVJMKGZpbGUpXG4gICAgfSBlbHNlIGlmICh3aW5kb3cuVVJMICE9IHVuZGVmaW5lZCkge1xuICAgICAgICB1cmwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlKVxuICAgIH0gZWxzZSBpZiAod2luZG93LndlYmtpdFVSTCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgdXJsID0gd2luZG93LndlYmtpdFVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZSlcbiAgICB9XG4gICAgcmV0dXJuIHVybFxufVxuXG5cbi8v5LiK5Lyg6LWE5rqQICByZXNvdXJjZV90eXBlOmF1ZGlv44CBdmlkZW9cbmZ1bmN0aW9uIHNhdmVFZGl0UmVzb3VyY2UocmVzb3VyY2VfdHlwZSkge1xuICAgIHRoaXMucmVzb3VyY2VfdHlwZSA9IHJlc291cmNlX3R5cGU7XG5cbiAgICBzaG93TG9hZGluZygpO1xuXG4gICAgY2hlY2tGb3JtKCk7XG5cbiAgICBpZihpc0VkaXRQaWMpe1xuICAgICAgICAvL+S4iuS8oOWbvueJh1xuICAgICAgICBzbGljZVVwbG9hZCgnLnBpY19pbnB1dCcsIGdldF9jb3NfaW1hZ2VfcGF0aCgpLCBwaWNfc3VjY2Vzc0NhbGxCYWNrLCBwaWNfZXJyb3JDYWxsQmFjayk7XG4gICAgfWVsc2V7XG4gICAgICAgIC8v5LiN6ZyA6KaB5LiK5Lyg6LWE5rqQXG4gICAgICAgIGRvVXBMb2FkKCk7XG4gICAgfVxuXG59XG5cbi8v5qC45a+56KGo5Y2VXG5mdW5jdGlvbiBjaGVja0Zvcm0oKSB7XG4gICAgLy/muIXnqbrkuYvliY3nmoTmlbDmja5cbiAgICBhbGxQYXJhbXMgPSB7fTtcbiAgICBwYXJhbXMgPSB7fTtcblxuICAgIC8v6LWE5rqQ5ZCN56ewXG4gICAgdmFyIHJlc291cmNlX3RpdGxlID0gJCgnI3Jlc291cmNlX3RpdGxlJykudmFsKCkudHJpbSgpO1xuICAgIGlmIChyZXNvdXJjZV90aXRsZS5sZW5ndGggIT0gMCkge1xuICAgICAgICBwYXJhbXNbJ25hbWUnXSA9IHJlc291cmNlX3RpdGxlO1xuICAgIH1lbHNle1xuICAgICAgICBiYXNlVXRpbHMuc2hvdy5yZWRUaXAoJ+WQjeensOS4jeiDveS4uuepuiEnKTtcbiAgICAgICAgc2V0SGlnaExpZ2h0TXNnKCcjcmVzb3VyY2VfdGl0bGUnKTtcbiAgICAgICAgJCgnI3Jlc291cmNlX3RpdGxlJykuZm9jdXMoKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIOi1hOa6kOeugOS7i1xuICAgIHZhciByZXNvdXJjZV9zdW1tYXJ5ID0gJCgnI3Jlc291cmNlX3N1bW1hcnknKS52YWwoKS50cmltKCk7XG4gICAgaWYgKHJlc291cmNlX3N1bW1hcnkubGVuZ3RoICE9IDApIHtcbiAgICAgICAgcGFyYW1zWydzdW1tYXJ5J10gPSByZXNvdXJjZV9zdW1tYXJ5O1xuICAgIH1lbHNle1xuICAgICAgICBiYXNlVXRpbHMuc2hvdy5yZWRUaXAoJ+eugOS7i+S4jeiDveS4uuepuiEnKTtcbiAgICAgICAgc2V0SGlnaExpZ2h0TXNnKCcjcmVzb3VyY2Vfc3VtbWFyeScpO1xuICAgICAgICAkKCcjcmVzb3VyY2Vfc3VtbWFyeScpLmZvY3VzKCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cblxuICAgIC8v6LWE5rqQ5bCB6Z2iXG4gICAgdmFyIHBpY19pbnB1dCA9ICQoJy5waWNfaW5wdXQnKS52YWwoKTtcbiAgICBpZihwaWNfaW5wdXQubGVuZ3RoIT0wKXtcbiAgICAgICAgaXNFZGl0UGljID0gdHJ1ZTtcbiAgICB9XG5cbiAgICAvL+acieaViOaXtumVv1xuICAgIHZhciByZXNvdXJjZV9wZXJpb2QgPSAkKCcjcmVzb3VyY2VfcGVyaW9kJykuZmluZCgnb3B0aW9uOnNlbGVjdGVkJykudmFsKCkudHJpbSgpO1xuICAgIC8qaWYgKHJlc291cmNlX3BlcmlvZC5sZW5ndGggPT0gMCkge1xuICAgICAgICBiYXNlVXRpbHMuc2hvdy5yZWRUaXAoJ+ivt+mAieaLqeacieaViOaXtumXtCEnKTtcbiAgICAgICAgc2V0SGlnaExpZ2h0TXNnKCcjcmVzb3VyY2VfcGVyaW9kJyk7XG4gICAgICAgICQoJyNyZXNvdXJjZV9wZXJpb2QnKS5mb2N1cygpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSovXG4gICAgcGFyYW1zWydwZXJpb2QnXSA9IHJlc291cmNlX3BlcmlvZDtcblxuICAgIC8v5Lu35qC8XG4gICAgdmFyIHJlc291cmNlX3ByaWNlID0gJCgnI3Jlc291cmNlX3ByaWNlJykudmFsKCkudHJpbSgpO1xuICAgIGlmIChyZXNvdXJjZV9wcmljZS5sZW5ndGggPT0gMCkge1xuICAgICAgICByZXNvdXJjZV9wcmljZSA9IDA7XG4gICAgfVxuICAgIHBhcmFtc1sncHJpY2UnXSA9IHJlc291cmNlX3ByaWNlKjEwMDtcblxuXG4gICAgdmFyIHVlID0gVUUuZ2V0RWRpdG9yKCdyZXNvdXJjZV9kZXNjJyk7XG5cbiAgICB2YXIgaHRtbD11ZS5nZXRDb250ZW50KCk7XG4gICAgcGFyYW1zWydvcmdfY29udGVudCddID0gaHRtbDtcblxuICAgIC8v6LWE5rqQ5o+P6L+wXG4gICAgdmFyIHJlc291cmNlX2Rlc2MgPSB1ZS5nZXRQbGFpblR4dCgpO1xuICAgIGlmIChyZXNvdXJjZV9kZXNjLmxlbmd0aCA9PSAwKSB7XG4gICAgICAgIGJhc2VVdGlscy5zaG93LnJlZFRpcCgn5o+P6L+w5LiN6IO95Li656m6IScpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHBhcmFtc1snZGVzY3JiJ10gPSByZXNvdXJjZV9kZXNjO1xuXG5cbiAgICAvKuWIhuexu+WvvOiIqiAtICovXG4gICAgY2F0ZWdvcnlfdHlwZSA9IFtdO1xuXG4gICAgdmFyIGlpID0gMDtcbiAgICAkKFwiLmNoZWNrQm94V3JhcHBlciA6Y2hlY2tib3g6Y2hlY2tlZFwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHZhbHVlID0gJCh0aGlzKS5hdHRyKFwidmFsdWVcIik7XG4gICAgICAgIGNhdGVnb3J5X3R5cGVbaWkrK10gPSB2YWx1ZTtcbiAgICAgICAgLy8gYWxlcnQoJCh0aGlzKS5uZXh0KCkubmV4dCgpLnRleHQoKSk7XG4gICAgfSk7XG5cblxuICAgIC8v6LWE5rqQaWRcbiAgICB2YXIgcmVzb3VyY2VfaWQgPSAkKCcjZGF0YScpLmRhdGEoJ2lkJyk7XG4gICAgYWxsUGFyYW1zWydpZCddPSByZXNvdXJjZV9pZDtcblxuICAgIGFsbFBhcmFtc1sncmVzb3VyY2VfdHlwZSddID0gcmVzb3VyY2VfdHlwZTtcblxuICAgIGFsbFBhcmFtc1sncGFyYW1zJ10gPSBwYXJhbXM7XG5cbiAgICBhbGxQYXJhbXNbJ2NhdGVnb3J5X3R5cGUnXSA9IGNhdGVnb3J5X3R5cGU7XG5cbn1cblxuXG5mdW5jdGlvbiBzbGljZVVwbG9hZChpZGVudGl0eSwgcmVtb3RlUGF0aCwgc3VjY2Vzc0NhbGxCYWNrLCBlcnJvckNhbGxCYWNrKSB7XG5cbiAgICAvL+S4iuS8oCjnm7TmjqXpgJrov4dqc+S4iuS8oGNkbilcbiAgICB2YXIgZmlsZXMgPSAkKGlkZW50aXR5KS5wcm9wKCdmaWxlcycpO1xuICAgIGlmIChmaWxlcyAmJiBmaWxlcy5sZW5ndGggPT0gMSkge1xuXG4gICAgICAgIC8v6I635Y+W5paH5Lu255qETUQ15YC8XG4gICAgICAgIGJyb3dzZXJNRDVGaWxlKGZpbGVzWzBdLCBmdW5jdGlvbiAoZXJyLCBtZDUpIHtcbiAgICAgICAgICAgIC8v6I635Y+W5paH5Lu25YaF5a6555qETUQ1XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnTUQ1OicgKyBtZDUpO1xuICAgICAgICAgICAgLy/lj5bmlofku7blkI3lkI7nvIBcbiAgICAgICAgICAgIHZhciBmaWxlX25hbWUgPSBmaWxlc1swXVsnbmFtZSddO1xuICAgICAgICAgICAgdmFyIG5hbWVzID0gZmlsZV9uYW1lLnNwbGl0KCcuJyk7XG4gICAgICAgICAgICB2YXIgc3VmZml4ID0gbmFtZXNbbmFtZXMubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc3VmZml4OicgKyBzdWZmaXgpO1xuICAgICAgICAgICAgcmVtb3RlUGF0aCA9IHJlbW90ZVBhdGggKyBtZDUgKyBcIi5cIiArIHN1ZmZpeDtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZW1vdGVQYXRoOicgKyByZW1vdGVQYXRoKTtcbiAgICAgICAgICAgIGNvcy51cGxvYWRGaWxlV2l0aG91dFBybyhzdWNjZXNzQ2FsbEJhY2ssIGVycm9yQ2FsbEJhY2ssIHJlbW90ZVBhdGgsIGZpbGVzWzBdLCAwKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGJhc2VVdGlscy5zaG93LnJlZFRpcChcIuivt+mAieaLqeS4gOS4quaWh+S7tlwiKTtcbiAgICB9XG5cbn1cblxuXG4vL+mFjeWbvuaIkOWKn+S4iuS8oOWbnuiwg1xudmFyIHBpY19zdWNjZXNzQ2FsbEJhY2sgPSBmdW5jdGlvbiAocmVzdWx0KSB7XG5cbiAgICAvL3ZhciBqc29uUmVzdWx0ID0gJC5wYXJzZUpTT04ocmVzdWx0KTtcbiAgICBjb25zb2xlLmxvZygn5Zu+54mH5LiK5Lyg5oiQ5YqfIScpO1xuXG4gICAgLy/ojrflj5bliLDotYTmupBjZG7orr/pl67ov57mjqVcbiAgICB2YXIgcGljX3VybCA9IHJlc3VsdC5kYXRhLmFjY2Vzc191cmw7XG4gICAgY29uc29sZS5sb2coJ+WbvueJh+mTvuaOpSEnICsgcGljX3VybCk7XG5cbiAgICBwYXJhbXNbJ2ltZ191cmwnXSA9IHBpY191cmw7XG4gICAgcGFyYW1zWydpbWdfdXJsX2NvbXByZXNzZWQnXSA9IHBpY191cmw7XG5cbiAgICBkb1VwTG9hZCgpO1xuXG59O1xuXG4vL+i1hOa6kOmFjeWbvuWksei0peS4iuS8oOWbnuiwg1xudmFyIHBpY19lcnJvckNhbGxCYWNrID0gZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgIC8vdmFyIGpzb25SZXN1bHQgPSAkLnBhcnNlSlNPTihyZXN1bHQpO1xuICAgIGhpZGVMb2FkaW5nKCk7XG4gICAgYmFzZVV0aWxzLnNob3cucmVkVGlwKCfphY3lm77kuIrkvKDlpLHotKUh6K+36YeN5paw5LiK5LygIScpO1xuICAgIHVwbG9hZEVycm9yU2hvdyhyZXN1bHQucmVzcG9uc2VUZXh0KTtcbn1cblxuXG4vL2F1ZGlv5Yqg6L295a6M5q+V5Zue6LCDLOiOt+WPlumfs+mikeaXtumVv1xuZnVuY3Rpb24gZ2V0UmVzb3VyY2VEdXJhdGlvbihlbGVtZW50KSB7XG4gICAgY29uc29sZS5sb2coJ+aXtumVvycgKyBlbGVtZW50LmR1cmF0aW9uKTtcbiAgICBpZihyZXNvdXJjZV90eXBlPT0nYXVkaW8nKXtcbiAgICAgICAgcGFyYW1zWydhdWRpb19sZW5ndGgnXSA9IGVsZW1lbnQuZHVyYXRpb247XG4gICAgfWVsc2V7XG4gICAgICAgIHBhcmFtc1sndmlkZW9fbGVuZ3RoJ10gPSBlbGVtZW50LmR1cmF0aW9uO1xuICAgIH1cblxufVxuXG5cbi8v5LiK5Lyg5pWw5o2u5Yiw6Ieq5bex5ZCO5Y+wXG5mdW5jdGlvbiBkb1VwTG9hZCgpe1xuICAgICQucG9zdCgnL2VkaXRfcGFja2FnZV9zYXZlJywgYWxsUGFyYW1zLCBmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgIGhpZGVMb2FkaW5nKCk7XG4gICAgICAgIHZhciBjb2RlID0gcmVzdWx0LmNvZGU7XG4gICAgICAgIHZhciBtc2cgPSByZXN1bHQubXNnO1xuICAgICAgICBpZiAoY29kZSA9PSAwKSB7XG4gICAgICAgICAgICBiYXNlVXRpbHMuc2hvdy5ibHVlVGlwKG1zZywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnL3BhY2thZ2VfbGlzdCc7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGJhc2VVdGlscy5zaG93LnJlZFRpcChtc2cpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5cblxuIl19
