var width;var height;var params={};var pay_type=2;var resource_type;var cos=new InitCosCloud;var SID;var Poffset;var files=[];var transcodeNotifyUrl;var secretId;var fileId;var videoGsize;var is_edit=false;$(document).ready(function(){initUpload()});function getParameterByName(e,i){if(!i)i=window.location.href;e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),o=t.exec(i);if(!o)return null;if(!o[2])return"";return decodeURIComponent(o[2].replace(/\+/g," "))}function getObjectURL(e){var i=null;if(window.createObjectURL!=undefined){i=window.createObjectURL(e)}else if(window.URL!=undefined){i=window.URL.createObjectURL(e)}else if(window.webkitURL!=undefined){i=window.webkitURL.createObjectURL(e)}return i}function initUpload(){var e=qcVideo.get("$");var i=qcVideo.get("Version");if(!qcVideo.uploader.supportBrowser()){if(i.IS_MOBILE){baseUtils.show.redTip("当前浏览器不支持上传，请升级系统版本或者下载最新的chrome浏览器")}else{getInternetExplorerVersion()}return}var t=1;var o=0;accountDone("video_file",t,o,"")}var accountDone=function(e,i,t,o){var d=qcVideo.get("$"),a=qcVideo.get("ErrorCode"),s=qcVideo.get("Log"),r=qcVideo.get("JSON"),l=qcVideo.get("util"),n=qcVideo.get("Code"),c=qcVideo.get("Version");qcVideo.uploader.init({web_upload_url:"https://vod2.qcloud.com/v3/index.php",getSignature:function(e,i){console.log(1);console.log(e.ft);e["s"]="AKIDTdzn2PhgeuKvr2ue4dSbMHWSDMjK8d7v";e["uid"]="必填";var t=[];for(var o in e)t.push(o+"="+encodeURIComponent(e[o]));t=t.join("&");var d=CryptoJS.HmacSHA1(t,"O4gThhgoyWCCZ3mp44CyovASyh96hmy4");d.concat(CryptoJS.enc.Utf8.parse(t));i(CryptoJS.enc.Base64.stringify(d))},upBtnId:e,isTranscode:i,isWatermark:t,after_sha_start_upload:true,sha1js_path:"/calculator_worker_sha1.js",disable_multi_selection:false,transcodeNotifyUrl:transcodeNotifyUrl,classId:o,filters:{max_file_size:"2gb",mime_types:["MP4"],video_only:true},forceH5Worker:true},{onFileUpdate:function(e){console.log(transcodeNotifyUrl);d(".videoUploadCancle").data("videoid",e.id);d(".videoUploadBox").fadeIn(300);var i=e.size;videoGsize=i/(1024*1024);is_edit=true;if(videoGsize>1e3){setTimeout(function(){alert("请将视频文件压缩到 1G 以内!")},100);qcVideo.uploader.deleteFile(e.id);deleteFromFile(e.id);d("#"+e.id).remove();console.log("文件超过1G,提示重新选择视频文件:"+e.id);e="";return}if(e.code==1){if(files.length==1){if(files[0]!=undefined){var t=files[0].id;qcVideo.uploader.deleteFile(t);deleteFromFile(t);d("#"+t).remove();console.log("删除了一个文件:"+t)}}var o=d("#"+e.id);if(!o.get(0)){d("#progress_show").append("<div class='progress_div' id = '"+e.id+"'><span style='font-size: 12px'>"+e.name+":</span><div class='progress_bar' id = 'progress_bar_"+e.id+"'><div class='bar' id='bar_"+e.id+"'></div></div><span class='upload_finish' id='upload_finish_"+e.id+"'>上传完成</span><span data-act='del' data-type='0' class='delete'>删除</span></div>")}var a={id:e.id,size:e.size,state:0,file_id:"",size_text:e.size_text,type:1};files[files.length]=a;d(".videoBoxTitle").text(e.name);d(".videoSize").text(e.size_text);d(".uploadRatio span:nth-of-type(2)").text(e.size_text);d(".videoPercent").text("视频正在解析中");d(".uploadRatio span").text("");d(".videoUploadLineA").css("width","0%");console.log("添加了一个新的文件:"+"id:"+e.id+"size:"+e.size)}if(e.code==2){files[0]["state"]=2}if(e.code==5&&e.percent>0){var s=parseFloat(e.size_text)*parseFloat(e.percent/100);s=s.toFixed(2);d(".videoUploadLineA").css("width",e.percent+"%");d(".videoPercent").text(e.percent+"%");d(".uploadRatio span:nth-of-type(1)").text(s);d(".uploadRatio span:nth-of-type(2)").text(e.size_text);if(!e.speed){d(".uploadSpeed span").text("");d(".videoTimeLeft span").text("")}else{d(".uploadSpeed span").text(e.speed)}}if(e.code==6){is_edit=false;var s=e.size_text*e.percent;d(".videoUploadLineA").css("width","100%");d(".videoPercent").text("已完成");d(".uploadRatio span:nth-of-type(1)").text(e.size_text);d(".uploadRatio span:nth-of-type(2)").text(e.size_text);fileId=e.serverFileId;for(var r=0;r<files.length;r++){if(e.id==files[r]["id"]){files[r]["state"]=6;files[r]["file_id"]=e.serverFileId;break}}if(isUploadFinish()){var l=generateParams()}}console.log(e)},onFileStatus:function(e){console.log("各状态总数--\x3e"+r.stringify(e))},onFilterError:function(e){var i="message:"+e.message+(e.solution?";solution=="+e.solution:"");if(e.code==-1){baseUtils.show.redTip("请上传正确格式的文件")}}});d(".videoUploadCancle").click(function(){d(".videoUploadBox").fadeOut(300);s.debug("delete",fileId);qcVideo.uploader.deleteFile(fileId);deleteFromFile(fileId);fileId=null})};function deleteFromFile(e){for(var i=0;i<files.length;i++){var t=files[i];if(e==t["id"]){files.splice(i,1);console.log("从files中删除了一个文件:"+e)}}}function isUploadFinish(){var e=true;for(var i=0;i<files.length;i++){if(files[i]["state"]!=6){e=false}}return e}function generateParams(){var e={};if(files.length==1){e={public_video:files[0]["file_id"],public_size_text:files[0]["size"]/(1024*1024)}}return e}var try_count=0;function videoUpload(){if(try_count>=300){hideLoading();baseUtils.show.redTip("视频解析失败,请更新浏览器版本重新上传");return}setTimeout(function(){if(files.length>0&&files[0]["state"]==2){console.log("解析完成");qcVideo.uploader.startUpload()}else{try_count++;console.log("解析还未完成");videoUpload()}},1e3)}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZpZGVvVXBsb2FkVGVzdC5qcyJdLCJuYW1lcyI6WyJ3aWR0aCIsImhlaWdodCIsInBhcmFtcyIsInBheV90eXBlIiwicmVzb3VyY2VfdHlwZSIsImNvcyIsIkluaXRDb3NDbG91ZCIsIlNJRCIsIlBvZmZzZXQiLCJmaWxlcyIsInRyYW5zY29kZU5vdGlmeVVybCIsInNlY3JldElkIiwiZmlsZUlkIiwidmlkZW9Hc2l6ZSIsImlzX2VkaXQiLCIkIiwiZG9jdW1lbnQiLCJyZWFkeSIsImluaXRVcGxvYWQiLCJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJuYW1lIiwidXJsIiwid2luZG93IiwibG9jYXRpb24iLCJocmVmIiwicmVwbGFjZSIsInJlZ2V4IiwiUmVnRXhwIiwicmVzdWx0cyIsImV4ZWMiLCJkZWNvZGVVUklDb21wb25lbnQiLCJnZXRPYmplY3RVUkwiLCJmaWxlIiwiY3JlYXRlT2JqZWN0VVJMIiwidW5kZWZpbmVkIiwiVVJMIiwid2Via2l0VVJMIiwicWNWaWRlbyIsImdldCIsIlZlcnNpb24iLCJ1cGxvYWRlciIsInN1cHBvcnRCcm93c2VyIiwiSVNfTU9CSUxFIiwiYmFzZVV0aWxzIiwic2hvdyIsInJlZFRpcCIsImdldEludGVybmV0RXhwbG9yZXJWZXJzaW9uIiwiaXNUcmFuc2NvZGUiLCJpc1dhdGVybWFyayIsImFjY291bnREb25lIiwidXBCdG5JZCIsImNsYXNzSWQiLCJFcnJvckNvZGUiLCJMb2ciLCJKU09OIiwidXRpbCIsIkNvZGUiLCJpbml0Iiwid2ViX3VwbG9hZF91cmwiLCJnZXRTaWduYXR1cmUiLCJhcmdPYmoiLCJkb25lIiwiY29uc29sZSIsImxvZyIsImZ0IiwiYXJnU3RyIiwiYSIsInB1c2giLCJlbmNvZGVVUklDb21wb25lbnQiLCJqb2luIiwic2hhIiwiQ3J5cHRvSlMiLCJIbWFjU0hBMSIsImNvbmNhdCIsImVuYyIsIlV0ZjgiLCJwYXJzZSIsIkJhc2U2NCIsInN0cmluZ2lmeSIsImFmdGVyX3NoYV9zdGFydF91cGxvYWQiLCJzaGExanNfcGF0aCIsImRpc2FibGVfbXVsdGlfc2VsZWN0aW9uIiwiZmlsdGVycyIsIm1heF9maWxlX3NpemUiLCJtaW1lX3R5cGVzIiwidmlkZW9fb25seSIsImZvcmNlSDVXb3JrZXIiLCJvbkZpbGVVcGRhdGUiLCJhcmdzIiwiZGF0YSIsImlkIiwiZmFkZUluIiwidmlkZW9TaXplUyIsInNpemUiLCJzZXRUaW1lb3V0IiwiYWxlcnQiLCJkZWxldGVGaWxlIiwiZGVsZXRlRnJvbUZpbGUiLCJyZW1vdmUiLCJjb2RlIiwibGVuZ3RoIiwib2xkX2lkIiwiJGxpbmUiLCJhcHBlbmQiLCJpbmZvX2l0ZW0iLCJzdGF0ZSIsImZpbGVfaWQiLCJzaXplX3RleHQiLCJ0eXBlIiwidGV4dCIsImNzcyIsInBlcmNlbnQiLCJ1cGxvYWRDb21wbGV0ZVNpemUiLCJwYXJzZUZsb2F0IiwidG9GaXhlZCIsInNwZWVkIiwic2VydmVyRmlsZUlkIiwiaSIsImlzVXBsb2FkRmluaXNoIiwiZXh0ZXJuYWxQYXJhbXMiLCJnZW5lcmF0ZVBhcmFtcyIsIm9uRmlsZVN0YXR1cyIsImluZm8iLCJvbkZpbHRlckVycm9yIiwibXNnIiwibWVzc2FnZSIsInNvbHV0aW9uIiwiY2xpY2siLCJmYWRlT3V0IiwiZGVidWciLCJpdGVtIiwic3BsaWNlIiwiaXNGaW5pc2giLCJmaWxlX2lkX3BhcmFtcyIsInB1YmxpY192aWRlbyIsInB1YmxpY19zaXplX3RleHQiLCJ0cnlfY291bnQiLCJ2aWRlb1VwbG9hZCIsImhpZGVMb2FkaW5nIiwic3RhcnRVcGxvYWQiXSwibWFwcGluZ3MiOiJBQUFBLEdBQUlBLE1BQ0osSUFBSUMsT0FFSixJQUFJQyxVQUVKLElBQUlDLFVBQVcsQ0FFZixJQUFJQyxjQUtKLElBQUlDLEtBQU0sR0FBSUMsYUFHZCxJQUFJQyxJQUVKLElBQUlDLFFBRUosSUFBSUMsU0FDSixJQUFJQyxtQkFDSixJQUFJQyxTQUNKLElBQUlDLE9BQ0osSUFBSUMsV0FFSixJQUFJQyxTQUFVLEtBRWRDLEdBQUVDLFVBQVVDLE1B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MEUsaUJBRU4iLCJmaWxlIjoidmlkZW9VcGxvYWRUZXN0LmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIHdpZHRoO1xudmFyIGhlaWdodDtcblxudmFyIHBhcmFtcyA9IHt9O1xuXG52YXIgcGF5X3R5cGUgPSAyOyAvL+S7mOi0ueexu+Weiywx6KGo56S65YWN6LS544CBMuihqOekuuWNleS4quS7mOi0uSwz6KGo56S65LiT5qCP44CCXG5cbnZhciByZXNvdXJjZV90eXBlOy8v5Yib5bu657G75Z6LXG5cbi8v6IW+6K6v5LqR6LWE5rqQXG4vL3ZhciBidWNrZXROYW1lID0gd2luZG93LmNvc19idWNrZXRfbmFtZTtcbi8vdmFyIGNvcyA9IG5ldyBDb3NDbG91ZCh3aW5kb3cuY29zX2FwcF9pZCk7XG52YXIgY29zID0gbmV3IEluaXRDb3NDbG91ZCgpO1xuXG4vL1NldEludGVydmFs6L+U5ZueSURcbnZhciBTSUQ7XG4vL+atu+i/m+W6puadoeavj+asoeWPmOWMlumHj1xudmFyIFBvZmZzZXQ7XG5cbnZhciBmaWxlcyA9IFtdOyAvL+WtmOaUvuaWh+S7tlxudmFyIHRyYW5zY29kZU5vdGlmeVVybDsvLyDovaznoIHmiJDlip/lm57osIPlnLDlnYBcbnZhciBzZWNyZXRJZDtcbnZhciBmaWxlSWQ7XG52YXIgdmlkZW9Hc2l6ZTtcblxudmFyIGlzX2VkaXQgPSBmYWxzZTtcblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICAgIC8v5Yid5aeL5YyW5LiK5Lyg56m66Ze0XG4gICAgaW5pdFVwbG9hZCgpO1xufSk7XG5cblxuLyoqXG4gKiDojrflj5Z1cmnlj4LmlbBcbiAqIEBwYXJhbSBuYW1lXG4gKiBAcGFyYW0gdXJsXG4gKiBAcmV0dXJucyB7Kn1cbiAqL1xuZnVuY3Rpb24gZ2V0UGFyYW1ldGVyQnlOYW1lKG5hbWUsIHVybCkge1xuICAgIGlmICghdXJsKSB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCBcIlxcXFwkJlwiKTtcbiAgICB2YXIgcmVnZXggPSBuZXcgUmVnRXhwKFwiWz8mXVwiICsgbmFtZSArIFwiKD0oW14mI10qKXwmfCN8JClcIiksXG4gICAgICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XG4gICAgaWYgKCFyZXN1bHRzKSByZXR1cm4gbnVsbDtcbiAgICBpZiAoIXJlc3VsdHNbMl0pIHJldHVybiAnJztcbiAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMl0ucmVwbGFjZSgvXFwrL2csIFwiIFwiKSk7XG59XG5cbmZ1bmN0aW9uIGdldE9iamVjdFVSTChmaWxlKSB7XG4gICAgdmFyIHVybCA9IG51bGw7XG4gICAgaWYgKHdpbmRvdy5jcmVhdGVPYmplY3RVUkwgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHVybCA9IHdpbmRvdy5jcmVhdGVPYmplY3RVUkwoZmlsZSlcbiAgICB9IGVsc2UgaWYgKHdpbmRvdy5VUkwgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGZpbGUpXG4gICAgfSBlbHNlIGlmICh3aW5kb3cud2Via2l0VVJMICE9IHVuZGVmaW5lZCkge1xuICAgICAgICB1cmwgPSB3aW5kb3cud2Via2l0VVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlKVxuICAgIH1cbiAgICByZXR1cm4gdXJsXG59XG5cblxuLy8g5LiK5Lyg6KeG6aKR5Yid5aeL5YyWXG5mdW5jdGlvbiBpbml0VXBsb2FkKCkge1xuICAgIHZhciAkID0gcWNWaWRlby5nZXQoJyQnKTtcbiAgICB2YXIgVmVyc2lvbiA9IHFjVmlkZW8uZ2V0KCdWZXJzaW9uJyk7XG4gICAgaWYgKCFxY1ZpZGVvLnVwbG9hZGVyLnN1cHBvcnRCcm93c2VyKCkpIHtcbiAgICAgICAgaWYgKFZlcnNpb24uSVNfTU9CSUxFKSB7XG4gICAgICAgICAgICBiYXNlVXRpbHMuc2hvdy5yZWRUaXAoJ+W9k+WJjea1j+iniOWZqOS4jeaUr+aMgeS4iuS8oO+8jOivt+WNh+e6p+ezu+e7n+eJiOacrOaIluiAheS4i+i9veacgOaWsOeahGNocm9tZea1j+iniOWZqCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZ2V0SW50ZXJuZXRFeHBsb3JlclZlcnNpb24oKTtcbiAgICAgICAgICAgIC8vIGJhc2VVdGlscy5zaG93LnJlZFRpcCgn5b2T5YmN5rWP6KeI5Zmo5LiN5pSv5oyB5LiK5Lyg77yM6K+35Y2H57qn5rWP6KeI5Zmo5oiW6ICF5LiL6L295pyA5paw55qEY2hyb21l5rWP6KeI5ZmoJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvL+WPlua2iOS4iuS8oOW5tuWIoOmZpOaWh+S7tlxuICAgIHZhciBpc1RyYW5zY29kZSA9IDE7IC8v5byA5ZCv6L2s56CBXG4gICAgdmFyIGlzV2F0ZXJtYXJrID0gMDsvLyDmsLTljbBcblxuICAgIGFjY291bnREb25lKCd2aWRlb19maWxlJywgaXNUcmFuc2NvZGUsIGlzV2F0ZXJtYXJrLCBcIlwiKTtcbn1cblxudmFyIGFjY291bnREb25lID0gZnVuY3Rpb24gKHVwQnRuSWQsIGlzVHJhbnNjb2RlLCBpc1dhdGVybWFyaywgY2xhc3NJZCkge1xuXG4gICAgdmFyICQgPSBxY1ZpZGVvLmdldCgnJCcpXG4gICAgICAgICwgRXJyb3JDb2RlID0gcWNWaWRlby5nZXQoJ0Vycm9yQ29kZScpXG4gICAgICAgICwgTG9nID0gcWNWaWRlby5nZXQoJ0xvZycpXG4gICAgICAgICwgSlNPTiA9IHFjVmlkZW8uZ2V0KCdKU09OJylcbiAgICAgICAgLCB1dGlsID0gcWNWaWRlby5nZXQoJ3V0aWwnKVxuICAgICAgICAsIENvZGUgPSBxY1ZpZGVvLmdldCgnQ29kZScpXG4gICAgICAgICwgVmVyc2lvbiA9IHFjVmlkZW8uZ2V0KCdWZXJzaW9uJylcbiAgICAgICAgO1xuICAgIHFjVmlkZW8udXBsb2FkZXIuaW5pdChcbiAgICAgICAge1xuICAgICAgICAgICAgd2ViX3VwbG9hZF91cmw6ICdodHRwczovL3ZvZDIucWNsb3VkLmNvbS92My9pbmRleC5waHAnLFxuICAgICAgICAgICAgLy9zZWNyZXRJZDogc2VjcmV0SWQsIC8vIOS6kWFwaSBzZWNyZXRJZFxuXG4gICAgICAgICAgICBnZXRTaWduYXR1cmU6IGZ1bmN0aW9uIChhcmdPYmosIGRvbmUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygxKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhhcmdPYmouZnQpO1xuXG4gICAgICAgICAgICAgICAgLy9hcmdPYmpbJ3MnXSA9IHNlY3JldElkO1xuICAgICAgICAgICAgICAgIC8vYXJnT2JqWyd1aWQnXSA9IDEwMDtcbiAgICAgICAgICAgICAgICAvL3ZhciBhcmdTdHIgPSBbXTtcbiAgICAgICAgICAgICAgICAvL2ZvciAodmFyIGEgaW4gYXJnT2JqKVxuICAgICAgICAgICAgICAgIC8vICAgIGFyZ1N0ci5wdXNoKGEgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQoYXJnT2JqW2FdKSk7XG4gICAgICAgICAgICAgICAgLy9hcmdTdHIgPSBhcmdTdHIuam9pbignJicpO1xuICAgICAgICAgICAgICAgIC8vLy92YXIgYXJnU3RyID0gJ2Y9JyArIGVuY29kZVVSSUNvbXBvbmVudChhcmdPYmouZilcbiAgICAgICAgICAgICAgICAvLy8vKyAnJmZ0PScgKyBlbmNvZGVVUklDb21wb25lbnQoYXJnT2JqLmZ0KVxuICAgICAgICAgICAgICAgIC8vLy8rICcmZnM9JyArIGVuY29kZVVSSUNvbXBvbmVudChhcmdPYmouZnMpO1xuICAgICAgICAgICAgICAgIC8vdmFyIHNpZ25fdXJsID0gJy9nZXRzaWc/JyArIGFyZ1N0cjtcbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgIC8vLy/ms6jmhI/vvJrlh7rkuo7lronlhajogIPomZHvvIwg5pyN5Yqh56uv5o6l5pS2YXJnU3Ry6L+Z5Liq5Y+C5pWw5ZCO77yM6ZyA6KaB5qCh6aqM5YW25Lit55qEQWN0aW9u5Y+C5pWw5piv5ZCm5Li6IFwiTXVsdGlwYXJ0VXBsb2FkVm9kRmlsZVwiLOeUqOadpeivgeaYjuivpeWPguaVsOagh+ivhuS4iuS8oOivt+axglxuICAgICAgICAgICAgICAgIC8vJC5hamF4KHtcbiAgICAgICAgICAgICAgICAvLyAgICAnZGF0YVR5cGUnOiAnanNvbicsXG4gICAgICAgICAgICAgICAgLy8gICAgJ3VybCc6IHNpZ25fdXJsLFxuICAgICAgICAgICAgICAgIC8vICAgICdzdWNjZXNzJzogZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgZG9uZShkWydyZXN1bHQnXSk7XG4gICAgICAgICAgICAgICAgLy8gICAgfVxuICAgICAgICAgICAgICAgIC8vfSk7XG5cbiAgICAgICAgICAgICAgICBhcmdPYmpbJ3MnXSA9ICdBS0lEVGR6bjJQaGdldUt2cjJ1ZTRkU2JNSFdTRE1qSzhkN3YnO1xuICAgICAgICAgICAgICAgIGFyZ09ialsndWlkJ10gPSAn5b+F5aGrJztcbiAgICAgICAgICAgICAgICB2YXIgYXJnU3RyID0gW107XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgYSBpbiBhcmdPYmopXG4gICAgICAgICAgICAgICAgICAgIGFyZ1N0ci5wdXNoKGEgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQoYXJnT2JqW2FdKSk7XG4gICAgICAgICAgICAgICAgYXJnU3RyID0gYXJnU3RyLmpvaW4oJyYnKTtcbiAgICAgICAgICAgICAgICB2YXIgc2hhID0gQ3J5cHRvSlMuSG1hY1NIQTEoYXJnU3RyLCAnTzRnVGhoZ295V0NDWjNtcDQ0Q3lvdkFTeWg5NmhteTQnKTtcbiAgICAgICAgICAgICAgICBzaGEuY29uY2F0KENyeXB0b0pTLmVuYy5VdGY4LnBhcnNlKGFyZ1N0cikpO1xuICAgICAgICAgICAgICAgIGRvbmUoQ3J5cHRvSlMuZW5jLkJhc2U2NC5zdHJpbmdpZnkoc2hhKSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdXBCdG5JZDogdXBCdG5JZCwgLy/kuIrkvKDmjInpkq5JRO+8iOS7u+aEj+mhtemdouWFg+e0oElE77yJXG4gICAgICAgICAgICBpc1RyYW5zY29kZTogaXNUcmFuc2NvZGUsLy/mmK/lkKbovaznoIFcbiAgICAgICAgICAgIGlzV2F0ZXJtYXJrOiBpc1dhdGVybWFyaywvL+aYr+WQpuiuvue9ruawtOWNsFxuICAgICAgICAgICAgYWZ0ZXJfc2hhX3N0YXJ0X3VwbG9hZDogdHJ1ZSwvL3NoYeiuoeeul+WujOaIkOWQju+8jOW8gOWni+S4iuS8oCAo6buY6K6k5YWz6Zet56uL5Y2z5LiK5LygKVxuICAgICAgICAgICAgc2hhMWpzX3BhdGg6ICcvY2FsY3VsYXRvcl93b3JrZXJfc2hhMS5qcycsIC8v6K6h566Xc2hhMeeahOS9jee9rlxuICAgICAgICAgICAgZGlzYWJsZV9tdWx0aV9zZWxlY3Rpb246IGZhbHNlLCAvL+emgeeUqOWkmumAiSDvvIzpu5jorqTkuLpmYWxzZVxuICAgICAgICAgICAgdHJhbnNjb2RlTm90aWZ5VXJsOiB0cmFuc2NvZGVOb3RpZnlVcmwsLy8o6L2s56CB5oiQ5Yqf5ZCO55qE5Zue6LCD5Zyw5Z2AKWlzVHJhbnNjb2RlPT10cnVlLOaXtuW8gOWQr++8myDlm57osIN1cmznmoTov5Tlm57mlbDmja7moLzlvI/lj4LogIMgIGh0dHA6Ly93d3cucWNsb3VkLmNvbS93aWtpL3YyL011bHRpcGFydFVwbG9hZFZvZEZpbGVcbiAgICAgICAgICAgIGNsYXNzSWQ6IGNsYXNzSWQsXG4gICAgICAgICAgICBmaWx0ZXJzOiB7bWF4X2ZpbGVfc2l6ZTogJzJnYicsIG1pbWVfdHlwZXM6IFsnTVA0J10sIHZpZGVvX29ubHk6IHRydWV9LFxuICAgICAgICAgICAgLy9mb3JjZUg1V29ya2VyOiAhIXBhcnNlSW50KGdldFBhcmFtZXRlckJ5TmFtZSgnZm9yY2VINVdvcmtlcicpKSB8fCBmYWxzZSxcbiAgICAgICAgICAgIGZvcmNlSDVXb3JrZXI6IHRydWVcbiAgICAgICAgfVxuICAgICAgICAsIHtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiDmm7TmlrDmlofku7bnirbmgIHlkozov5vluqZcbiAgICAgICAgICAgICAqIGNvZGU6MeOAgeWHhuWkh+iuoeeul1NIQSAy44CB562J5b6F5LiK5LygIDPjgIFTSEHorqHnrpfkuK0gNOOAgeWNs+WwhuS4iuS8oCA144CB5LiK5Lyg6L+b5bqm5pu05pawIDbjgIHkuIrkvKDlrozmiJBcbiAgICAgICAgICAgICAqIEBwYXJhbSBhcmdzIHsgaWQ6IOaWh+S7tklELCBzaXplOiDmlofku7blpKflsI8sIG5hbWU6IOaWh+S7tuWQjeensCwgc3RhdHVzOiDnirbmgIEsIHBlcmNlbnQ6IOi/m+W6piBzcGVlZDog6YCf5bqmLCBlcnJvckNvZGU6IOmUmeivr+eggSxzZXJ2ZXJGaWxlSWQ6IOWQjuerr+aWh+S7tklEIH1cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgb25GaWxlVXBkYXRlOiBmdW5jdGlvbiAoYXJncykge1xuICAgICAgICAgICAgICAgIC8v6I635Y+W5LiK5Lyg5paH5Lu2aWRcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0cmFuc2NvZGVOb3RpZnlVcmwpO1xuICAgICAgICAgICAgICAgICQoXCIudmlkZW9VcGxvYWRDYW5jbGVcIikuZGF0YSgndmlkZW9pZCcsYXJncy5pZCk7XG4gICAgICAgICAgICAgICAgJChcIi52aWRlb1VwbG9hZEJveFwiKS5mYWRlSW4oMzAwKTtcbiAgICAgICAgICAgICAgICAvLyBmaWxlSWQ9YXJncy5pZDtcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhmaWxlSWQpO1xuICAgICAgICAgICAgICAgIC8v5Yik5pat5LiK5Lyg6KeG6aKR5aSn5bCPXG4gICAgICAgICAgICAgICAgdmFyIHZpZGVvU2l6ZVMgPSBhcmdzLnNpemU7XG4gICAgICAgICAgICAgICAgdmlkZW9Hc2l6ZSA9IHZpZGVvU2l6ZVMvKDEwMjQqMTAyNCk7XG4gICAgICAgICAgICAgICAgaXNfZWRpdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgLy8g5aaC5p6c6KeG6aKR5aSn5bCP5aSn5LqOMUfvvIzliJnlnKjkuIrkvKDmtYHnqIvkuK3liKDpmaTlvZPliY3mlofku7ZcbiAgICAgICAgICAgICAgICBpZih2aWRlb0dzaXplPjEwMDApe1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KFwi6K+35bCG6KeG6aKR5paH5Lu25Y6L57yp5YiwIDFHIOS7peWGhSFcIilcbiAgICAgICAgICAgICAgICAgICAgfSwxMDApO1xuICAgICAgICAgICAgICAgICAgICBxY1ZpZGVvLnVwbG9hZGVyLmRlbGV0ZUZpbGUoYXJncy5pZCk7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZUZyb21GaWxlKGFyZ3MuaWQpOyAvL+S7juaWh+S7tuaVsOe7hOS4reWIoOmZpOivpeaWh+S7tlxuICAgICAgICAgICAgICAgICAgICAkKCcjJyArIGFyZ3MuaWQpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn5paH5Lu26LaF6L+HMUcs5o+Q56S66YeN5paw6YCJ5oup6KeG6aKR5paH5Lu2OicgKyBhcmdzLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgYXJncyA9ICcnO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGFyZ3MuY29kZSA9PSAxKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVzLmxlbmd0aCA9PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL+WIoOmZpOS5i+WJjeeahOa3u+WKoOaWsOeahFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVzWzBdICE9IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvbGRfaWQgPSBmaWxlc1swXS5pZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxY1ZpZGVvLnVwbG9hZGVyLmRlbGV0ZUZpbGUob2xkX2lkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVGcm9tRmlsZShvbGRfaWQpOyAvL+S7juaWh+S7tuaVsOe7hOS4reWIoOmZpOivpeaWh+S7tlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyMnICsgb2xkX2lkKS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn5Yig6Zmk5LqG5LiA5Liq5paH5Lu2OicgKyBvbGRfaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyICRsaW5lID0gJChcIiNcIiArIGFyZ3MuaWQpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoISRsaW5lLmdldCgwKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnI3Byb2dyZXNzX3Nob3cnKS5hcHBlbmQoXCI8ZGl2IGNsYXNzPSdwcm9ncmVzc19kaXYnIGlkID0gJ1wiICsgYXJncy5pZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgXCInPjxzcGFuIHN0eWxlPSdmb250LXNpemU6IDEycHgnPlwiICsgYXJncy5uYW1lICsgXCI6PC9zcGFuPjxkaXYgY2xhc3M9J3Byb2dyZXNzX2JhcicgaWQgPSAncHJvZ3Jlc3NfYmFyX1wiICsgYXJncy5pZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgXCInPjxkaXYgY2xhc3M9J2JhcicgaWQ9J2Jhcl9cIiArIGFyZ3MuaWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICArIFwiJz48L2Rpdj48L2Rpdj48c3BhbiBjbGFzcz0ndXBsb2FkX2ZpbmlzaCcgaWQ9J3VwbG9hZF9maW5pc2hfXCIgKyBhcmdzLmlkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBcIic+5LiK5Lyg5a6M5oiQPC9zcGFuPjxzcGFuIGRhdGEtYWN0PSdkZWwnIGRhdGEtdHlwZT0nMCcgY2xhc3M9J2RlbGV0ZSc+5Yig6ZmkPC9zcGFuPjwvZGl2PlwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIGluZm9faXRlbSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdpZCc6IGFyZ3MuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAnc2l6ZSc6IGFyZ3Muc2l6ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdzdGF0ZSc6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAnZmlsZV9pZCc6ICcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3NpemVfdGV4dCc6IGFyZ3Muc2l6ZV90ZXh0LFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnOiAxXG4gICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgZmlsZXNbZmlsZXMubGVuZ3RoXSA9IGluZm9faXRlbTtcbiAgICAgICAgICAgICAgICAgICAgJChcIi52aWRlb0JveFRpdGxlXCIpLnRleHQoYXJncy5uYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgJChcIi52aWRlb1NpemVcIikudGV4dChhcmdzLnNpemVfdGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICQoXCIudXBsb2FkUmF0aW8gc3BhbjpudGgtb2YtdHlwZSgyKVwiKS50ZXh0KGFyZ3Muc2l6ZV90ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgLy/ov5vluqbnmb7liIbmr5Tnva7kuLowXG4gICAgICAgICAgICAgICAgICAgICQoXCIudmlkZW9QZXJjZW50XCIpLnRleHQoXCLop4bpopHmraPlnKjop6PmnpDkuK1cIik7XG4gICAgICAgICAgICAgICAgICAgICQoXCIudXBsb2FkUmF0aW8gc3BhblwiKS50ZXh0KFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICAkKFwiLnZpZGVvVXBsb2FkTGluZUFcIikuY3NzKFwid2lkdGhcIixcIjAlXCIpO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwi5re75Yqg5LqG5LiA5Liq5paw55qE5paH5Lu2OlwiICsgXCJpZDpcIiArIGFyZ3MuaWQgKyBcInNpemU6XCIgKyBhcmdzLnNpemUpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmKGFyZ3MuY29kZT09Mil7XG4gICAgICAgICAgICAgICAgLy9xY1ZpZGVvLnVwbG9hZGVyLnN0YXJ0VXBsb2FkKCk7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVzWzBdWydzdGF0ZSddID0gMjtcbiAgICAgICAgICAgICAgICAgICAgLy92aWRlb1VwbG9hZCgpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChhcmdzLmNvZGUgPT0gNSAmJiBhcmdzLnBlcmNlbnQgPiAwKSAvL+S4iuS8oOi/m+W6puWPkeeUn+WPmOWMllxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHVwbG9hZENvbXBsZXRlU2l6ZT1wYXJzZUZsb2F0KGFyZ3Muc2l6ZV90ZXh0KSpwYXJzZUZsb2F0KGFyZ3MucGVyY2VudC8xMDApO1xuICAgICAgICAgICAgICAgICAgICB1cGxvYWRDb21wbGV0ZVNpemU9dXBsb2FkQ29tcGxldGVTaXplLnRvRml4ZWQoMik7XG4gICAgICAgICAgICAgICAgICAgICQoXCIudmlkZW9VcGxvYWRMaW5lQVwiKS5jc3MoXCJ3aWR0aFwiLGFyZ3MucGVyY2VudCtcIiVcIik7XG4gICAgICAgICAgICAgICAgICAgICQoXCIudmlkZW9QZXJjZW50XCIpLnRleHQoYXJncy5wZXJjZW50K1wiJVwiKTtcbiAgICAgICAgICAgICAgICAgICAgJChcIi51cGxvYWRSYXRpbyBzcGFuOm50aC1vZi10eXBlKDEpXCIpLnRleHQodXBsb2FkQ29tcGxldGVTaXplKTtcbiAgICAgICAgICAgICAgICAgICAgJChcIi51cGxvYWRSYXRpbyBzcGFuOm50aC1vZi10eXBlKDIpXCIpLnRleHQoYXJncy5zaXplX3RleHQpO1xuICAgICAgICAgICAgICAgICAgICBpZighYXJncy5zcGVlZCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKFwiLnVwbG9hZFNwZWVkIHNwYW5cIikudGV4dChcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCIudmlkZW9UaW1lTGVmdCBzcGFuXCIpLnRleHQoXCJcIik7XG4gICAgICAgICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgICAgICAgICAgJChcIi51cGxvYWRTcGVlZCBzcGFuXCIpLnRleHQoYXJncy5zcGVlZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoYXJncy5jb2RlID09IDYpIC8v5LiK5Lyg5oiQ5YqfXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBpc19lZGl0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHZhciB1cGxvYWRDb21wbGV0ZVNpemU9YXJncy5zaXplX3RleHQqYXJncy5wZXJjZW50O1xuICAgICAgICAgICAgICAgICAgICAkKFwiLnZpZGVvVXBsb2FkTGluZUFcIikuY3NzKCd3aWR0aCcsIFwiMTAwJVwiKTtcbiAgICAgICAgICAgICAgICAgICAgJChcIi52aWRlb1BlcmNlbnRcIikudGV4dChcIuW3suWujOaIkFwiKTtcbiAgICAgICAgICAgICAgICAgICAgJChcIi51cGxvYWRSYXRpbyBzcGFuOm50aC1vZi10eXBlKDEpXCIpLnRleHQoYXJncy5zaXplX3RleHQpO1xuICAgICAgICAgICAgICAgICAgICAkKFwiLnVwbG9hZFJhdGlvIHNwYW46bnRoLW9mLXR5cGUoMilcIikudGV4dChhcmdzLnNpemVfdGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVJZD1hcmdzLnNlcnZlckZpbGVJZDtcbiAgICAgICAgICAgICAgICAgICAgLy/kv67mlLlmaWxlc+S4reaWh+S7tueahOeKtuaAgVxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJncy5pZCA9PSBmaWxlc1tpXVsnaWQnXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzW2ldWydzdGF0ZSddID0gNjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlc1tpXVsnZmlsZV9pZCddID0gYXJncy5zZXJ2ZXJGaWxlSWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoaXNVcGxvYWRGaW5pc2goKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy/mj5DkuqTmlofku7ZcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBleHRlcm5hbFBhcmFtcyA9IGdlbmVyYXRlUGFyYW1zKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB1cGxvYWRUb1NlcnZlcihleHRlcm5hbFBhcmFtcyk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGFyZ3MpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiDmlofku7bnirbmgIHlj5HnlJ/lj5jljJZcbiAgICAgICAgICAgICAqIEBwYXJhbSBpbmZvICB7IGRvbmU6IOWujOaIkOaVsOmHjyAsIGZhaWw6IOWksei0peaVsOmHjyAsIHNoYTog6K6h566XU0hB5oiW6ICF562J5b6F6K6h566XU0hB5Lit55qE5pWw6YePICwgd2FpdDog562J5b6F5LiK5Lyg5pWw6YePICwgdXBsb2FkaW5nOiDkuIrkvKDkuK3nmoTmlbDph48gfVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBvbkZpbGVTdGF0dXM6IGZ1bmN0aW9uIChpbmZvKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+WQhOeKtuaAgeaAu+aVsC0tPicgKyBKU09OLnN0cmluZ2lmeShpbmZvKSk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqICDkuIrkvKDml7bplJnor6/mlofku7bov4fmu6Tmj5DnpLpcbiAgICAgICAgICAgICAqIEBwYXJhbSBhcmdzIHtjb2RlOnstMTog5paH5Lu257G75Z6L5byC5bi4LC0yOiDmlofku7blkI3lvILluLh9ICwgbWVzc2FnZTog6ZSZ6K+v5Y6f5ZugIO+8jCBzb2x1dGlvbjog6Kej5Yaz5pa55rOVfVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBvbkZpbHRlckVycm9yOiBmdW5jdGlvbiAoYXJncykge1xuICAgICAgICAgICAgICAgIHZhciBtc2cgPSAnbWVzc2FnZTonICsgYXJncy5tZXNzYWdlICsgKGFyZ3Muc29sdXRpb24gPyAoJztzb2x1dGlvbj09JyArIGFyZ3Muc29sdXRpb24pIDogJycpO1xuICAgICAgICAgICAgICAgaWYoYXJncy5jb2RlPT0tMSl7XG4gICAgICAgICAgICAgICAgICAgYmFzZVV0aWxzLnNob3cucmVkVGlwKFwi6K+35LiK5Lyg5q2j56Gu5qC85byP55qE5paH5Lu2XCIpO1xuICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcblxuICAgICAgICB9XG4gICAgKTtcblxuXG4gICAgLy8gJCgnLnZpZGVvVXBsb2FkQ2FuY2xlJykub24oJ2NsaWNrJywgJ1tkYXRhLWFjdD1cImRlbFwiXScsIGZ1bmN0aW9uIChlKSB7XG4gICAgLy8gICAgIHZhciAkbGluZSA9ICQodGhpcykucGFyZW50KCk7XG4gICAgLy8gICAgIHZhciBmaWxlSWQgPSAkbGluZS5nZXQoMCkuaWQ7XG4gICAgLy8gICAgIExvZy5kZWJ1ZygnZGVsZXRlJywgZmlsZUlkKTtcbiAgICAvLyAgICAgJGxpbmUucmVtb3ZlKCk7XG4gICAgLy8gICAgIC8vQGFwaSDliKDpmaTmlofku7ZcbiAgICAvLyAgICAgcWNWaWRlby51cGxvYWRlci5kZWxldGVGaWxlKGZpbGVJZCk7XG4gICAgLy8gICAgIGRlbGV0ZUZyb21GaWxlKGZpbGVJZCk7IC8v5LuO5paH5Lu25pWw57uE5Lit5Yig6Zmk6K+l5paH5Lu2XG4gICAgLy8gfSk7XG4gICAgJChcIi52aWRlb1VwbG9hZENhbmNsZVwiKS5jbGljayhmdW5jdGlvbigpe1xuICAgICAgICAkKFwiLnZpZGVvVXBsb2FkQm94XCIpLmZhZGVPdXQoMzAwKTtcbiAgICAgICAgTG9nLmRlYnVnKCdkZWxldGUnLCBmaWxlSWQpO1xuICAgICAgICAvLyAkbGluZS5yZW1vdmUoKTtcbiAgICAgICAgLy9AYXBpIOWIoOmZpOaWh+S7tlxuICAgICAgICBxY1ZpZGVvLnVwbG9hZGVyLmRlbGV0ZUZpbGUoZmlsZUlkKTtcbiAgICAgICAgZGVsZXRlRnJvbUZpbGUoZmlsZUlkKTsgLy/ku47mlofku7bmlbDnu4TkuK3liKDpmaTor6Xmlofku7ZcbiAgICAgICAgZmlsZUlkPW51bGw7XG4gICAgfSk7XG59XG5cbi8v5Yig6Zmk5p+Q5Liq5YWD57SgXG5mdW5jdGlvbiBkZWxldGVGcm9tRmlsZShpZCkge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGl0ZW0gPSBmaWxlc1tpXTtcbiAgICAgICAgaWYgKGlkID09IGl0ZW1bJ2lkJ10pIHtcbiAgICAgICAgICAgIC8v5Yig6Zmk6aG555uuXG4gICAgICAgICAgICBmaWxlcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygn5LuOZmlsZXPkuK3liKDpmaTkuobkuIDkuKrmlofku7Y6JyArIGlkKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLy/liKTmlq3kuKTkuKrop4bpopHmmK/lkKbpg73kuIrkvKDlrozmiJDkuoZcbmZ1bmN0aW9uIGlzVXBsb2FkRmluaXNoKCkge1xuICAgIHZhciBpc0ZpbmlzaCA9IHRydWU7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmaWxlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoZmlsZXNbaV1bJ3N0YXRlJ10gIT0gNikgeyAvL+acieS4gOS4quayoeWujOaIkOOAglxuICAgICAgICAgICAgaXNGaW5pc2ggPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaXNGaW5pc2g7XG59XG4vL+eUn+aIkOWPguaVsFxuZnVuY3Rpb24gZ2VuZXJhdGVQYXJhbXMoKSB7XG4gICAgdmFyIGZpbGVfaWRfcGFyYW1zID0ge307XG4gICAgaWYgKGZpbGVzLmxlbmd0aCA9PSAxKSB7XG5cbiAgICAgICAgZmlsZV9pZF9wYXJhbXMgPSB7XG4gICAgICAgICAgICAncHVibGljX3ZpZGVvJzogZmlsZXNbMF1bJ2ZpbGVfaWQnXSwgJ3B1YmxpY19zaXplX3RleHQnOiAoZmlsZXNbMF1bJ3NpemUnXS8oMTAyNCoxMDI0KSlcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIGZpbGVfaWRfcGFyYW1zO1xufVxuXG5cbi8v5LiK5Lyg6Iez5oiR5Lus5pyN5Yqh5ZmoXG4vLyBmdW5jdGlvbiB1cGxvYWRUb1NlcnZlcihleHRlcm5hbFBhcmFtcykge1xuLy8gICAgIHZhciBhbGxQYXJhbXMgPSB7fTtcbi8vICAgICBhbGxQYXJhbXNbJ3Jlc291cmNlX3R5cGUnXSA9IHJlc291cmNlX3R5cGU7XG4vLyAgICAgYWxsUGFyYW1zWydyZXNvdXJjZV9wYXJhbXMnXSA9IGV4dGVybmFsUGFyYW1zO1xuLy8gICAgIGFsbFBhcmFtc1sncGFyYW1zJ10gPSBwYXJhbXM7XG4vLyAgICAgYWxsUGFyYW1zWydpc19zaW5nbGVfc2FsZSddID0gaXNfc2luZ2xlX3NhbGU7XG4vLyAgICAgLy/kuIrkvKDoh7PmnI3liqHlmahcbi8vICAgICAkLnBvc3QoJy91cGxvYWRfdmlkZW8nLCBhbGxQYXJhbXMsIGZ1bmN0aW9uIChyZXN1bHQpIHtcbi8vICAgICAgICAgaGlkZUxvYWRpbmcoKTtcbi8vICAgICAgICAgdmFyIGNvZGUgPSByZXN1bHQuY29kZTtcbi8vICAgICAgICAgdmFyIG1zZyA9IHJlc3VsdC5tc2c7XG4vLyAgICAgICAgIGlmIChjb2RlID09IDApIHtcbi8vICAgICAgICAgICAgIGJhc2VVdGlscy5zaG93LmJsdWVUaXAobXNnLCBmdW5jdGlvbiAoKSB7XG4vLyAgICAgICAgICAgICAgICAgSXNfU2F2ZSA9IGZhbHNlO1xuLy8gICAgICAgICAgICAgICAgIGlmIChhbGxQYXJhbXNbJ3Jlc291cmNlX3R5cGUnXSA9PSAnYXVkaW8nKSB7XG4vLyAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy9hdWRpb19saXN0Jztcbi8vICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFsbFBhcmFtc1sncmVzb3VyY2VfdHlwZSddID09ICd2aWRlbycpIHtcbi8vICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnL3ZpZGVvX2xpc3QnO1xuLy8gICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4vLyAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy9hdWRpb19saXN0Jztcbi8vICAgICAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICB9KTtcbi8vICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgIGJhc2VVdGlscy5zaG93LnJlZFRpcChtc2cpO1xuLy8gICAgICAgICB9XG4vLyAgICAgfSk7XG5cbi8vIH1cblxudmFyIHRyeV9jb3VudD0wO1xuXG4vL+WvueS6juWkp+aWh+S7tizorqHnrpdzaGFyMeWAvOavlOi+g+aFolxuZnVuY3Rpb24gdmlkZW9VcGxvYWQoKSB7XG4gICAgaWYgKHRyeV9jb3VudCA+PSAzMDApIHtcbiAgICAgICAgaGlkZUxvYWRpbmcoKTtcbiAgICAgICAgYmFzZVV0aWxzLnNob3cucmVkVGlwKFwi6KeG6aKR6Kej5p6Q5aSx6LSlLOivt+abtOaWsOa1j+iniOWZqOeJiOacrOmHjeaWsOS4iuS8oFwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzZXRUaW1lb3V0KFxuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZihmaWxlcy5sZW5ndGg+MCYmZmlsZXNbMF1bJ3N0YXRlJ109PTIpeyAvL+WmguaenOino+aekOWujOS6hueahOivnVxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfop6PmnpDlrozmiJAnKTtcbiAgICAgICAgICAgICAgICBxY1ZpZGVvLnVwbG9hZGVyLnN0YXJ0VXBsb2FkKCk7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICB0cnlfY291bnQrKztcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn6Kej5p6Q6L+Y5pyq5a6M5oiQJyk7XG4gICAgICAgICAgICAgICAgdmlkZW9VcGxvYWQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwxMDAwXG4gICAgKVxufVxuXG5cblxuIl19
