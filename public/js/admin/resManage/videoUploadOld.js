var width;var height;var params={};var pay_type=2;var resource_type;var cos=new InitCosCloud;var SID;var Poffset;var files=[];var transcodeNotifyUrl;var secretId;var fileId;var videoGsize;var is_edit=false;$(document).ready(function(){initUpload()});function getParameterByName(e,i){if(!i)i=window.location.href;e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),o=t.exec(i);if(!o)return null;if(!o[2])return"";return decodeURIComponent(o[2].replace(/\+/g," "))}function getObjectURL(e){var i=null;if(window.createObjectURL!=undefined){i=window.createObjectURL(e)}else if(window.URL!=undefined){i=window.URL.createObjectURL(e)}else if(window.webkitURL!=undefined){i=window.webkitURL.createObjectURL(e)}return i}function initUpload(){var e=qcVideo.get("$");var i=qcVideo.get("Version");if(!qcVideo.uploader.supportBrowser()){if(i.IS_MOBILE){baseUtils.show.redTip("当前浏览器不支持上传，请升级系统版本或者下载最新的chrome浏览器")}else{getInternetExplorerVersion()}return}var t=1;var o=0;accountDone("video_file",t,o,"")}var accountDone=function(e,i,t,o){var a=qcVideo.get("$"),d=qcVideo.get("ErrorCode"),s=qcVideo.get("Log"),r=qcVideo.get("JSON"),l=qcVideo.get("util"),n=qcVideo.get("Code"),c=qcVideo.get("Version");qcVideo.uploader.init({web_upload_url:"https://vod.qcloud.com/v2/index.php",secretId:secretId,getSignature:function(e,i){a.ajax({dataType:"json",url:"/getsig?args="+encodeURIComponent(e),success:function(e){i(e["result"])}})},upBtnId:e,isTranscode:i,isWatermark:t,after_sha_start_upload:true,sha1js_path:"/calculator_worker_sha1.js",disable_multi_selection:false,transcodeNotifyUrl:transcodeNotifyUrl,classId:o,filters:{max_file_size:"2gb",mime_types:["MP4"],video_only:true},forceH5Worker:true},{onFileUpdate:function(e){console.log(transcodeNotifyUrl);a("#videoName").hide();a(".videoUploadCancle").data("videoid",e.id);a(".videoUploadBox").fadeIn(300);is_edit=true;var i=e.size;videoGsize=i/(1024*1024);if(videoGsize>1e3){setTimeout(function(){alert("请将视频文件压缩到 1G 以内!")},100);a(".videoUploadCancle").click();return}if(e.code==1){if(files.length==1){if(files[0]!=undefined){var t=files[0].id;qcVideo.uploader.deleteFile(t);deleteFromFile(t);a("#"+t).remove();console.log("删除了一个文件:"+t)}}var o=a("#"+e.id);if(!o.get(0)){a("#progress_show").append("<div class='progress_div' id = '"+e.id+"'><span style='font-size: 12px'>"+e.name+":</span><div class='progress_bar' id = 'progress_bar_"+e.id+"'><div class='bar' id='bar_"+e.id+"'></div></div><span class='upload_finish' id='upload_finish_"+e.id+"'>上传完成</span><span data-act='del' data-type='0' class='delete'>删除</span></div>")}var d={id:e.id,size:e.size,state:0,file_id:"",size_text:e.size_text,type:1};files[files.length]=d;a(".videoBoxTitle").text(e.name);a(".videoSize").text(e.size_text);a(".uploadRatio span:nth-of-type(2)").text(e.size_text);a(".videoPercent").text("视频正在解析中");a(".uploadRatio span").text("");a(".videoUploadLineA").css("width","0%");console.log("添加了一个新的文件:"+"id:"+e.id+"size:"+e.size)}if(e.code==2){files[0]["state"]=2}if(e.code==5&&e.percent>0){var s=parseFloat(e.size_text)*parseFloat(e.percent/100);s=s.toFixed(2);a(".videoUploadLineA").css("width",e.percent+"%");a(".videoPercent").text(e.percent+"%");a(".uploadRatio span:nth-of-type(1)").text(s);a(".uploadRatio span:nth-of-type(2)").text(e.size_text);if(!e.speed){a(".uploadSpeed span").text("");a(".videoTimeLeft span").text("")}else{a(".uploadSpeed span").text(e.speed)}}if(e.code==6){is_edit=false;var s=e.size_text*e.percent;a(".videoUploadLineA").css("width","100%");a(".videoPercent").text("已完成");a(".uploadRatio span:nth-of-type(1)").text(e.size_text);a(".uploadRatio span:nth-of-type(2)").text(e.size_text);fileId=e.serverFileId;VideoName=e.name;for(var r=0;r<files.length;r++){if(e.id==files[r]["id"]){files[r]["state"]=6;files[r]["file_id"]=e.serverFileId;break}}if(isUploadFinish()){var l=generateParams()}}console.log(e)},onFileStatus:function(e){console.log("各状态总数--\x3e"+r.stringify(e))},onFilterError:function(e){var i="message:"+e.message+(e.solution?";solution=="+e.solution:"");if(e.code==-1){baseUtils.show.redTip("请上传正确格式的文件")}}});a(".videoUploadCancle").click(function(){a(".videoUploadBox").fadeOut(300);s.debug("delete",fileId);qcVideo.uploader.deleteFile(fileId);deleteFromFile(fileId);fileId=null})};function deleteFromFile(e){for(var i=0;i<files.length;i++){var t=files[i];if(e==t["id"]){files.splice(i,1);console.log("从files中删除了一个文件:"+e)}}}function isUploadFinish(){var e=true;for(var i=0;i<files.length;i++){if(files[i]["state"]!=6){e=false}}return e}function generateParams(){var e={};if(files.length==1){e={public_video:files[0]["file_id"],public_size_text:files[0]["size"]/(1024*1024)}}return e}var try_count=0;function videoUpload(){if(try_count>=300){hideLoading();baseUtils.show.redTip("视频解析失败,请更新浏览器版本重新上传");return}setTimeout(function(){if(files.length>0&&files[0]["state"]==2){console.log("解析完成");qcVideo.uploader.startUpload()}else{try_count++;console.log("解析还未完成");videoUpload()}},1e3)}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkbWluL3Jlc01hbmFnZS92aWRlb1VwbG9hZE9sZC5qcyJdLCJuYW1lcyI6WyJ3aWR0aCIsImhlaWdodCIsInBhcmFtcyIsInBheV90eXBlIiwicmVzb3VyY2VfdHlwZSIsImNvcyIsIkluaXRDb3NDbG91ZCIsIlNJRCIsIlBvZmZzZXQiLCJmaWxlcyIsInRyYW5zY29kZU5vdGlmeVVybCIsInNlY3JldElkIiwiZmlsZUlkIiwidmlkZW9Hc2l6ZSIsImlzX2VkaXQiLCIkIiwiZG9jdW1lbnQiLCJyZWFkeSIsImluaXRVcGxvYWQiLCJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJuYW1lIiwidXJsIiwid2luZG93IiwibG9jYXRpb24iLCJocmVmIiwicmVwbGFjZSIsInJlZ2V4IiwiUmVnRXhwIiwicmVzdWx0cyIsImV4ZWMiLCJkZWNvZGVVUklDb21wb25lbnQiLCJnZXRPYmplY3RVUkwiLCJmaWxlIiwiY3JlYXRlT2JqZWN0VVJMIiwidW5kZWZpbmVkIiwiVVJMIiwid2Via2l0VVJMIiwicWNWaWRlbyIsImdldCIsIlZlcnNpb24iLCJ1cGxvYWRlciIsInN1cHBvcnRCcm93c2VyIiwiSVNfTU9CSUxFIiwiYmFzZVV0aWxzIiwic2hvdyIsInJlZFRpcCIsImdldEludGVybmV0RXhwbG9yZXJWZXJzaW9uIiwiaXNUcmFuc2NvZGUiLCJpc1dhdGVybWFyayIsImFjY291bnREb25lIiwidXBCdG5JZCIsImNsYXNzSWQiLCJFcnJvckNvZGUiLCJMb2ciLCJKU09OIiwidXRpbCIsIkNvZGUiLCJpbml0Iiwid2ViX3VwbG9hZF91cmwiLCJnZXRTaWduYXR1cmUiLCJhcmdPYmoiLCJkb25lIiwiYWpheCIsImRhdGFUeXBlIiwiZW5jb2RlVVJJQ29tcG9uZW50Iiwic3VjY2VzcyIsImQiLCJhZnRlcl9zaGFfc3RhcnRfdXBsb2FkIiwic2hhMWpzX3BhdGgiLCJkaXNhYmxlX211bHRpX3NlbGVjdGlvbiIsImZpbHRlcnMiLCJtYXhfZmlsZV9zaXplIiwibWltZV90eXBlcyIsInZpZGVvX29ubHkiLCJmb3JjZUg1V29ya2VyIiwib25GaWxlVXBkYXRlIiwiYXJncyIsImNvbnNvbGUiLCJsb2ciLCJoaWRlIiwiZGF0YSIsImlkIiwiZmFkZUluIiwidmlkZW9TaXplUyIsInNpemUiLCJzZXRUaW1lb3V0IiwiYWxlcnQiLCJjbGljayIsImNvZGUiLCJsZW5ndGgiLCJvbGRfaWQiLCJkZWxldGVGaWxlIiwiZGVsZXRlRnJvbUZpbGUiLCJyZW1vdmUiLCIkbGluZSIsImFwcGVuZCIsImluZm9faXRlbSIsInN0YXRlIiwiZmlsZV9pZCIsInNpemVfdGV4dCIsInR5cGUiLCJ0ZXh0IiwiY3NzIiwicGVyY2VudCIsInVwbG9hZENvbXBsZXRlU2l6ZSIsInBhcnNlRmxvYXQiLCJ0b0ZpeGVkIiwic3BlZWQiLCJzZXJ2ZXJGaWxlSWQiLCJWaWRlb05hbWUiLCJpIiwiaXNVcGxvYWRGaW5pc2giLCJleHRlcm5hbFBhcmFtcyIsImdlbmVyYXRlUGFyYW1zIiwib25GaWxlU3RhdHVzIiwiaW5mbyIsInN0cmluZ2lmeSIsIm9uRmlsdGVyRXJyb3IiLCJtc2ciLCJtZXNzYWdlIiwic29sdXRpb24iLCJmYWRlT3V0IiwiZGVidWciLCJpdGVtIiwic3BsaWNlIiwiaXNGaW5pc2giLCJmaWxlX2lkX3BhcmFtcyIsInB1YmxpY192aWRlbyIsInB1YmxpY19zaXplX3RleHQiLCJ0cnlfY291bnQiLCJ2aWRlb1VwbG9hZCIsImhpZGVMb2FkaW5nIiwic3RhcnRVcGxvYWQiXSwibWFwcGluZ3MiOiJBQUFBLEdBQUlBLE1BQ0osSUFBSUMsT0FFSixJQUFJQyxVQUVKLElBQUlDLFVBQVcsQ0FFZixJQUFJQyxjQUtKLElBQUlDLEtBQU0sR0FBSUMsYUFHZCxJQUFJQyxJQUVKLElBQUlDLFFBRUosSUFBSUMsU0FDSixJQUFJQyxtQkFDSixJQUFJQyxTQUNKLElBQUlDLE9BQ0osSUFBSUMsV0FFSixJQUFJQyxTQUFVLEtBR2RDLEdBQUVDLFVBQVVDLE1BQU0sV0FFZEMsY0FVSixTQUFTQyxvQkFBbUJDLEVBQU1D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SyxDQUNuQyxHQUFJYSxHQUFPbEgsTUFBTXFHLEVBQ2pCLElBQUk3QixHQUFNMEMsRUFBSyxNQUFPLENBRWxCbEgsTUFBTW1ILE9BQU9kLEVBQUcsRUFDaEJqQyxTQUFRQyxJQUFJLGtCQUFvQkcsS0FNNUMsUUFBUzhCLGtCQUNMLEdBQUljLEdBQVcsSUFDZixLQUFLLEdBQUlmLEdBQUksRUFBR0EsRUFBSXJHLE1BQU1nRixPQUFRcUIsSUFBSyxDQUNuQyxHQUFJckcsTUFBTXFHLEdBQUcsVUFBWSxFQUFHLENBQ3hCZSxFQUFXLE9BR25CLE1BQU9BLEdBR1gsUUFBU1osa0JBQ0wsR0FBSWEsS0FDSixJQUFJckgsTUFBTWdGLFFBQVUsRUFBRyxDQUVuQnFDLEdBQ0lDLGFBQWdCdEgsTUFBTSxHQUFHLFdBQVl1SCxpQkFBcUJ2SCxNQUFNLEdBQUcsU0FBUyxLQUFLLE9BR3pGLE1BQU9xSCxHQWtDWCxHQUFJRyxXQUFVLENBR2QsU0FBU0MsZUFDTCxHQUFJRCxXQUFhLElBQUssQ0FDbEJFLGFBQ0F4RixXQUFVQyxLQUFLQyxPQUFPLHNCQUN0QixRQUVKd0MsV0FDSSxXQUNJLEdBQUc1RSxNQUFNZ0YsT0FBTyxHQUFHaEYsTUFBTSxHQUFHLFVBQVUsRUFBRSxDQUNwQ29FLFFBQVFDLElBQUksT0FDWnpDLFNBQVFHLFNBQVM0RixrQkFDaEIsQ0FDREgsV0FDQXBELFNBQVFDLElBQUksU0FDWm9ELGlCQUVOIiwiZmlsZSI6ImFkbWluL3Jlc01hbmFnZS92aWRlb1VwbG9hZE9sZC5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciB3aWR0aDtcbnZhciBoZWlnaHQ7XG5cbnZhciBwYXJhbXMgPSB7fTtcblxudmFyIHBheV90eXBlID0gMjsgLy/ku5jotLnnsbvlnossMeihqOekuuWFjei0ueOAgTLooajnpLrljZXkuKrku5jotLksM+ihqOekuuS4k+agj+OAglxuXG52YXIgcmVzb3VyY2VfdHlwZTsvL+WIm+W7uuexu+Wei1xuXG4vL+iFvuiur+S6kei1hOa6kFxuLy92YXIgYnVja2V0TmFtZSA9IHdpbmRvdy5jb3NfYnVja2V0X25hbWU7XG4vL3ZhciBjb3MgPSBuZXcgQ29zQ2xvdWQod2luZG93LmNvc19hcHBfaWQpO1xudmFyIGNvcyA9IG5ldyBJbml0Q29zQ2xvdWQoKTtcblxuLy9TZXRJbnRlcnZhbOi/lOWbnklEXG52YXIgU0lEO1xuLy/mrbvov5vluqbmnaHmr4/mrKHlj5jljJbph49cbnZhciBQb2Zmc2V0O1xuXG52YXIgZmlsZXMgPSBbXTsgLy/lrZjmlL7mlofku7ZcbnZhciB0cmFuc2NvZGVOb3RpZnlVcmw7Ly8g6L2s56CB5oiQ5Yqf5Zue6LCD5Zyw5Z2AXG52YXIgc2VjcmV0SWQ7XG52YXIgZmlsZUlkO1xudmFyIHZpZGVvR3NpemU7XG5cbnZhciBpc19lZGl0ID0gZmFsc2U7XG5cblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICAgIC8v5Yid5aeL5YyW5LiK5Lyg56m66Ze0XG4gICAgaW5pdFVwbG9hZCgpO1xufSk7XG5cblxuLyoqXG4gKiDojrflj5Z1cmnlj4LmlbBcbiAqIEBwYXJhbSBuYW1lXG4gKiBAcGFyYW0gdXJsXG4gKiBAcmV0dXJucyB7Kn1cbiAqL1xuZnVuY3Rpb24gZ2V0UGFyYW1ldGVyQnlOYW1lKG5hbWUsIHVybCkge1xuICAgIGlmICghdXJsKSB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjtcbiAgICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCBcIlxcXFwkJlwiKTtcbiAgICB2YXIgcmVnZXggPSBuZXcgUmVnRXhwKFwiWz8mXVwiICsgbmFtZSArIFwiKD0oW14mI10qKXwmfCN8JClcIiksXG4gICAgICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XG4gICAgaWYgKCFyZXN1bHRzKSByZXR1cm4gbnVsbDtcbiAgICBpZiAoIXJlc3VsdHNbMl0pIHJldHVybiAnJztcbiAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHJlc3VsdHNbMl0ucmVwbGFjZSgvXFwrL2csIFwiIFwiKSk7XG59XG5cbmZ1bmN0aW9uIGdldE9iamVjdFVSTChmaWxlKSB7XG4gICAgdmFyIHVybCA9IG51bGw7XG4gICAgaWYgKHdpbmRvdy5jcmVhdGVPYmplY3RVUkwgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHVybCA9IHdpbmRvdy5jcmVhdGVPYmplY3RVUkwoZmlsZSlcbiAgICB9IGVsc2UgaWYgKHdpbmRvdy5VUkwgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGZpbGUpXG4gICAgfSBlbHNlIGlmICh3aW5kb3cud2Via2l0VVJMICE9IHVuZGVmaW5lZCkge1xuICAgICAgICB1cmwgPSB3aW5kb3cud2Via2l0VVJMLmNyZWF0ZU9iamVjdFVSTChmaWxlKVxuICAgIH1cbiAgICByZXR1cm4gdXJsXG59XG5cblxuLy8g5LiK5Lyg6KeG6aKR5Yid5aeL5YyWXG5mdW5jdGlvbiBpbml0VXBsb2FkKCkge1xuICAgIHZhciAkID0gcWNWaWRlby5nZXQoJyQnKTtcbiAgICB2YXIgVmVyc2lvbiA9IHFjVmlkZW8uZ2V0KCdWZXJzaW9uJyk7XG4gICAgaWYgKCFxY1ZpZGVvLnVwbG9hZGVyLnN1cHBvcnRCcm93c2VyKCkpIHtcbiAgICAgICAgaWYgKFZlcnNpb24uSVNfTU9CSUxFKSB7XG4gICAgICAgICAgICBiYXNlVXRpbHMuc2hvdy5yZWRUaXAoJ+W9k+WJjea1j+iniOWZqOS4jeaUr+aMgeS4iuS8oO+8jOivt+WNh+e6p+ezu+e7n+eJiOacrOaIluiAheS4i+i9veacgOaWsOeahGNocm9tZea1j+iniOWZqCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZ2V0SW50ZXJuZXRFeHBsb3JlclZlcnNpb24oKTtcbiAgICAgICAgICAgIC8vIGJhc2VVdGlscy5zaG93LnJlZFRpcCgn5b2T5YmN5rWP6KeI5Zmo5LiN5pSv5oyB5LiK5Lyg77yM6K+35Y2H57qn5rWP6KeI5Zmo5oiW6ICF5LiL6L295pyA5paw55qEY2hyb21l5rWP6KeI5ZmoJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICAvL+WPlua2iOS4iuS8oOW5tuWIoOmZpOaWh+S7tlxuICAgIHZhciBpc1RyYW5zY29kZSA9IDE7IC8v5byA5ZCv6L2s56CBXG4gICAgdmFyIGlzV2F0ZXJtYXJrID0gMDsvLyDmsLTljbBcblxuICAgIGFjY291bnREb25lKCd2aWRlb19maWxlJywgaXNUcmFuc2NvZGUsIGlzV2F0ZXJtYXJrLCBcIlwiKTtcbn1cblxudmFyIGFjY291bnREb25lID0gZnVuY3Rpb24gKHVwQnRuSWQsIGlzVHJhbnNjb2RlLCBpc1dhdGVybWFyaywgY2xhc3NJZCkge1xuXG4gICAgdmFyICQgPSBxY1ZpZGVvLmdldCgnJCcpXG4gICAgICAgICwgRXJyb3JDb2RlID0gcWNWaWRlby5nZXQoJ0Vycm9yQ29kZScpXG4gICAgICAgICwgTG9nID0gcWNWaWRlby5nZXQoJ0xvZycpXG4gICAgICAgICwgSlNPTiA9IHFjVmlkZW8uZ2V0KCdKU09OJylcbiAgICAgICAgLCB1dGlsID0gcWNWaWRlby5nZXQoJ3V0aWwnKVxuICAgICAgICAsIENvZGUgPSBxY1ZpZGVvLmdldCgnQ29kZScpXG4gICAgICAgICwgVmVyc2lvbiA9IHFjVmlkZW8uZ2V0KCdWZXJzaW9uJylcbiAgICAgICAgO1xuICAgIHFjVmlkZW8udXBsb2FkZXIuaW5pdChcbiAgICAgICAge1xuICAgICAgICAgICAgd2ViX3VwbG9hZF91cmw6ICdodHRwczovL3ZvZC5xY2xvdWQuY29tL3YyL2luZGV4LnBocCcsXG4gICAgICAgICAgICBzZWNyZXRJZDogc2VjcmV0SWQsIC8vIOS6kWFwaSBzZWNyZXRJZFxuXG4gICAgICAgICAgICBnZXRTaWduYXR1cmU6IGZ1bmN0aW9uIChhcmdPYmosIGRvbmUpXG4gICAgICAgICAgICB7Ly/ms6jmhI/vvJrlh7rkuo7lronlhajogIPomZHvvIwg5pyN5Yqh56uv5o6l5pS2YXJnU3Ry6L+Z5Liq5Y+C5pWw5ZCO77yM6ZyA6KaB5qCh6aqM5YW25Lit55qEQWN0aW9u5Y+C5pWw5piv5ZCm5Li6IFwiTXVsdGlwYXJ0VXBsb2FkVm9kRmlsZVwiLOeUqOadpeivgeaYjuivpeWPguaVsOagh+ivhuS4iuS8oOivt+axglxuICAgICAgICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgICdkYXRhVHlwZSc6ICdqc29uJyxcbiAgICAgICAgICAgICAgICAgICAgJ3VybCc6ICcvZ2V0c2lnP2FyZ3M9JyArIGVuY29kZVVSSUNvbXBvbmVudChhcmdPYmopLFxuICAgICAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6IGZ1bmN0aW9uIChkKVxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkb25lKGRbJ3Jlc3VsdCddKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgdXBCdG5JZDogdXBCdG5JZCwgLy/kuIrkvKDmjInpkq5JRO+8iOS7u+aEj+mhtemdouWFg+e0oElE77yJXG4gICAgICAgICAgICBpc1RyYW5zY29kZTogaXNUcmFuc2NvZGUsLy/mmK/lkKbovaznoIFcbiAgICAgICAgICAgIGlzV2F0ZXJtYXJrOiBpc1dhdGVybWFyaywvL+aYr+WQpuiuvue9ruawtOWNsFxuICAgICAgICAgICAgYWZ0ZXJfc2hhX3N0YXJ0X3VwbG9hZDogdHJ1ZSwvL3NoYeiuoeeul+WujOaIkOWQju+8jOW8gOWni+S4iuS8oCAo6buY6K6k5YWz6Zet56uL5Y2z5LiK5LygKVxuICAgICAgICAgICAgc2hhMWpzX3BhdGg6ICcvY2FsY3VsYXRvcl93b3JrZXJfc2hhMS5qcycsIC8v6K6h566Xc2hhMeeahOS9jee9rlxuICAgICAgICAgICAgZGlzYWJsZV9tdWx0aV9zZWxlY3Rpb246IGZhbHNlLCAvL+emgeeUqOWkmumAiSDvvIzpu5jorqTkuLpmYWxzZVxuICAgICAgICAgICAgdHJhbnNjb2RlTm90aWZ5VXJsOiB0cmFuc2NvZGVOb3RpZnlVcmwsLy8o6L2s56CB5oiQ5Yqf5ZCO55qE5Zue6LCD5Zyw5Z2AKWlzVHJhbnNjb2RlPT10cnVlLOaXtuW8gOWQr++8myDlm57osIN1cmznmoTov5Tlm57mlbDmja7moLzlvI/lj4LogIMgIGh0dHA6Ly93d3cucWNsb3VkLmNvbS93aWtpL3YyL011bHRpcGFydFVwbG9hZFZvZEZpbGVcbiAgICAgICAgICAgIGNsYXNzSWQ6IGNsYXNzSWQsXG4gICAgICAgICAgICBmaWx0ZXJzOiB7bWF4X2ZpbGVfc2l6ZTogJzJnYicsIG1pbWVfdHlwZXM6IFsnTVA0J10sIHZpZGVvX29ubHk6IHRydWV9LFxuICAgICAgICAgICAgLy9mb3JjZUg1V29ya2VyOiAhIXBhcnNlSW50KGdldFBhcmFtZXRlckJ5TmFtZSgnZm9yY2VINVdvcmtlcicpKSB8fCBmYWxzZSxcbiAgICAgICAgICAgIGZvcmNlSDVXb3JrZXI6IHRydWVcbiAgICAgICAgfVxuICAgICAgICAsIHtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiDmm7TmlrDmlofku7bnirbmgIHlkozov5vluqZcbiAgICAgICAgICAgICAqIGNvZGU6MeOAgeWHhuWkh+iuoeeul1NIQSAy44CB562J5b6F5LiK5LygIDPjgIFTSEHorqHnrpfkuK0gNOOAgeWNs+WwhuS4iuS8oCA144CB5LiK5Lyg6L+b5bqm5pu05pawIDbjgIHkuIrkvKDlrozmiJBcbiAgICAgICAgICAgICAqIEBwYXJhbSBhcmdzIHsgaWQ6IOaWh+S7tklELCBzaXplOiDmlofku7blpKflsI8sIG5hbWU6IOaWh+S7tuWQjeensCwgc3RhdHVzOiDnirbmgIEsIHBlcmNlbnQ6IOi/m+W6piBzcGVlZDog6YCf5bqmLCBlcnJvckNvZGU6IOmUmeivr+eggSxzZXJ2ZXJGaWxlSWQ6IOWQjuerr+aWh+S7tklEIH1cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgb25GaWxlVXBkYXRlOiBmdW5jdGlvbiAoYXJncykge1xuICAgICAgICAgICAgICAgIC8v6I635Y+W5LiK5Lyg5paH5Lu2aWRcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0cmFuc2NvZGVOb3RpZnlVcmwpO1xuICAgICAgICAgICAgICAgICQoJyN2aWRlb05hbWUnKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgJChcIi52aWRlb1VwbG9hZENhbmNsZVwiKS5kYXRhKCd2aWRlb2lkJyxhcmdzLmlkKTtcbiAgICAgICAgICAgICAgICAkKFwiLnZpZGVvVXBsb2FkQm94XCIpLmZhZGVJbigzMDApO1xuICAgICAgICAgICAgICAgIC8vZmlsZUlkPWFyZ3MuaWQ7XG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhmaWxlSWQpO1xuICAgICAgICAgICAgICAgIGlzX2VkaXQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIC8v5Yik5pat5LiK5Lyg6KeG6aKR5aSn5bCPXG4gICAgICAgICAgICAgICAgdmFyIHZpZGVvU2l6ZVMgPSBhcmdzLnNpemU7XG4gICAgICAgICAgICAgICAgdmlkZW9Hc2l6ZSA9IHZpZGVvU2l6ZVMvKDEwMjQqMTAyNCk7XG5cbiAgICAgICAgICAgICAgICAvLyDlpoLmnpzop4bpopHlpKflsI/lpKfkuo4xR++8jOWImeWcqOS4iuS8oOa1geeoi+S4reWIoOmZpOW9k+WJjeaWh+S7tlxuICAgICAgICAgICAgICAgIGlmKHZpZGVvR3NpemU+MTAwMCl7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoXCLor7flsIbop4bpopHmlofku7bljovnvKnliLAgMUcg5Lul5YaFIVwiKVxuICAgICAgICAgICAgICAgICAgICB9LDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIHFjVmlkZW8udXBsb2FkZXIuZGVsZXRlRmlsZShhcmdzLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gZGVsZXRlRnJvbUZpbGUoYXJncy5pZCk7IC8v5LuO5paH5Lu25pWw57uE5Lit5Yig6Zmk6K+l5paH5Lu2XG4gICAgICAgICAgICAgICAgICAgIC8vICQoJyMnICsgYXJncy5pZCkucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCfmlofku7botoXov4cxRyzmj5DnpLrph43mlrDpgInmi6nop4bpopHmlofku7Y6JyArIGFyZ3MuaWQpO1xuICAgICAgICAgICAgICAgICAgICAvLyBhcmdzID0gJyc7XG4gICAgICAgICAgICAgICAgICAgICQoXCIudmlkZW9VcGxvYWRDYW5jbGVcIikuY2xpY2soKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoYXJncy5jb2RlID09IDEpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZXMubGVuZ3RoID09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8v5Yig6Zmk5LmL5YmN55qE5re75Yqg5paw55qEXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZXNbMF0gIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9sZF9pZCA9IGZpbGVzWzBdLmlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFjVmlkZW8udXBsb2FkZXIuZGVsZXRlRmlsZShvbGRfaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZUZyb21GaWxlKG9sZF9pZCk7IC8v5LuO5paH5Lu25pWw57uE5Lit5Yig6Zmk6K+l5paH5Lu2XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnIycgKyBvbGRfaWQpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfliKDpmaTkuobkuIDkuKrmlofku7Y6JyArIG9sZF9pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgJGxpbmUgPSAkKFwiI1wiICsgYXJncy5pZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghJGxpbmUuZ2V0KDApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjcHJvZ3Jlc3Nfc2hvdycpLmFwcGVuZChcIjxkaXYgY2xhc3M9J3Byb2dyZXNzX2RpdicgaWQgPSAnXCIgKyBhcmdzLmlkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBcIic+PHNwYW4gc3R5bGU9J2ZvbnQtc2l6ZTogMTJweCc+XCIgKyBhcmdzLm5hbWUgKyBcIjo8L3NwYW4+PGRpdiBjbGFzcz0ncHJvZ3Jlc3NfYmFyJyBpZCA9ICdwcm9ncmVzc19iYXJfXCIgKyBhcmdzLmlkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBcIic+PGRpdiBjbGFzcz0nYmFyJyBpZD0nYmFyX1wiICsgYXJncy5pZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgXCInPjwvZGl2PjwvZGl2PjxzcGFuIGNsYXNzPSd1cGxvYWRfZmluaXNoJyBpZD0ndXBsb2FkX2ZpbmlzaF9cIiArIGFyZ3MuaWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICArIFwiJz7kuIrkvKDlrozmiJA8L3NwYW4+PHNwYW4gZGF0YS1hY3Q9J2RlbCcgZGF0YS10eXBlPScwJyBjbGFzcz0nZGVsZXRlJz7liKDpmaQ8L3NwYW4+PC9kaXY+XCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgICAgICAgICB2YXIgaW5mb19pdGVtID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ2lkJzogYXJncy5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdzaXplJzogYXJncy5zaXplLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXRlJzogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdmaWxlX2lkJzogJycsXG4gICAgICAgICAgICAgICAgICAgICAgICAnc2l6ZV90ZXh0JzogYXJncy5zaXplX3RleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAndHlwZSc6IDFcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBmaWxlc1tmaWxlcy5sZW5ndGhdID0gaW5mb19pdGVtO1xuICAgICAgICAgICAgICAgICAgICAkKFwiLnZpZGVvQm94VGl0bGVcIikudGV4dChhcmdzLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAkKFwiLnZpZGVvU2l6ZVwiKS50ZXh0KGFyZ3Muc2l6ZV90ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgJChcIi51cGxvYWRSYXRpbyBzcGFuOm50aC1vZi10eXBlKDIpXCIpLnRleHQoYXJncy5zaXplX3RleHQpO1xuICAgICAgICAgICAgICAgICAgICAvL+i/m+W6pueZvuWIhuavlOe9ruS4ujBcbiAgICAgICAgICAgICAgICAgICAgJChcIi52aWRlb1BlcmNlbnRcIikudGV4dChcIuinhumikeato+WcqOino+aekOS4rVwiKTtcbiAgICAgICAgICAgICAgICAgICAgJChcIi51cGxvYWRSYXRpbyBzcGFuXCIpLnRleHQoXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICQoXCIudmlkZW9VcGxvYWRMaW5lQVwiKS5jc3MoXCJ3aWR0aFwiLFwiMCVcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCLmt7vliqDkuobkuIDkuKrmlrDnmoTmlofku7Y6XCIgKyBcImlkOlwiICsgYXJncy5pZCArIFwic2l6ZTpcIiArIGFyZ3Muc2l6ZSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYoYXJncy5jb2RlPT0yKXtcbiAgICAgICAgICAgICAgICAvL3FjVmlkZW8udXBsb2FkZXIuc3RhcnRVcGxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgZmlsZXNbMF1bJ3N0YXRlJ10gPSAyO1xuICAgICAgICAgICAgICAgICAgICAvL3ZpZGVvVXBsb2FkKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGFyZ3MuY29kZSA9PSA1ICYmIGFyZ3MucGVyY2VudCA+IDApIC8v5LiK5Lyg6L+b5bqm5Y+R55Sf5Y+Y5YyWXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdXBsb2FkQ29tcGxldGVTaXplPXBhcnNlRmxvYXQoYXJncy5zaXplX3RleHQpKnBhcnNlRmxvYXQoYXJncy5wZXJjZW50LzEwMCk7XG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZENvbXBsZXRlU2l6ZT11cGxvYWRDb21wbGV0ZVNpemUudG9GaXhlZCgyKTtcbiAgICAgICAgICAgICAgICAgICAgJChcIi52aWRlb1VwbG9hZExpbmVBXCIpLmNzcyhcIndpZHRoXCIsYXJncy5wZXJjZW50K1wiJVwiKTtcbiAgICAgICAgICAgICAgICAgICAgJChcIi52aWRlb1BlcmNlbnRcIikudGV4dChhcmdzLnBlcmNlbnQrXCIlXCIpO1xuICAgICAgICAgICAgICAgICAgICAkKFwiLnVwbG9hZFJhdGlvIHNwYW46bnRoLW9mLXR5cGUoMSlcIikudGV4dCh1cGxvYWRDb21wbGV0ZVNpemUpO1xuICAgICAgICAgICAgICAgICAgICAkKFwiLnVwbG9hZFJhdGlvIHNwYW46bnRoLW9mLXR5cGUoMilcIikudGV4dChhcmdzLnNpemVfdGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGlmKCFhcmdzLnNwZWVkKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCIudXBsb2FkU3BlZWQgc3BhblwiKS50ZXh0KFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJChcIi52aWRlb1RpbWVMZWZ0IHNwYW5cIikudGV4dChcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKFwiLnVwbG9hZFNwZWVkIHNwYW5cIikudGV4dChhcmdzLnNwZWVkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChhcmdzLmNvZGUgPT0gNikgLy/kuIrkvKDmiJDlip9cbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGlzX2VkaXQgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgdXBsb2FkQ29tcGxldGVTaXplPWFyZ3Muc2l6ZV90ZXh0KmFyZ3MucGVyY2VudDtcbiAgICAgICAgICAgICAgICAgICAgJChcIi52aWRlb1VwbG9hZExpbmVBXCIpLmNzcygnd2lkdGgnLCBcIjEwMCVcIik7XG4gICAgICAgICAgICAgICAgICAgICQoXCIudmlkZW9QZXJjZW50XCIpLnRleHQoXCLlt7LlrozmiJBcIik7XG4gICAgICAgICAgICAgICAgICAgICQoXCIudXBsb2FkUmF0aW8gc3BhbjpudGgtb2YtdHlwZSgxKVwiKS50ZXh0KGFyZ3Muc2l6ZV90ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgJChcIi51cGxvYWRSYXRpbyBzcGFuOm50aC1vZi10eXBlKDIpXCIpLnRleHQoYXJncy5zaXplX3RleHQpO1xuICAgICAgICAgICAgICAgICAgICBmaWxlSWQ9YXJncy5zZXJ2ZXJGaWxlSWQ7XG4gICAgICAgICAgICAgICAgICAgIFZpZGVvTmFtZSA9IGFyZ3MubmFtZTtcbiAgICAgICAgICAgICAgICAgICAgLy/kv67mlLlmaWxlc+S4reaWh+S7tueahOeKtuaAgVxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJncy5pZCA9PSBmaWxlc1tpXVsnaWQnXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzW2ldWydzdGF0ZSddID0gNjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlc1tpXVsnZmlsZV9pZCddID0gYXJncy5zZXJ2ZXJGaWxlSWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBpZiAoaXNVcGxvYWRGaW5pc2goKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy/mj5DkuqTmlofku7ZcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBleHRlcm5hbFBhcmFtcyA9IGdlbmVyYXRlUGFyYW1zKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB1cGxvYWRUb1NlcnZlcihleHRlcm5hbFBhcmFtcyk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGFyZ3MpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiDmlofku7bnirbmgIHlj5HnlJ/lj5jljJZcbiAgICAgICAgICAgICAqIEBwYXJhbSBpbmZvICB7IGRvbmU6IOWujOaIkOaVsOmHjyAsIGZhaWw6IOWksei0peaVsOmHjyAsIHNoYTog6K6h566XU0hB5oiW6ICF562J5b6F6K6h566XU0hB5Lit55qE5pWw6YePICwgd2FpdDog562J5b6F5LiK5Lyg5pWw6YePICwgdXBsb2FkaW5nOiDkuIrkvKDkuK3nmoTmlbDph48gfVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBvbkZpbGVTdGF0dXM6IGZ1bmN0aW9uIChpbmZvKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+WQhOeKtuaAgeaAu+aVsC0tPicgKyBKU09OLnN0cmluZ2lmeShpbmZvKSk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqICDkuIrkvKDml7bplJnor6/mlofku7bov4fmu6Tmj5DnpLpcbiAgICAgICAgICAgICAqIEBwYXJhbSBhcmdzIHtjb2RlOnstMTog5paH5Lu257G75Z6L5byC5bi4LC0yOiDmlofku7blkI3lvILluLh9ICwgbWVzc2FnZTog6ZSZ6K+v5Y6f5ZugIO+8jCBzb2x1dGlvbjog6Kej5Yaz5pa55rOVfVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBvbkZpbHRlckVycm9yOiBmdW5jdGlvbiAoYXJncykge1xuICAgICAgICAgICAgICAgIHZhciBtc2cgPSAnbWVzc2FnZTonICsgYXJncy5tZXNzYWdlICsgKGFyZ3Muc29sdXRpb24gPyAoJztzb2x1dGlvbj09JyArIGFyZ3Muc29sdXRpb24pIDogJycpO1xuICAgICAgICAgICAgICAgaWYoYXJncy5jb2RlPT0tMSl7XG4gICAgICAgICAgICAgICAgICAgYmFzZVV0aWxzLnNob3cucmVkVGlwKFwi6K+35LiK5Lyg5q2j56Gu5qC85byP55qE5paH5Lu2XCIpO1xuICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcblxuICAgICAgICB9XG4gICAgKTtcblxuXG4gICAgLy8gJCgnLnZpZGVvVXBsb2FkQ2FuY2xlJykub24oJ2NsaWNrJywgJ1tkYXRhLWFjdD1cImRlbFwiXScsIGZ1bmN0aW9uIChlKSB7XG4gICAgLy8gICAgIHZhciAkbGluZSA9ICQodGhpcykucGFyZW50KCk7XG4gICAgLy8gICAgIHZhciBmaWxlSWQgPSAkbGluZS5nZXQoMCkuaWQ7XG4gICAgLy8gICAgIExvZy5kZWJ1ZygnZGVsZXRlJywgZmlsZUlkKTtcbiAgICAvLyAgICAgJGxpbmUucmVtb3ZlKCk7XG4gICAgLy8gICAgIC8vQGFwaSDliKDpmaTmlofku7ZcbiAgICAvLyAgICAgcWNWaWRlby51cGxvYWRlci5kZWxldGVGaWxlKGZpbGVJZCk7XG4gICAgLy8gICAgIGRlbGV0ZUZyb21GaWxlKGZpbGVJZCk7IC8v5LuO5paH5Lu25pWw57uE5Lit5Yig6Zmk6K+l5paH5Lu2XG4gICAgLy8gfSk7XG4gICAgJChcIi52aWRlb1VwbG9hZENhbmNsZVwiKS5jbGljayhmdW5jdGlvbigpe1xuICAgICAgICAkKFwiLnZpZGVvVXBsb2FkQm94XCIpLmZhZGVPdXQoMzAwKTtcbiAgICAgICAgTG9nLmRlYnVnKCdkZWxldGUnLCBmaWxlSWQpO1xuICAgICAgICAvLyAkbGluZS5yZW1vdmUoKTtcbiAgICAgICAgLy9AYXBpIOWIoOmZpOaWh+S7tlxuICAgICAgICBxY1ZpZGVvLnVwbG9hZGVyLmRlbGV0ZUZpbGUoZmlsZUlkKTtcbiAgICAgICAgZGVsZXRlRnJvbUZpbGUoZmlsZUlkKTsgLy/ku47mlofku7bmlbDnu4TkuK3liKDpmaTor6Xmlofku7ZcbiAgICAgICAgZmlsZUlkPW51bGw7XG4gICAgfSk7XG59XG5cbi8v5Yig6Zmk5p+Q5Liq5YWD57SgXG5mdW5jdGlvbiBkZWxldGVGcm9tRmlsZShpZCkge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGl0ZW0gPSBmaWxlc1tpXTtcbiAgICAgICAgaWYgKGlkID09IGl0ZW1bJ2lkJ10pIHtcbiAgICAgICAgICAgIC8v5Yig6Zmk6aG555uuXG4gICAgICAgICAgICBmaWxlcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygn5LuOZmlsZXPkuK3liKDpmaTkuobkuIDkuKrmlofku7Y6JyArIGlkKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLy/liKTmlq3kuKTkuKrop4bpopHmmK/lkKbpg73kuIrkvKDlrozmiJDkuoZcbmZ1bmN0aW9uIGlzVXBsb2FkRmluaXNoKCkge1xuICAgIHZhciBpc0ZpbmlzaCA9IHRydWU7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmaWxlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoZmlsZXNbaV1bJ3N0YXRlJ10gIT0gNikgeyAvL+acieS4gOS4quayoeWujOaIkOOAglxuICAgICAgICAgICAgaXNGaW5pc2ggPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaXNGaW5pc2g7XG59XG4vL+eUn+aIkOWPguaVsFxuZnVuY3Rpb24gZ2VuZXJhdGVQYXJhbXMoKSB7XG4gICAgdmFyIGZpbGVfaWRfcGFyYW1zID0ge307XG4gICAgaWYgKGZpbGVzLmxlbmd0aCA9PSAxKSB7XG5cbiAgICAgICAgZmlsZV9pZF9wYXJhbXMgPSB7XG4gICAgICAgICAgICAncHVibGljX3ZpZGVvJzogZmlsZXNbMF1bJ2ZpbGVfaWQnXSwgJ3B1YmxpY19zaXplX3RleHQnOiAoZmlsZXNbMF1bJ3NpemUnXS8oMTAyNCoxMDI0KSlcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIGZpbGVfaWRfcGFyYW1zO1xufVxuXG5cbi8v5LiK5Lyg6Iez5oiR5Lus5pyN5Yqh5ZmoXG4vLyBmdW5jdGlvbiB1cGxvYWRUb1NlcnZlcihleHRlcm5hbFBhcmFtcykge1xuLy8gICAgIHZhciBhbGxQYXJhbXMgPSB7fTtcbi8vICAgICBhbGxQYXJhbXNbJ3Jlc291cmNlX3R5cGUnXSA9IHJlc291cmNlX3R5cGU7XG4vLyAgICAgYWxsUGFyYW1zWydyZXNvdXJjZV9wYXJhbXMnXSA9IGV4dGVybmFsUGFyYW1zO1xuLy8gICAgIGFsbFBhcmFtc1sncGFyYW1zJ10gPSBwYXJhbXM7XG4vLyAgICAgYWxsUGFyYW1zWydpc19zaW5nbGVfc2FsZSddID0gaXNfc2luZ2xlX3NhbGU7XG4vLyAgICAgLy/kuIrkvKDoh7PmnI3liqHlmahcbi8vICAgICAkLnBvc3QoJy91cGxvYWRfdmlkZW8nLCBhbGxQYXJhbXMsIGZ1bmN0aW9uIChyZXN1bHQpIHtcbi8vICAgICAgICAgaGlkZUxvYWRpbmcoKTtcbi8vICAgICAgICAgdmFyIGNvZGUgPSByZXN1bHQuY29kZTtcbi8vICAgICAgICAgdmFyIG1zZyA9IHJlc3VsdC5tc2c7XG4vLyAgICAgICAgIGlmIChjb2RlID09IDApIHtcbi8vICAgICAgICAgICAgIGJhc2VVdGlscy5zaG93LmJsdWVUaXAobXNnLCBmdW5jdGlvbiAoKSB7XG4vLyAgICAgICAgICAgICAgICAgSXNfU2F2ZSA9IGZhbHNlO1xuLy8gICAgICAgICAgICAgICAgIGlmIChhbGxQYXJhbXNbJ3Jlc291cmNlX3R5cGUnXSA9PSAnYXVkaW8nKSB7XG4vLyAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy9hdWRpb19saXN0Jztcbi8vICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFsbFBhcmFtc1sncmVzb3VyY2VfdHlwZSddID09ICd2aWRlbycpIHtcbi8vICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnL3ZpZGVvX2xpc3QnO1xuLy8gICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4vLyAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gJy9hdWRpb19saXN0Jztcbi8vICAgICAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICB9KTtcbi8vICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgIGJhc2VVdGlscy5zaG93LnJlZFRpcChtc2cpO1xuLy8gICAgICAgICB9XG4vLyAgICAgfSk7XG5cbi8vIH1cblxudmFyIHRyeV9jb3VudD0wO1xuXG4vL+WvueS6juWkp+aWh+S7tizorqHnrpdzaGFyMeWAvOavlOi+g+aFolxuZnVuY3Rpb24gdmlkZW9VcGxvYWQoKSB7XG4gICAgaWYgKHRyeV9jb3VudCA+PSAzMDApIHtcbiAgICAgICAgaGlkZUxvYWRpbmcoKTtcbiAgICAgICAgYmFzZVV0aWxzLnNob3cucmVkVGlwKFwi6KeG6aKR6Kej5p6Q5aSx6LSlLOivt+abtOaWsOa1j+iniOWZqOeJiOacrOmHjeaWsOS4iuS8oFwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBzZXRUaW1lb3V0KFxuICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZihmaWxlcy5sZW5ndGg+MCYmZmlsZXNbMF1bJ3N0YXRlJ109PTIpeyAvL+WmguaenOino+aekOWujOS6hueahOivnVxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfop6PmnpDlrozmiJAnKTtcbiAgICAgICAgICAgICAgICBxY1ZpZGVvLnVwbG9hZGVyLnN0YXJ0VXBsb2FkKCk7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICB0cnlfY291bnQrKztcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn6Kej5p6Q6L+Y5pyq5a6M5oiQJyk7XG4gICAgICAgICAgICAgICAgdmlkZW9VcGxvYWQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwxMDAwXG4gICAgKVxufVxuXG5cblxuIl19
