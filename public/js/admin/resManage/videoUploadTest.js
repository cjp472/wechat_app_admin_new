var width;var height;var params={};var pay_type=2;var resource_type;var cos=new InitCosCloud;var SID;var Poffset;var files=[];var transcodeNotifyUrl;var secretId;var fileId;var videoGsize;var is_edit=false;$(document).ready(function(){initUpload()});function getParameterByName(e,i){if(!i)i=window.location.href;e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),o=t.exec(i);if(!o)return null;if(!o[2])return"";return decodeURIComponent(o[2].replace(/\+/g," "))}function getObjectURL(e){var i=null;if(window.createObjectURL!=undefined){i=window.createObjectURL(e)}else if(window.URL!=undefined){i=window.URL.createObjectURL(e)}else if(window.webkitURL!=undefined){i=window.webkitURL.createObjectURL(e)}return i}function initUpload(){var e=qcVideo.get("$");var i=qcVideo.get("Version");if(!qcVideo.uploader.supportBrowser()){if(i.IS_MOBILE){baseUtils.show.redTip("当前浏览器不支持上传，请升级系统版本或者下载最新的chrome浏览器")}else{getInternetExplorerVersion()}return}var t=1;var o=0;accountDone("video_file",t,o,"")}var accountDone=function(e,i,t,o){var d=qcVideo.get("$"),a=qcVideo.get("ErrorCode"),s=qcVideo.get("Log"),r=qcVideo.get("JSON"),l=qcVideo.get("util"),n=qcVideo.get("Code"),c=qcVideo.get("Version");qcVideo.uploader.init({web_upload_url:"https://vod2.qcloud.com/v3/index.php",getSignature:function(e,i){console.log(1);console.log(e.ft);e["s"]="AKIDTdzn2PhgeuKvr2ue4dSbMHWSDMjK8d7v";e["uid"]="必填";var t=[];for(var o in e)t.push(o+"="+encodeURIComponent(e[o]));t=t.join("&");var d=CryptoJS.HmacSHA1(t,"O4gThhgoyWCCZ3mp44CyovASyh96hmy4");d.concat(CryptoJS.enc.Utf8.parse(t));i(CryptoJS.enc.Base64.stringify(d))},upBtnId:e,isTranscode:i,isWatermark:t,after_sha_start_upload:true,sha1js_path:"/calculator_worker_sha1.js",disable_multi_selection:false,transcodeNotifyUrl:transcodeNotifyUrl,classId:o,filters:{max_file_size:"2gb",mime_types:["MP4"],video_only:true},forceH5Worker:true},{onFileUpdate:function(e){console.log(transcodeNotifyUrl);d(".videoUploadCancle").data("videoid",e.id);d(".videoUploadBox").fadeIn(300);var i=e.size;videoGsize=i/(1024*1024);is_edit=true;if(videoGsize>1e3){setTimeout(function(){alert("请将视频文件压缩到 1G 以内!")},100);qcVideo.uploader.deleteFile(e.id);deleteFromFile(e.id);d("#"+e.id).remove();console.log("文件超过1G,提示重新选择视频文件:"+e.id);e="";return}if(e.code==1){if(files.length==1){if(files[0]!=undefined){var t=files[0].id;qcVideo.uploader.deleteFile(t);deleteFromFile(t);d("#"+t).remove();console.log("删除了一个文件:"+t)}}var o=d("#"+e.id);if(!o.get(0)){d("#progress_show").append("<div class='progress_div' id = '"+e.id+"'><span style='font-size: 12px'>"+e.name+":</span><div class='progress_bar' id = 'progress_bar_"+e.id+"'><div class='bar' id='bar_"+e.id+"'></div></div><span class='upload_finish' id='upload_finish_"+e.id+"'>上传完成</span><span data-act='del' data-type='0' class='delete'>删除</span></div>")}var a={id:e.id,size:e.size,state:0,file_id:"",size_text:e.size_text,type:1};files[files.length]=a;d(".videoBoxTitle").text(e.name);d(".videoSize").text(e.size_text);d(".uploadRatio span:nth-of-type(2)").text(e.size_text);d(".videoPercent").text("视频正在解析中");d(".uploadRatio span").text("");d(".videoUploadLineA").css("width","0%");console.log("添加了一个新的文件:"+"id:"+e.id+"size:"+e.size)}if(e.code==2){files[0]["state"]=2}if(e.code==5&&e.percent>0){var s=parseFloat(e.size_text)*parseFloat(e.percent/100);s=s.toFixed(2);d(".videoUploadLineA").css("width",e.percent+"%");d(".videoPercent").text(e.percent+"%");d(".uploadRatio span:nth-of-type(1)").text(s);d(".uploadRatio span:nth-of-type(2)").text(e.size_text);if(!e.speed){d(".uploadSpeed span").text("");d(".videoTimeLeft span").text("")}else{d(".uploadSpeed span").text(e.speed)}}if(e.code==6){is_edit=false;var s=e.size_text*e.percent;d(".videoUploadLineA").css("width","100%");d(".videoPercent").text("已完成");d(".uploadRatio span:nth-of-type(1)").text(e.size_text);d(".uploadRatio span:nth-of-type(2)").text(e.size_text);fileId=e.serverFileId;for(var r=0;r<files.length;r++){if(e.id==files[r]["id"]){files[r]["state"]=6;files[r]["file_id"]=e.serverFileId;break}}if(isUploadFinish()){var l=generateParams()}}console.log(e)},onFileStatus:function(e){console.log("各状态总数--\x3e"+r.stringify(e))},onFilterError:function(e){var i="message:"+e.message+(e.solution?";solution=="+e.solution:"");if(e.code==-1){baseUtils.show.redTip("请上传正确格式的文件")}}});d(".videoUploadCancle").click(function(){d(".videoUploadBox").fadeOut(300);s.debug("delete",fileId);qcVideo.uploader.deleteFile(fileId);deleteFromFile(fileId);fileId=null})};function deleteFromFile(e){for(var i=0;i<files.length;i++){var t=files[i];if(e==t["id"]){files.splice(i,1);console.log("从files中删除了一个文件:"+e)}}}function isUploadFinish(){var e=true;for(var i=0;i<files.length;i++){if(files[i]["state"]!=6){e=false}}return e}function generateParams(){var e={};if(files.length==1){e={public_video:files[0]["file_id"],public_size_text:files[0]["size"]/(1024*1024)}}return e}var try_count=0;function videoUpload(){if(try_count>=300){hideLoading();baseUtils.show.redTip("视频解析失败,请更新浏览器版本重新上传");return}setTimeout(function(){if(files.length>0&&files[0]["state"]==2){console.log("解析完成");qcVideo.uploader.startUpload()}else{try_count++;console.log("解析还未完成");videoUpload()}},1e3)}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkbWluL3Jlc01hbmFnZS92aWRlb1VwbG9hZFRlc3QuanMiXSwibmFtZXMiOlsid2lkdGgiLCJoZWlnaHQiLCJwYXJhbXMiLCJwYXlfdHlwZSIsInJlc291cmNlX3R5cGUiLCJjb3MiLCJJbml0Q29zQ2xvdWQiLCJTSUQiLCJQb2Zmc2V0IiwiZmlsZXMiLCJ0cmFuc2NvZGVOb3RpZnlVcmwiLCJzZWNyZXRJZCIsImZpbGVJZCIsInZpZGVvR3NpemUiLCJpc19lZGl0IiwiJCIsImRvY3VtZW50IiwicmVhZHkiLCJpbml0VXBsb2FkIiwiZ2V0UGFyYW1ldGVyQnlOYW1lIiwibmFtZSIsInVybCIsIndpbmRvdyIsImxvY2F0aW9uIiwiaHJlZiIsInJlcGxhY2UiLCJyZWdleCIsIlJlZ0V4cCIsInJlc3VsdHMiLCJleGVjIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwiZ2V0T2JqZWN0VVJMIiwiZmlsZSIsImNyZWF0ZU9iamVjdFVSTCIsInVuZGVmaW5lZCIsIlVSTCIsIndlYmtpdFVSTCIsInFjVmlkZW8iLCJnZXQiLCJWZXJzaW9uIiwidXBsb2FkZXIiLCJzdXBwb3J0QnJvd3NlciIsIklTX01PQklMRSIsImJhc2VVdGlscyIsInNob3ciLCJyZWRUaXAiLCJnZXRJbnRlcm5ldEV4cGxvcmVyVmVyc2lvbiIsImlzVHJhbnNjb2RlIiwiaXNXYXRlcm1hcmsiLCJhY2NvdW50RG9uZSIsInVwQnRuSWQiLCJjbGFzc0lkIiwiRXJyb3JDb2RlIiwiTG9nIiwiSlNPTiIsInV0aWwiLCJDb2RlIiwiaW5pdCIsIndlYl91cGxvYWRfdXJsIiwiZ2V0U2lnbmF0dXJlIiwiYXJnT2JqIiwiZG9uZSIsImNvbnNvbGUiLCJsb2ciLCJmdCIsImFyZ1N0ciIsImEiLCJwdXNoIiwiZW5jb2RlVVJJQ29tcG9uZW50Iiwiam9pbiIsInNoYSIsIkNyeXB0b0pTIiwiSG1hY1NIQTEiLCJjb25jYXQiLCJlbmMiLCJVdGY4IiwicGFyc2UiLCJCYXNlNjQiLCJzdHJpbmdpZnkiLCJhZnRlcl9zaGFfc3RhcnRfdXBsb2FkIiwic2hhMWpzX3BhdGgiLCJkaXNhYmxlX211bHRpX3NlbGVjdGlvbiIsImZpbHRlcnMiLCJtYXhfZmlsZV9zaXplIiwibWltZV90eXBlcyIsInZpZGVvX29ubHkiLCJmb3JjZUg1V29ya2VyIiwib25GaWxlVXBkYXRlIiwiYXJncyIsImRhdGEiLCJpZCIsImZhZGVJbiIsInZpZGVvU2l6ZVMiLCJzaXplIiwic2V0VGltZW91dCIsImFsZXJ0IiwiZGVsZXRlRmlsZSIsImRlbGV0ZUZyb21GaWxlIiwicmVtb3ZlIiwiY29kZSIsImxlbmd0aCIsIm9sZF9pZCIsIiRsaW5lIiwiYXBwZW5kIiwiaW5mb19pdGVtIiwic3RhdGUiLCJmaWxlX2lkIiwic2l6ZV90ZXh0IiwidHlwZSIsInRleHQiLCJjc3MiLCJwZXJjZW50IiwidXBsb2FkQ29tcGxldGVTaXplIiwicGFyc2VGbG9hdCIsInRvRml4ZWQiLCJzcGVlZCIsInNlcnZlckZpbGVJZCIsImkiLCJpc1VwbG9hZEZpbmlzaCIsImV4dGVybmFsUGFyYW1zIiwiZ2VuZXJhdGVQYXJhbXMiLCJvbkZpbGVTdGF0dXMiLCJpbmZvIiwib25GaWx0ZXJFcnJvciIsIm1zZyIsIm1lc3NhZ2UiLCJzb2x1dGlvbiIsImNsaWNrIiwiZmFkZU91dCIsImRlYnVnIiwiaXRlbSIsInNwbGljZSIsImlzRmluaXNoIiwiZmlsZV9pZF9wYXJhbXMiLCJwdWJsaWNfdmlkZW8iLCJwdWJsaWNfc2l6ZV90ZXh0IiwidHJ5X2NvdW50IiwidmlkZW9VcGxvYWQiLCJoaWRlTG9hZGluZyIsInN0YXJ0VXBsb2FkIl0sIm1hcHBpbmdzIjoiQUFBQSxHQUFJQSxNQUNKLElBQUlDLE9BRUosSUFBSUMsVUFFSixJQUFJQyxVQUFXLENBRWYsSUFBSUMsY0FLSixJQUFJQyxLQUFNLEdBQUlDLGFBR2QsSUFBSUMsSUFFSixJQUFJQyxRQUVKLElBQUlDLFNBQ0osSUFBSUMsbUJBQ0osSUFBSUMsU0FDSixJQUFJQyxPQUNKLElBQUlDLFdBRUosSUFBSUMsU0FBVSxLQUVk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LFNBQVFDLElBQUksU0FDWjBFLGlCQUVOIiwiZmlsZSI6ImFkbWluL3Jlc01hbmFnZS92aWRlb1VwbG9hZFRlc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgd2lkdGg7XG52YXIgaGVpZ2h0O1xuXG52YXIgcGFyYW1zID0ge307XG5cbnZhciBwYXlfdHlwZSA9IDI7IC8v5LuY6LS557G75Z6LLDHooajnpLrlhY3otLnjgIEy6KGo56S65Y2V5Liq5LuY6LS5LDPooajnpLrkuJPmoI/jgIJcblxudmFyIHJlc291cmNlX3R5cGU7Ly/liJvlu7rnsbvlnotcblxuLy/ohb7orq/kupHotYTmupBcbi8vdmFyIGJ1Y2tldE5hbWUgPSB3aW5kb3cuY29zX2J1Y2tldF9uYW1lO1xuLy92YXIgY29zID0gbmV3IENvc0Nsb3VkKHdpbmRvdy5jb3NfYXBwX2lkKTtcbnZhciBjb3MgPSBuZXcgSW5pdENvc0Nsb3VkKCk7XG5cbi8vU2V0SW50ZXJ2YWzov5Tlm55JRFxudmFyIFNJRDtcbi8v5q276L+b5bqm5p2h5q+P5qyh5Y+Y5YyW6YePXG52YXIgUG9mZnNldDtcblxudmFyIGZpbGVzID0gW107IC8v5a2Y5pS+5paH5Lu2XG52YXIgdHJhbnNjb2RlTm90aWZ5VXJsOy8vIOi9rOeggeaIkOWKn+Wbnuiwg+WcsOWdgFxudmFyIHNlY3JldElkO1xudmFyIGZpbGVJZDtcbnZhciB2aWRlb0dzaXplO1xuXG52YXIgaXNfZWRpdCA9IGZhbHNlO1xuXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgLy/liJ3lp4vljJbkuIrkvKDnqbrpl7RcbiAgICBpbml0VXBsb2FkKCk7XG59KTtcblxuXG4vKipcbiAqIOiOt+WPlnVyaeWPguaVsFxuICogQHBhcmFtIG5hbWVcbiAqIEBwYXJhbSB1cmxcbiAqIEByZXR1cm5zIHsqfVxuICovXG5mdW5jdGlvbiBnZXRQYXJhbWV0ZXJCeU5hbWUobmFtZSwgdXJsKSB7XG4gICAgaWYgKCF1cmwpIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xuICAgIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csIFwiXFxcXCQmXCIpO1xuICAgIHZhciByZWdleCA9IG5ldyBSZWdFeHAoXCJbPyZdXCIgKyBuYW1lICsgXCIoPShbXiYjXSopfCZ8I3wkKVwiKSxcbiAgICAgICAgcmVzdWx0cyA9IHJlZ2V4LmV4ZWModXJsKTtcbiAgICBpZiAoIXJlc3VsdHMpIHJldHVybiBudWxsO1xuICAgIGlmICghcmVzdWx0c1syXSkgcmV0dXJuICcnO1xuICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgXCIgXCIpKTtcbn1cblxuZnVuY3Rpb24gZ2V0T2JqZWN0VVJMKGZpbGUpIHtcbiAgICB2YXIgdXJsID0gbnVsbDtcbiAgICBpZiAod2luZG93LmNyZWF0ZU9iamVjdFVSTCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgdXJsID0gd2luZG93LmNyZWF0ZU9iamVjdFVSTChmaWxlKVxuICAgIH0gZWxzZSBpZiAod2luZG93LlVSTCAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZSlcbiAgICB9IGVsc2UgaWYgKHdpbmRvdy53ZWJraXRVUkwgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHVybCA9IHdpbmRvdy53ZWJraXRVUkwuY3JlYXRlT2JqZWN0VVJMKGZpbGUpXG4gICAgfVxuICAgIHJldHVybiB1cmxcbn1cblxuXG4vLyDkuIrkvKDop4bpopHliJ3lp4vljJZcbmZ1bmN0aW9uIGluaXRVcGxvYWQoKSB7XG4gICAgdmFyICQgPSBxY1ZpZGVvLmdldCgnJCcpO1xuICAgIHZhciBWZXJzaW9uID0gcWNWaWRlby5nZXQoJ1ZlcnNpb24nKTtcbiAgICBpZiAoIXFjVmlkZW8udXBsb2FkZXIuc3VwcG9ydEJyb3dzZXIoKSkge1xuICAgICAgICBpZiAoVmVyc2lvbi5JU19NT0JJTEUpIHtcbiAgICAgICAgICAgIGJhc2VVdGlscy5zaG93LnJlZFRpcCgn5b2T5YmN5rWP6KeI5Zmo5LiN5pSv5oyB5LiK5Lyg77yM6K+35Y2H57qn57O757uf54mI5pys5oiW6ICF5LiL6L295pyA5paw55qEY2hyb21l5rWP6KeI5ZmoJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBnZXRJbnRlcm5ldEV4cGxvcmVyVmVyc2lvbigpO1xuICAgICAgICAgICAgLy8gYmFzZVV0aWxzLnNob3cucmVkVGlwKCflvZPliY3mtY/op4jlmajkuI3mlK/mjIHkuIrkvKDvvIzor7fljYfnuqfmtY/op4jlmajmiJbogIXkuIvovb3mnIDmlrDnmoRjaHJvbWXmtY/op4jlmagnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIC8v5Y+W5raI5LiK5Lyg5bm25Yig6Zmk5paH5Lu2XG4gICAgdmFyIGlzVHJhbnNjb2RlID0gMTsgLy/lvIDlkK/ovaznoIFcbiAgICB2YXIgaXNXYXRlcm1hcmsgPSAwOy8vIOawtOWNsFxuXG4gICAgYWNjb3VudERvbmUoJ3ZpZGVvX2ZpbGUnLCBpc1RyYW5zY29kZSwgaXNXYXRlcm1hcmssIFwiXCIpO1xufVxuXG52YXIgYWNjb3VudERvbmUgPSBmdW5jdGlvbiAodXBCdG5JZCwgaXNUcmFuc2NvZGUsIGlzV2F0ZXJtYXJrLCBjbGFzc0lkKSB7XG5cbiAgICB2YXIgJCA9IHFjVmlkZW8uZ2V0KCckJylcbiAgICAgICAgLCBFcnJvckNvZGUgPSBxY1ZpZGVvLmdldCgnRXJyb3JDb2RlJylcbiAgICAgICAgLCBMb2cgPSBxY1ZpZGVvLmdldCgnTG9nJylcbiAgICAgICAgLCBKU09OID0gcWNWaWRlby5nZXQoJ0pTT04nKVxuICAgICAgICAsIHV0aWwgPSBxY1ZpZGVvLmdldCgndXRpbCcpXG4gICAgICAgICwgQ29kZSA9IHFjVmlkZW8uZ2V0KCdDb2RlJylcbiAgICAgICAgLCBWZXJzaW9uID0gcWNWaWRlby5nZXQoJ1ZlcnNpb24nKVxuICAgICAgICA7XG4gICAgcWNWaWRlby51cGxvYWRlci5pbml0KFxuICAgICAgICB7XG4gICAgICAgICAgICB3ZWJfdXBsb2FkX3VybDogJ2h0dHBzOi8vdm9kMi5xY2xvdWQuY29tL3YzL2luZGV4LnBocCcsXG4gICAgICAgICAgICAvL3NlY3JldElkOiBzZWNyZXRJZCwgLy8g5LqRYXBpIHNlY3JldElkXG5cbiAgICAgICAgICAgIGdldFNpZ25hdHVyZTogZnVuY3Rpb24gKGFyZ09iaiwgZG9uZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKDEpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGFyZ09iai5mdCk7XG5cbiAgICAgICAgICAgICAgICAvL2FyZ09ialsncyddID0gc2VjcmV0SWQ7XG4gICAgICAgICAgICAgICAgLy9hcmdPYmpbJ3VpZCddID0gMTAwO1xuICAgICAgICAgICAgICAgIC8vdmFyIGFyZ1N0ciA9IFtdO1xuICAgICAgICAgICAgICAgIC8vZm9yICh2YXIgYSBpbiBhcmdPYmopXG4gICAgICAgICAgICAgICAgLy8gICAgYXJnU3RyLnB1c2goYSArICc9JyArIGVuY29kZVVSSUNvbXBvbmVudChhcmdPYmpbYV0pKTtcbiAgICAgICAgICAgICAgICAvL2FyZ1N0ciA9IGFyZ1N0ci5qb2luKCcmJyk7XG4gICAgICAgICAgICAgICAgLy8vL3ZhciBhcmdTdHIgPSAnZj0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGFyZ09iai5mKVxuICAgICAgICAgICAgICAgIC8vLy8rICcmZnQ9JyArIGVuY29kZVVSSUNvbXBvbmVudChhcmdPYmouZnQpXG4gICAgICAgICAgICAgICAgLy8vLysgJyZmcz0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGFyZ09iai5mcyk7XG4gICAgICAgICAgICAgICAgLy92YXIgc2lnbl91cmwgPSAnL2dldHNpZz8nICsgYXJnU3RyO1xuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgLy8vL+azqOaEj++8muWHuuS6juWuieWFqOiAg+iZke+8jCDmnI3liqHnq6/mjqXmlLZhcmdTdHLov5nkuKrlj4LmlbDlkI7vvIzpnIDopoHmoKHpqozlhbbkuK3nmoRBY3Rpb27lj4LmlbDmmK/lkKbkuLogXCJNdWx0aXBhcnRVcGxvYWRWb2RGaWxlXCIs55So5p2l6K+B5piO6K+l5Y+C5pWw5qCH6K+G5LiK5Lyg6K+35rGCXG4gICAgICAgICAgICAgICAgLy8kLmFqYXgoe1xuICAgICAgICAgICAgICAgIC8vICAgICdkYXRhVHlwZSc6ICdqc29uJyxcbiAgICAgICAgICAgICAgICAvLyAgICAndXJsJzogc2lnbl91cmwsXG4gICAgICAgICAgICAgICAgLy8gICAgJ3N1Y2Nlc3MnOiBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgIC8vICAgICAgICBkb25lKGRbJ3Jlc3VsdCddKTtcbiAgICAgICAgICAgICAgICAvLyAgICB9XG4gICAgICAgICAgICAgICAgLy99KTtcblxuICAgICAgICAgICAgICAgIGFyZ09ialsncyddID0gJ0FLSURUZHpuMlBoZ2V1S3ZyMnVlNGRTYk1IV1NETWpLOGQ3dic7XG4gICAgICAgICAgICAgICAgYXJnT2JqWyd1aWQnXSA9ICflv4XloasnO1xuICAgICAgICAgICAgICAgIHZhciBhcmdTdHIgPSBbXTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBhIGluIGFyZ09iailcbiAgICAgICAgICAgICAgICAgICAgYXJnU3RyLnB1c2goYSArICc9JyArIGVuY29kZVVSSUNvbXBvbmVudChhcmdPYmpbYV0pKTtcbiAgICAgICAgICAgICAgICBhcmdTdHIgPSBhcmdTdHIuam9pbignJicpO1xuICAgICAgICAgICAgICAgIHZhciBzaGEgPSBDcnlwdG9KUy5IbWFjU0hBMShhcmdTdHIsICdPNGdUaGhnb3lXQ0NaM21wNDRDeW92QVN5aDk2aG15NCcpO1xuICAgICAgICAgICAgICAgIHNoYS5jb25jYXQoQ3J5cHRvSlMuZW5jLlV0ZjgucGFyc2UoYXJnU3RyKSk7XG4gICAgICAgICAgICAgICAgZG9uZShDcnlwdG9KUy5lbmMuQmFzZTY0LnN0cmluZ2lmeShzaGEpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB1cEJ0bklkOiB1cEJ0bklkLCAvL+S4iuS8oOaMiemSrklE77yI5Lu75oSP6aG16Z2i5YWD57SgSUTvvIlcbiAgICAgICAgICAgIGlzVHJhbnNjb2RlOiBpc1RyYW5zY29kZSwvL+aYr+WQpui9rOeggVxuICAgICAgICAgICAgaXNXYXRlcm1hcms6IGlzV2F0ZXJtYXJrLC8v5piv5ZCm6K6+572u5rC05Y2wXG4gICAgICAgICAgICBhZnRlcl9zaGFfc3RhcnRfdXBsb2FkOiB0cnVlLC8vc2hh6K6h566X5a6M5oiQ5ZCO77yM5byA5aeL5LiK5LygICjpu5jorqTlhbPpl63nq4vljbPkuIrkvKApXG4gICAgICAgICAgICBzaGExanNfcGF0aDogJy9jYWxjdWxhdG9yX3dvcmtlcl9zaGExLmpzJywgLy/orqHnrpdzaGEx55qE5L2N572uXG4gICAgICAgICAgICBkaXNhYmxlX211bHRpX3NlbGVjdGlvbjogZmFsc2UsIC8v56aB55So5aSa6YCJIO+8jOm7mOiupOS4umZhbHNlXG4gICAgICAgICAgICB0cmFuc2NvZGVOb3RpZnlVcmw6IHRyYW5zY29kZU5vdGlmeVVybCwvLyjovaznoIHmiJDlip/lkI7nmoTlm57osIPlnLDlnYApaXNUcmFuc2NvZGU9PXRydWUs5pe25byA5ZCv77ybIOWbnuiwg3VybOeahOi/lOWbnuaVsOaNruagvOW8j+WPguiAgyAgaHR0cDovL3d3dy5xY2xvdWQuY29tL3dpa2kvdjIvTXVsdGlwYXJ0VXBsb2FkVm9kRmlsZVxuICAgICAgICAgICAgY2xhc3NJZDogY2xhc3NJZCxcbiAgICAgICAgICAgIGZpbHRlcnM6IHttYXhfZmlsZV9zaXplOiAnMmdiJywgbWltZV90eXBlczogWydNUDQnXSwgdmlkZW9fb25seTogdHJ1ZX0sXG4gICAgICAgICAgICAvL2ZvcmNlSDVXb3JrZXI6ICEhcGFyc2VJbnQoZ2V0UGFyYW1ldGVyQnlOYW1lKCdmb3JjZUg1V29ya2VyJykpIHx8IGZhbHNlLFxuICAgICAgICAgICAgZm9yY2VINVdvcmtlcjogdHJ1ZVxuICAgICAgICB9XG4gICAgICAgICwge1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIOabtOaWsOaWh+S7tueKtuaAgeWSjOi/m+W6plxuICAgICAgICAgICAgICogY29kZTox44CB5YeG5aSH6K6h566XU0hBIDLjgIHnrYnlvoXkuIrkvKAgM+OAgVNIQeiuoeeul+S4rSA044CB5Y2z5bCG5LiK5LygIDXjgIHkuIrkvKDov5vluqbmm7TmlrAgNuOAgeS4iuS8oOWujOaIkFxuICAgICAgICAgICAgICogQHBhcmFtIGFyZ3MgeyBpZDog5paH5Lu2SUQsIHNpemU6IOaWh+S7tuWkp+WwjywgbmFtZTog5paH5Lu25ZCN56ewLCBzdGF0dXM6IOeKtuaAgSwgcGVyY2VudDog6L+b5bqmIHNwZWVkOiDpgJ/luqYsIGVycm9yQ29kZTog6ZSZ6K+v56CBLHNlcnZlckZpbGVJZDog5ZCO56uv5paH5Lu2SUQgfVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBvbkZpbGVVcGRhdGU6IGZ1bmN0aW9uIChhcmdzKSB7XG4gICAgICAgICAgICAgICAgLy/ojrflj5bkuIrkvKDmlofku7ZpZFxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRyYW5zY29kZU5vdGlmeVVybCk7XG4gICAgICAgICAgICAgICAgJChcIi52aWRlb1VwbG9hZENhbmNsZVwiKS5kYXRhKCd2aWRlb2lkJyxhcmdzLmlkKTtcbiAgICAgICAgICAgICAgICAkKFwiLnZpZGVvVXBsb2FkQm94XCIpLmZhZGVJbigzMDApO1xuICAgICAgICAgICAgICAgIC8vIGZpbGVJZD1hcmdzLmlkO1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGZpbGVJZCk7XG4gICAgICAgICAgICAgICAgLy/liKTmlq3kuIrkvKDop4bpopHlpKflsI9cbiAgICAgICAgICAgICAgICB2YXIgdmlkZW9TaXplUyA9IGFyZ3Muc2l6ZTtcbiAgICAgICAgICAgICAgICB2aWRlb0dzaXplID0gdmlkZW9TaXplUy8oMTAyNCoxMDI0KTtcbiAgICAgICAgICAgICAgICBpc19lZGl0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAvLyDlpoLmnpzop4bpopHlpKflsI/lpKfkuo4xR++8jOWImeWcqOS4iuS8oOa1geeoi+S4reWIoOmZpOW9k+WJjeaWh+S7tlxuICAgICAgICAgICAgICAgIGlmKHZpZGVvR3NpemU+MTAwMCl7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoXCLor7flsIbop4bpopHmlofku7bljovnvKnliLAgMUcg5Lul5YaFIVwiKVxuICAgICAgICAgICAgICAgICAgICB9LDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIHFjVmlkZW8udXBsb2FkZXIuZGVsZXRlRmlsZShhcmdzLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlRnJvbUZpbGUoYXJncy5pZCk7IC8v5LuO5paH5Lu25pWw57uE5Lit5Yig6Zmk6K+l5paH5Lu2XG4gICAgICAgICAgICAgICAgICAgICQoJyMnICsgYXJncy5pZCkucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfmlofku7botoXov4cxRyzmj5DnpLrph43mlrDpgInmi6nop4bpopHmlofku7Y6JyArIGFyZ3MuaWQpO1xuICAgICAgICAgICAgICAgICAgICBhcmdzID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoYXJncy5jb2RlID09IDEpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZXMubGVuZ3RoID09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8v5Yig6Zmk5LmL5YmN55qE5re75Yqg5paw55qEXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZXNbMF0gIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9sZF9pZCA9IGZpbGVzWzBdLmlkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHFjVmlkZW8udXBsb2FkZXIuZGVsZXRlRmlsZShvbGRfaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZUZyb21GaWxlKG9sZF9pZCk7IC8v5LuO5paH5Lu25pWw57uE5Lit5Yig6Zmk6K+l5paH5Lu2XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnIycgKyBvbGRfaWQpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfliKDpmaTkuobkuIDkuKrmlofku7Y6JyArIG9sZF9pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB2YXIgJGxpbmUgPSAkKFwiI1wiICsgYXJncy5pZCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghJGxpbmUuZ2V0KDApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcjcHJvZ3Jlc3Nfc2hvdycpLmFwcGVuZChcIjxkaXYgY2xhc3M9J3Byb2dyZXNzX2RpdicgaWQgPSAnXCIgKyBhcmdzLmlkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBcIic+PHNwYW4gc3R5bGU9J2ZvbnQtc2l6ZTogMTJweCc+XCIgKyBhcmdzLm5hbWUgKyBcIjo8L3NwYW4+PGRpdiBjbGFzcz0ncHJvZ3Jlc3NfYmFyJyBpZCA9ICdwcm9ncmVzc19iYXJfXCIgKyBhcmdzLmlkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBcIic+PGRpdiBjbGFzcz0nYmFyJyBpZD0nYmFyX1wiICsgYXJncy5pZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgXCInPjwvZGl2PjwvZGl2PjxzcGFuIGNsYXNzPSd1cGxvYWRfZmluaXNoJyBpZD0ndXBsb2FkX2ZpbmlzaF9cIiArIGFyZ3MuaWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICArIFwiJz7kuIrkvKDlrozmiJA8L3NwYW4+PHNwYW4gZGF0YS1hY3Q9J2RlbCcgZGF0YS10eXBlPScwJyBjbGFzcz0nZGVsZXRlJz7liKDpmaQ8L3NwYW4+PC9kaXY+XCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgICAgICAgICB2YXIgaW5mb19pdGVtID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ2lkJzogYXJncy5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdzaXplJzogYXJncy5zaXplLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3N0YXRlJzogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICdmaWxlX2lkJzogJycsXG4gICAgICAgICAgICAgICAgICAgICAgICAnc2l6ZV90ZXh0JzogYXJncy5zaXplX3RleHQsXG4gICAgICAgICAgICAgICAgICAgICAgICAndHlwZSc6IDFcbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBmaWxlc1tmaWxlcy5sZW5ndGhdID0gaW5mb19pdGVtO1xuICAgICAgICAgICAgICAgICAgICAkKFwiLnZpZGVvQm94VGl0bGVcIikudGV4dChhcmdzLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICAkKFwiLnZpZGVvU2l6ZVwiKS50ZXh0KGFyZ3Muc2l6ZV90ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgJChcIi51cGxvYWRSYXRpbyBzcGFuOm50aC1vZi10eXBlKDIpXCIpLnRleHQoYXJncy5zaXplX3RleHQpO1xuICAgICAgICAgICAgICAgICAgICAvL+i/m+W6pueZvuWIhuavlOe9ruS4ujBcbiAgICAgICAgICAgICAgICAgICAgJChcIi52aWRlb1BlcmNlbnRcIikudGV4dChcIuinhumikeato+WcqOino+aekOS4rVwiKTtcbiAgICAgICAgICAgICAgICAgICAgJChcIi51cGxvYWRSYXRpbyBzcGFuXCIpLnRleHQoXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICQoXCIudmlkZW9VcGxvYWRMaW5lQVwiKS5jc3MoXCJ3aWR0aFwiLFwiMCVcIik7XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCLmt7vliqDkuobkuIDkuKrmlrDnmoTmlofku7Y6XCIgKyBcImlkOlwiICsgYXJncy5pZCArIFwic2l6ZTpcIiArIGFyZ3Muc2l6ZSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYoYXJncy5jb2RlPT0yKXtcbiAgICAgICAgICAgICAgICAvL3FjVmlkZW8udXBsb2FkZXIuc3RhcnRVcGxvYWQoKTtcbiAgICAgICAgICAgICAgICAgICAgZmlsZXNbMF1bJ3N0YXRlJ10gPSAyO1xuICAgICAgICAgICAgICAgICAgICAvL3ZpZGVvVXBsb2FkKCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGFyZ3MuY29kZSA9PSA1ICYmIGFyZ3MucGVyY2VudCA+IDApIC8v5LiK5Lyg6L+b5bqm5Y+R55Sf5Y+Y5YyWXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdXBsb2FkQ29tcGxldGVTaXplPXBhcnNlRmxvYXQoYXJncy5zaXplX3RleHQpKnBhcnNlRmxvYXQoYXJncy5wZXJjZW50LzEwMCk7XG4gICAgICAgICAgICAgICAgICAgIHVwbG9hZENvbXBsZXRlU2l6ZT11cGxvYWRDb21wbGV0ZVNpemUudG9GaXhlZCgyKTtcbiAgICAgICAgICAgICAgICAgICAgJChcIi52aWRlb1VwbG9hZExpbmVBXCIpLmNzcyhcIndpZHRoXCIsYXJncy5wZXJjZW50K1wiJVwiKTtcbiAgICAgICAgICAgICAgICAgICAgJChcIi52aWRlb1BlcmNlbnRcIikudGV4dChhcmdzLnBlcmNlbnQrXCIlXCIpO1xuICAgICAgICAgICAgICAgICAgICAkKFwiLnVwbG9hZFJhdGlvIHNwYW46bnRoLW9mLXR5cGUoMSlcIikudGV4dCh1cGxvYWRDb21wbGV0ZVNpemUpO1xuICAgICAgICAgICAgICAgICAgICAkKFwiLnVwbG9hZFJhdGlvIHNwYW46bnRoLW9mLXR5cGUoMilcIikudGV4dChhcmdzLnNpemVfdGV4dCk7XG4gICAgICAgICAgICAgICAgICAgIGlmKCFhcmdzLnNwZWVkKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoXCIudXBsb2FkU3BlZWQgc3BhblwiKS50ZXh0KFwiXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJChcIi52aWRlb1RpbWVMZWZ0IHNwYW5cIikudGV4dChcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKFwiLnVwbG9hZFNwZWVkIHNwYW5cIikudGV4dChhcmdzLnNwZWVkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChhcmdzLmNvZGUgPT0gNikgLy/kuIrkvKDmiJDlip9cbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGlzX2VkaXQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHVwbG9hZENvbXBsZXRlU2l6ZT1hcmdzLnNpemVfdGV4dCphcmdzLnBlcmNlbnQ7XG4gICAgICAgICAgICAgICAgICAgICQoXCIudmlkZW9VcGxvYWRMaW5lQVwiKS5jc3MoJ3dpZHRoJywgXCIxMDAlXCIpO1xuICAgICAgICAgICAgICAgICAgICAkKFwiLnZpZGVvUGVyY2VudFwiKS50ZXh0KFwi5bey5a6M5oiQXCIpO1xuICAgICAgICAgICAgICAgICAgICAkKFwiLnVwbG9hZFJhdGlvIHNwYW46bnRoLW9mLXR5cGUoMSlcIikudGV4dChhcmdzLnNpemVfdGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICQoXCIudXBsb2FkUmF0aW8gc3BhbjpudGgtb2YtdHlwZSgyKVwiKS50ZXh0KGFyZ3Muc2l6ZV90ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgZmlsZUlkPWFyZ3Muc2VydmVyRmlsZUlkO1xuICAgICAgICAgICAgICAgICAgICAvL+S/ruaUuWZpbGVz5Lit5paH5Lu255qE54q25oCBXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhcmdzLmlkID09IGZpbGVzW2ldWydpZCddKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXNbaV1bJ3N0YXRlJ10gPSA2O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzW2ldWydmaWxlX2lkJ10gPSBhcmdzLnNlcnZlckZpbGVJZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1VwbG9hZEZpbmlzaCgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL+aPkOS6pOaWh+S7tlxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGV4dGVybmFsUGFyYW1zID0gZ2VuZXJhdGVQYXJhbXMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVwbG9hZFRvU2VydmVyKGV4dGVybmFsUGFyYW1zKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYXJncyk7XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIOaWh+S7tueKtuaAgeWPkeeUn+WPmOWMllxuICAgICAgICAgICAgICogQHBhcmFtIGluZm8gIHsgZG9uZTog5a6M5oiQ5pWw6YePICwgZmFpbDog5aSx6LSl5pWw6YePICwgc2hhOiDorqHnrpdTSEHmiJbogIXnrYnlvoXorqHnrpdTSEHkuK3nmoTmlbDph48gLCB3YWl0OiDnrYnlvoXkuIrkvKDmlbDph48gLCB1cGxvYWRpbmc6IOS4iuS8oOS4reeahOaVsOmHjyB9XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIG9uRmlsZVN0YXR1czogZnVuY3Rpb24gKGluZm8pIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygn5ZCE54q25oCB5oC75pWwLS0+JyArIEpTT04uc3RyaW5naWZ5KGluZm8pKTtcbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogIOS4iuS8oOaXtumUmeivr+aWh+S7tui/h+a7pOaPkOekulxuICAgICAgICAgICAgICogQHBhcmFtIGFyZ3Mge2NvZGU6ey0xOiDmlofku7bnsbvlnovlvILluLgsLTI6IOaWh+S7tuWQjeW8guW4uH0gLCBtZXNzYWdlOiDplJnor6/ljp/lm6Ag77yMIHNvbHV0aW9uOiDop6PlhrPmlrnms5V9XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIG9uRmlsdGVyRXJyb3I6IGZ1bmN0aW9uIChhcmdzKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1zZyA9ICdtZXNzYWdlOicgKyBhcmdzLm1lc3NhZ2UgKyAoYXJncy5zb2x1dGlvbiA/ICgnO3NvbHV0aW9uPT0nICsgYXJncy5zb2x1dGlvbikgOiAnJyk7XG4gICAgICAgICAgICAgICBpZihhcmdzLmNvZGU9PS0xKXtcbiAgICAgICAgICAgICAgICAgICBiYXNlVXRpbHMuc2hvdy5yZWRUaXAoXCLor7fkuIrkvKDmraPnoa7moLzlvI/nmoTmlofku7ZcIik7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgIH1cbiAgICApO1xuXG5cbiAgICAvLyAkKCcudmlkZW9VcGxvYWRDYW5jbGUnKS5vbignY2xpY2snLCAnW2RhdGEtYWN0PVwiZGVsXCJdJywgZnVuY3Rpb24gKGUpIHtcbiAgICAvLyAgICAgdmFyICRsaW5lID0gJCh0aGlzKS5wYXJlbnQoKTtcbiAgICAvLyAgICAgdmFyIGZpbGVJZCA9ICRsaW5lLmdldCgwKS5pZDtcbiAgICAvLyAgICAgTG9nLmRlYnVnKCdkZWxldGUnLCBmaWxlSWQpO1xuICAgIC8vICAgICAkbGluZS5yZW1vdmUoKTtcbiAgICAvLyAgICAgLy9AYXBpIOWIoOmZpOaWh+S7tlxuICAgIC8vICAgICBxY1ZpZGVvLnVwbG9hZGVyLmRlbGV0ZUZpbGUoZmlsZUlkKTtcbiAgICAvLyAgICAgZGVsZXRlRnJvbUZpbGUoZmlsZUlkKTsgLy/ku47mlofku7bmlbDnu4TkuK3liKDpmaTor6Xmlofku7ZcbiAgICAvLyB9KTtcbiAgICAkKFwiLnZpZGVvVXBsb2FkQ2FuY2xlXCIpLmNsaWNrKGZ1bmN0aW9uKCl7XG4gICAgICAgICQoXCIudmlkZW9VcGxvYWRCb3hcIikuZmFkZU91dCgzMDApO1xuICAgICAgICBMb2cuZGVidWcoJ2RlbGV0ZScsIGZpbGVJZCk7XG4gICAgICAgIC8vICRsaW5lLnJlbW92ZSgpO1xuICAgICAgICAvL0BhcGkg5Yig6Zmk5paH5Lu2XG4gICAgICAgIHFjVmlkZW8udXBsb2FkZXIuZGVsZXRlRmlsZShmaWxlSWQpO1xuICAgICAgICBkZWxldGVGcm9tRmlsZShmaWxlSWQpOyAvL+S7juaWh+S7tuaVsOe7hOS4reWIoOmZpOivpeaWh+S7tlxuICAgICAgICBmaWxlSWQ9bnVsbDtcbiAgICB9KTtcbn1cblxuLy/liKDpmaTmn5DkuKrlhYPntKBcbmZ1bmN0aW9uIGRlbGV0ZUZyb21GaWxlKGlkKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmaWxlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgaXRlbSA9IGZpbGVzW2ldO1xuICAgICAgICBpZiAoaWQgPT0gaXRlbVsnaWQnXSkge1xuICAgICAgICAgICAgLy/liKDpmaTpobnnm65cbiAgICAgICAgICAgIGZpbGVzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfku45maWxlc+S4reWIoOmZpOS6huS4gOS4quaWh+S7tjonICsgaWQpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vL+WIpOaWreS4pOS4quinhumikeaYr+WQpumDveS4iuS8oOWujOaIkOS6hlxuZnVuY3Rpb24gaXNVcGxvYWRGaW5pc2goKSB7XG4gICAgdmFyIGlzRmluaXNoID0gdHJ1ZTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChmaWxlc1tpXVsnc3RhdGUnXSAhPSA2KSB7IC8v5pyJ5LiA5Liq5rKh5a6M5oiQ44CCXG4gICAgICAgICAgICBpc0ZpbmlzaCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBpc0ZpbmlzaDtcbn1cbi8v55Sf5oiQ5Y+C5pWwXG5mdW5jdGlvbiBnZW5lcmF0ZVBhcmFtcygpIHtcbiAgICB2YXIgZmlsZV9pZF9wYXJhbXMgPSB7fTtcbiAgICBpZiAoZmlsZXMubGVuZ3RoID09IDEpIHtcblxuICAgICAgICBmaWxlX2lkX3BhcmFtcyA9IHtcbiAgICAgICAgICAgICdwdWJsaWNfdmlkZW8nOiBmaWxlc1swXVsnZmlsZV9pZCddLCAncHVibGljX3NpemVfdGV4dCc6IChmaWxlc1swXVsnc2l6ZSddLygxMDI0KjEwMjQpKVxuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gZmlsZV9pZF9wYXJhbXM7XG59XG5cblxuLy/kuIrkvKDoh7PmiJHku6zmnI3liqHlmahcbi8vIGZ1bmN0aW9uIHVwbG9hZFRvU2VydmVyKGV4dGVybmFsUGFyYW1zKSB7XG4vLyAgICAgdmFyIGFsbFBhcmFtcyA9IHt9O1xuLy8gICAgIGFsbFBhcmFtc1sncmVzb3VyY2VfdHlwZSddID0gcmVzb3VyY2VfdHlwZTtcbi8vICAgICBhbGxQYXJhbXNbJ3Jlc291cmNlX3BhcmFtcyddID0gZXh0ZXJuYWxQYXJhbXM7XG4vLyAgICAgYWxsUGFyYW1zWydwYXJhbXMnXSA9IHBhcmFtcztcbi8vICAgICBhbGxQYXJhbXNbJ2lzX3NpbmdsZV9zYWxlJ10gPSBpc19zaW5nbGVfc2FsZTtcbi8vICAgICAvL+S4iuS8oOiHs+acjeWKoeWZqFxuLy8gICAgICQucG9zdCgnL3VwbG9hZF92aWRlbycsIGFsbFBhcmFtcywgZnVuY3Rpb24gKHJlc3VsdCkge1xuLy8gICAgICAgICBoaWRlTG9hZGluZygpO1xuLy8gICAgICAgICB2YXIgY29kZSA9IHJlc3VsdC5jb2RlO1xuLy8gICAgICAgICB2YXIgbXNnID0gcmVzdWx0Lm1zZztcbi8vICAgICAgICAgaWYgKGNvZGUgPT0gMCkge1xuLy8gICAgICAgICAgICAgYmFzZVV0aWxzLnNob3cuYmx1ZVRpcChtc2csIGZ1bmN0aW9uICgpIHtcbi8vICAgICAgICAgICAgICAgICBJc19TYXZlID0gZmFsc2U7XG4vLyAgICAgICAgICAgICAgICAgaWYgKGFsbFBhcmFtc1sncmVzb3VyY2VfdHlwZSddID09ICdhdWRpbycpIHtcbi8vICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnL2F1ZGlvX2xpc3QnO1xuLy8gICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYWxsUGFyYW1zWydyZXNvdXJjZV90eXBlJ10gPT0gJ3ZpZGVvJykge1xuLy8gICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvdmlkZW9fbGlzdCc7XG4vLyAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAnL2F1ZGlvX2xpc3QnO1xuLy8gICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgIH0pO1xuLy8gICAgICAgICB9IGVsc2Uge1xuLy8gICAgICAgICAgICAgYmFzZVV0aWxzLnNob3cucmVkVGlwKG1zZyk7XG4vLyAgICAgICAgIH1cbi8vICAgICB9KTtcblxuLy8gfVxuXG52YXIgdHJ5X2NvdW50PTA7XG5cbi8v5a+55LqO5aSn5paH5Lu2LOiuoeeul3NoYXIx5YC85q+U6L6D5oWiXG5mdW5jdGlvbiB2aWRlb1VwbG9hZCgpIHtcbiAgICBpZiAodHJ5X2NvdW50ID49IDMwMCkge1xuICAgICAgICBoaWRlTG9hZGluZygpO1xuICAgICAgICBiYXNlVXRpbHMuc2hvdy5yZWRUaXAoXCLop4bpopHop6PmnpDlpLHotKUs6K+35pu05paw5rWP6KeI5Zmo54mI5pys6YeN5paw5LiK5LygXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHNldFRpbWVvdXQoXG4gICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmKGZpbGVzLmxlbmd0aD4wJiZmaWxlc1swXVsnc3RhdGUnXT09Mil7IC8v5aaC5p6c6Kej5p6Q5a6M5LqG55qE6K+dXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+ino+aekOWujOaIkCcpO1xuICAgICAgICAgICAgICAgIHFjVmlkZW8udXBsb2FkZXIuc3RhcnRVcGxvYWQoKTtcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIHRyeV9jb3VudCsrO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfop6PmnpDov5jmnKrlrozmiJAnKTtcbiAgICAgICAgICAgICAgICB2aWRlb1VwbG9hZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LDEwMDBcbiAgICApXG59XG5cblxuXG4iXX0=
